{"title":"Commit Check 更新：新增两个实用功能提升代码质量保障","slug":"2024/11/commit-check-updates","date":"2024-11-22T16:00:00.000Z","updated":"2025-05-26T20:35:07.286Z","comments":true,"path":"api/articles/2024/11/commit-check-updates.json","excerpt":"最近有用户提出两个需求：一是支持在 Pull Request 中增加评论，二是检查 Pull Request 是否已经 rebase。经过几晚的努力，现在正式宣布在最新的 commit-check 以及 commit-check-action 中新增两个重要功能：pr-comments 和 base-merge。这两个功能旨在进一步提升 Pull Request (PR) 的检查能力。","covers":["/2024/11/commit-check-updates/success-pr-comments.png","/2024/11/commit-check-updates/failure-pr-comments.png"],"content":"<p>最近有用户提出两个需求：一是支持在 Pull Request 中增加评论，二是检查 Pull Request 是否已经 rebase。</p>\n<p>经过几晚的努力，现在正式宣布在最新的 commit-check 以及 commit-check-action 中新增两个重要功能：<code>pr-comments</code> 和 <code>base-merge</code>。</p>\n<p>这两个功能旨在进一步提升 Pull Request (PR) 的检查能力。</p>\n<span id=\"more\"></span>\n<h3 id=\"1-pr-comments-自动添加检查结果到-Pull-Request\"><a href=\"#1-pr-comments-自动添加检查结果到-Pull-Request\" class=\"headerlink\" title=\"1. pr-comments: 自动添加检查结果到 Pull Request\"></a>1. pr-comments: 自动添加检查结果到 Pull Request</h3><p>在团队合作开发中，PR 通常是代码审核的主要入口。为了让代码检查结果更直观，pr-comments 提供了一种新方式：</p>\n<p>当代码提交触发 CI&#x2F;CD Pipeline 后，commit-check 会自动在 Pull Request 界面中以评论形式呈现检查结果。</p>\n<p>无需额外点击或切换到日志文件，开发者可以直接在 PR 的对话区域查看检测结果，方便快速定位问题。</p>\n<p>成功和失败的示例效果：</p>\n<p><img src=\"/2024/11/commit-check-updates/success-pr-comments.png\" alt=\"pr-comments success\"></p>\n<p><img src=\"/2024/11/commit-check-updates/failure-pr-comments.png\" alt=\"pr-comments failure\"></p>\n<p>**注：**pr-comments 仅支持 <a href=\"https://github.com/commit-check/commit-check-action\">commit-check-action</a>。</p>\n<h3 id=\"2-base-merge-确保分支基于目标分支\"><a href=\"#2-base-merge-确保分支基于目标分支\" class=\"headerlink\" title=\"2. base-merge: 确保分支基于目标分支\"></a>2. base-merge: 确保分支基于目标分支</h3><p>在开发过程中，有些团队希望每个 Pull Request 都基于最新的目标分支进行开发。</p>\n<p>commit-check 提供了一个新的选项：<code>base-merge</code>，可以帮助团队确保分支已 rebase 到指定的目标分支（例如 main 或 master）。</p>\n<ul>\n<li>自动检查当前分支是否基于指定目标分支。</li>\n<li>如果检测到基线不正确，commit-check 会返回错误信息，让 CI Pipeline 失败，并提供明确的提示。</li>\n</ul>\n<p><strong>注：</strong> base-merge 支持 <a href=\"https://github.com/commit-check/commit-check\">commit-check</a> 和 <a href=\"https://github.com/commit-check/commit-check-action\">commit-check-action</a>。</p>\n<hr>\n<h2 id=\"什么是-Commit-Check\"><a href=\"#什么是-Commit-Check\" class=\"headerlink\" title=\"什么是 Commit Check\"></a>什么是 Commit Check</h2><p>如果你还不了解 Commit Check，这里简单介绍一下：</p>\n<p><strong>Commit Check</strong> 是一个免费且强大的工具，用于强制执行提交元数据标准，包括提交消息、分支命名、提交者姓名&#x2F;邮箱以及提交签名。它的错误信息和建议命令可以完全自定义，确保团队之间的一致性。</p>\n<p>作为 <a href=\"https://docs.github.com/en/enterprise-server@3.11/repositories/configuring-branches-and-merges-in-your-repository/managing-rulesets/available-rules-for-rulesets#metadata-restrictions\">GitHub Enterprise 元数据限制</a> 和 Bitbucket 付费插件 <a href=\"https://marketplace.atlassian.com/apps/1211854/yet-another-commit-checker?tab=overview&hosting=datacenter\">Yet Another Commit Checker</a> 的替代方案，Commit Check 通过集成 DevOps 原则和基础设施即代码（IaC）脱颖而出。</p>\n<p>它是目前针对 Conventional Commit 和 Branch 支持最好的免费开源解决方案。</p>\n<hr>\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><h3 id=\"使用默认配置\"><a href=\"#使用默认配置\" class=\"headerlink\" title=\"使用默认配置\"></a>使用默认配置</h3><p>如果没有设置 <code>.commit-check.yml</code>，Commit Check 将使用默认配置。提交消息将遵循 Conventional Commits 规则，分支命名遵循 Conventional Branch 规则。</p>\n<h3 id=\"自定义配置\"><a href=\"#自定义配置\" class=\"headerlink\" title=\"自定义配置\"></a>自定义配置</h3><p>如果需要更改配置，可以在 <code>.commit-check.yml</code> 中进行自定义：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">checks:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">check:</span> <span class=\"string\">message</span></span><br><span class=\"line\">    <span class=\"attr\">regex:</span> <span class=\"string\">&#x27;^(build|chore|ci|docs|feat|fix|perf|refactor|revert|style|test)&#123;1&#125;(\\([\\w\\-\\.]+\\))?(!)?: ([\\w ])+([\\s\\S]*)|(Merge).*|(fixup!.*)&#x27;</span></span><br><span class=\"line\">    <span class=\"attr\">error:</span> <span class=\"string\">&quot;The commit message should be structured as follows:\\n\\n</span></span><br><span class=\"line\"><span class=\"string\">    &lt;type&gt;[optional scope]: &lt;description&gt;\\n</span></span><br><span class=\"line\"><span class=\"string\">    [optional body]\\n</span></span><br><span class=\"line\"><span class=\"string\">    [optional footer(s)]\\n\\n</span></span><br><span class=\"line\"><span class=\"string\">    More details please refer to https://www.conventionalcommits.org&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">suggest:</span> <span class=\"string\">Please</span> <span class=\"string\">check</span> <span class=\"string\">your</span> <span class=\"string\">commit</span> <span class=\"string\">message</span> <span class=\"string\">against</span> <span class=\"string\">the</span> <span class=\"string\">above</span> <span class=\"string\">regex.</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">check:</span> <span class=\"string\">branch</span></span><br><span class=\"line\">    <span class=\"attr\">regex:</span> <span class=\"string\">^(bugfix|feature|release|hotfix|task|chore)\\/.+|(master)|(main)|(HEAD)|(PR-.+)</span></span><br><span class=\"line\">    <span class=\"attr\">error:</span> <span class=\"string\">&quot;Branches must begin with these types: bugfix/ feature/ release/ hotfix/ task/ chore/&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">suggest:</span> <span class=\"string\">Run</span> <span class=\"string\">command</span> <span class=\"string\">`git</span> <span class=\"string\">checkout</span> <span class=\"string\">-b</span> <span class=\"string\">type/branch_name`</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">check:</span> <span class=\"string\">author_name</span></span><br><span class=\"line\">    <span class=\"attr\">regex:</span> <span class=\"string\">^[A-Za-z</span> <span class=\"string\">,.\\&#x27;-]+$|.*(\\[bot])</span></span><br><span class=\"line\">    <span class=\"attr\">error:</span> <span class=\"string\">The</span> <span class=\"string\">committer</span> <span class=\"string\">name</span> <span class=\"string\">seems</span> <span class=\"string\">invalid</span></span><br><span class=\"line\">    <span class=\"attr\">suggest:</span> <span class=\"string\">Run</span> <span class=\"string\">command</span> <span class=\"string\">`git</span> <span class=\"string\">config</span> <span class=\"string\">user.name</span> <span class=\"string\">&quot;Your Name&quot;</span><span class=\"string\">`</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">check:</span> <span class=\"string\">author_email</span></span><br><span class=\"line\">    <span class=\"attr\">regex:</span> <span class=\"string\">^.+@.+$</span></span><br><span class=\"line\">    <span class=\"attr\">error:</span> <span class=\"string\">The</span> <span class=\"string\">committer</span> <span class=\"string\">email</span> <span class=\"string\">seems</span> <span class=\"string\">invalid</span></span><br><span class=\"line\">    <span class=\"attr\">suggest:</span> <span class=\"string\">Run</span> <span class=\"string\">command</span> <span class=\"string\">`git</span> <span class=\"string\">config</span> <span class=\"string\">user.email</span> <span class=\"string\">yourname@example.com`</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">check:</span> <span class=\"string\">commit_signoff</span></span><br><span class=\"line\">    <span class=\"attr\">regex:</span> <span class=\"string\">Signed-off-by:.*[A-Za-z0-9]\\s+&lt;.+@.+&gt;</span></span><br><span class=\"line\">    <span class=\"attr\">error:</span> <span class=\"string\">Signed-off-by</span> <span class=\"string\">not</span> <span class=\"string\">found</span> <span class=\"string\">in</span> <span class=\"string\">latest</span> <span class=\"string\">commit</span></span><br><span class=\"line\">    <span class=\"attr\">suggest:</span> <span class=\"string\">Run</span> <span class=\"string\">command</span> <span class=\"string\">`git</span> <span class=\"string\">commit</span> <span class=\"string\">-m</span> <span class=\"string\">&quot;conventional commit message&quot;</span> <span class=\"string\">--signoff`</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">check:</span> <span class=\"string\">merge_base</span></span><br><span class=\"line\">    <span class=\"attr\">regex:</span> <span class=\"string\">main</span> <span class=\"comment\"># it can be master, develop, devel etc. based on your project.</span></span><br><span class=\"line\">    <span class=\"attr\">error:</span> <span class=\"string\">Current</span> <span class=\"string\">branch</span> <span class=\"string\">is</span> <span class=\"string\">not</span> <span class=\"string\">rebased</span> <span class=\"string\">onto</span> <span class=\"string\">target</span> <span class=\"string\">branch</span></span><br><span class=\"line\">    <span class=\"attr\">suggest:</span> <span class=\"string\">Ensure</span> <span class=\"string\">your</span> <span class=\"string\">branch</span> <span class=\"string\">is</span> <span class=\"string\">rebased</span> <span class=\"string\">with</span> <span class=\"string\">the</span> <span class=\"string\">target</span> <span class=\"string\">branch</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"用法\"><a href=\"#用法\" class=\"headerlink\" title=\"用法\"></a>用法</h2><h3 id=\"作为-GitHub-Actions\"><a href=\"#作为-GitHub-Actions\" class=\"headerlink\" title=\"作为 GitHub Actions\"></a>作为 GitHub Actions</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">name:</span> <span class=\"string\">Commit</span> <span class=\"string\">Check</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">on:</span></span><br><span class=\"line\">  <span class=\"attr\">push:</span></span><br><span class=\"line\">  <span class=\"attr\">pull_request:</span></span><br><span class=\"line\">    <span class=\"attr\">branches:</span> <span class=\"string\">&#x27;main&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">jobs:</span></span><br><span class=\"line\">  <span class=\"attr\">commit-check:</span></span><br><span class=\"line\">    <span class=\"attr\">runs-on:</span> <span class=\"string\">ubuntu-latest</span></span><br><span class=\"line\">    <span class=\"attr\">permissions:</span>  <span class=\"comment\"># use permissions because of pr-comments</span></span><br><span class=\"line\">      <span class=\"attr\">contents:</span> <span class=\"string\">read</span></span><br><span class=\"line\">      <span class=\"attr\">pull-requests:</span> <span class=\"string\">write</span></span><br><span class=\"line\">    <span class=\"attr\">steps:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">uses:</span> <span class=\"string\">actions/checkout@v4</span></span><br><span class=\"line\">        <span class=\"attr\">with:</span></span><br><span class=\"line\">          <span class=\"attr\">ref:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">github.event.pull_request.head.sha</span> <span class=\"string\">&#125;&#125;</span>  <span class=\"comment\"># checkout PR HEAD commit</span></span><br><span class=\"line\">          <span class=\"attr\">fetch-depth:</span> <span class=\"number\">0</span>  <span class=\"comment\"># required for merge-base check</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">uses:</span> <span class=\"string\">commit-check/commit-check-action@v1</span></span><br><span class=\"line\">        <span class=\"attr\">env:</span></span><br><span class=\"line\">          <span class=\"attr\">GITHUB_TOKEN:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">secrets.GITHUB_TOKEN</span> <span class=\"string\">&#125;&#125;</span> <span class=\"comment\"># required for pr-comments</span></span><br><span class=\"line\">        <span class=\"attr\">with:</span></span><br><span class=\"line\">          <span class=\"attr\">message:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">          <span class=\"attr\">branch:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">          <span class=\"attr\">author-name:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">          <span class=\"attr\">author-email:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">          <span class=\"attr\">commit-signoff:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">          <span class=\"attr\">merge-base:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">          <span class=\"attr\">job-summary:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">          <span class=\"attr\">pr-comments:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">github.event_name</span> <span class=\"string\">==</span> <span class=\"string\">&#x27;pull_request&#x27;</span> <span class=\"string\">&#125;&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"作为-pre-commit-hook\"><a href=\"#作为-pre-commit-hook\" class=\"headerlink\" title=\"作为 pre-commit hook\"></a>作为 pre-commit hook</h3><p>将以下配置添加到 <code>.pre-commit-config.yaml</code> 文件：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">-</span>   <span class=\"attr\">repo:</span> <span class=\"string\">https://github.com/commit-check/commit-check</span></span><br><span class=\"line\">    <span class=\"attr\">rev:</span> <span class=\"string\">the</span> <span class=\"string\">tag</span> <span class=\"string\">or</span> <span class=\"string\">revision</span></span><br><span class=\"line\">    <span class=\"attr\">hooks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span>   <span class=\"attr\">id:</span> <span class=\"string\">check-message</span>  <span class=\"comment\"># requires hook prepare-commit-msg</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span>   <span class=\"attr\">id:</span> <span class=\"string\">check-branch</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span>   <span class=\"attr\">id:</span> <span class=\"string\">check-author-name</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span>   <span class=\"attr\">id:</span> <span class=\"string\">check-author-email</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span>   <span class=\"attr\">id:</span> <span class=\"string\">check-commit-signoff</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span>   <span class=\"attr\">id:</span> <span class=\"string\">check-merge-base</span> <span class=\"comment\"># requires downloading all git history</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"作为-CLI-工具\"><a href=\"#作为-CLI-工具\" class=\"headerlink\" title=\"作为 CLI 工具\"></a>作为 CLI 工具</h3><p>从 PyPI 安装：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">pip install commit-check</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># example</span></span><br><span class=\"line\">commit-check --message --branch --author-name --author-email --commit-signoff --merge-base</span><br></pre></td></tr></table></figure>\n\n<p>更多用法详见 <a href=\"https://github.com/commit-check/commit-check\">README</a>。</p>\n<hr>\n<p>如果有任何问题或建议，欢迎在 <a href=\"https://github.com/commit-check/commit-check/issues\">GitHub Issues</a> 中提出。</p>\n<hr>\n<p>转载本站文章请注明作者和出处，请勿用于任何商业用途。欢迎关注公众号「DevOps攻城狮」</p>\n","more":"<h3 id=\"1-pr-comments-自动添加检查结果到-Pull-Request\"><a href=\"#1-pr-comments-自动添加检查结果到-Pull-Request\" class=\"headerlink\" title=\"1. pr-comments: 自动添加检查结果到 Pull Request\"></a>1. pr-comments: 自动添加检查结果到 Pull Request</h3><p>在团队合作开发中，PR 通常是代码审核的主要入口。为了让代码检查结果更直观，pr-comments 提供了一种新方式：</p>\n<p>当代码提交触发 CI&#x2F;CD Pipeline 后，commit-check 会自动在 Pull Request 界面中以评论形式呈现检查结果。</p>\n<p>无需额外点击或切换到日志文件，开发者可以直接在 PR 的对话区域查看检测结果，方便快速定位问题。</p>\n<p>成功和失败的示例效果：</p>\n<p><img src=\"/2024/11/commit-check-updates/success-pr-comments.png\" alt=\"pr-comments success\"></p>\n<p><img src=\"/2024/11/commit-check-updates/failure-pr-comments.png\" alt=\"pr-comments failure\"></p>\n<p>**注：**pr-comments 仅支持 <a href=\"https://github.com/commit-check/commit-check-action\">commit-check-action</a>。</p>\n<h3 id=\"2-base-merge-确保分支基于目标分支\"><a href=\"#2-base-merge-确保分支基于目标分支\" class=\"headerlink\" title=\"2. base-merge: 确保分支基于目标分支\"></a>2. base-merge: 确保分支基于目标分支</h3><p>在开发过程中，有些团队希望每个 Pull Request 都基于最新的目标分支进行开发。</p>\n<p>commit-check 提供了一个新的选项：<code>base-merge</code>，可以帮助团队确保分支已 rebase 到指定的目标分支（例如 main 或 master）。</p>\n<ul>\n<li>自动检查当前分支是否基于指定目标分支。</li>\n<li>如果检测到基线不正确，commit-check 会返回错误信息，让 CI Pipeline 失败，并提供明确的提示。</li>\n</ul>\n<p><strong>注：</strong> base-merge 支持 <a href=\"https://github.com/commit-check/commit-check\">commit-check</a> 和 <a href=\"https://github.com/commit-check/commit-check-action\">commit-check-action</a>。</p>\n<hr>\n<h2 id=\"什么是-Commit-Check\"><a href=\"#什么是-Commit-Check\" class=\"headerlink\" title=\"什么是 Commit Check\"></a>什么是 Commit Check</h2><p>如果你还不了解 Commit Check，这里简单介绍一下：</p>\n<p><strong>Commit Check</strong> 是一个免费且强大的工具，用于强制执行提交元数据标准，包括提交消息、分支命名、提交者姓名&#x2F;邮箱以及提交签名。它的错误信息和建议命令可以完全自定义，确保团队之间的一致性。</p>\n<p>作为 <a href=\"https://docs.github.com/en/enterprise-server@3.11/repositories/configuring-branches-and-merges-in-your-repository/managing-rulesets/available-rules-for-rulesets#metadata-restrictions\">GitHub Enterprise 元数据限制</a> 和 Bitbucket 付费插件 <a href=\"https://marketplace.atlassian.com/apps/1211854/yet-another-commit-checker?tab=overview&hosting=datacenter\">Yet Another Commit Checker</a> 的替代方案，Commit Check 通过集成 DevOps 原则和基础设施即代码（IaC）脱颖而出。</p>\n<p>它是目前针对 Conventional Commit 和 Branch 支持最好的免费开源解决方案。</p>\n<hr>\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><h3 id=\"使用默认配置\"><a href=\"#使用默认配置\" class=\"headerlink\" title=\"使用默认配置\"></a>使用默认配置</h3><p>如果没有设置 <code>.commit-check.yml</code>，Commit Check 将使用默认配置。提交消息将遵循 Conventional Commits 规则，分支命名遵循 Conventional Branch 规则。</p>\n<h3 id=\"自定义配置\"><a href=\"#自定义配置\" class=\"headerlink\" title=\"自定义配置\"></a>自定义配置</h3><p>如果需要更改配置，可以在 <code>.commit-check.yml</code> 中进行自定义：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">checks:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">check:</span> <span class=\"string\">message</span></span><br><span class=\"line\">    <span class=\"attr\">regex:</span> <span class=\"string\">&#x27;^(build|chore|ci|docs|feat|fix|perf|refactor|revert|style|test)&#123;1&#125;(\\([\\w\\-\\.]+\\))?(!)?: ([\\w ])+([\\s\\S]*)|(Merge).*|(fixup!.*)&#x27;</span></span><br><span class=\"line\">    <span class=\"attr\">error:</span> <span class=\"string\">&quot;The commit message should be structured as follows:\\n\\n</span></span><br><span class=\"line\"><span class=\"string\">    &lt;type&gt;[optional scope]: &lt;description&gt;\\n</span></span><br><span class=\"line\"><span class=\"string\">    [optional body]\\n</span></span><br><span class=\"line\"><span class=\"string\">    [optional footer(s)]\\n\\n</span></span><br><span class=\"line\"><span class=\"string\">    More details please refer to https://www.conventionalcommits.org&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">suggest:</span> <span class=\"string\">Please</span> <span class=\"string\">check</span> <span class=\"string\">your</span> <span class=\"string\">commit</span> <span class=\"string\">message</span> <span class=\"string\">against</span> <span class=\"string\">the</span> <span class=\"string\">above</span> <span class=\"string\">regex.</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">check:</span> <span class=\"string\">branch</span></span><br><span class=\"line\">    <span class=\"attr\">regex:</span> <span class=\"string\">^(bugfix|feature|release|hotfix|task|chore)\\/.+|(master)|(main)|(HEAD)|(PR-.+)</span></span><br><span class=\"line\">    <span class=\"attr\">error:</span> <span class=\"string\">&quot;Branches must begin with these types: bugfix/ feature/ release/ hotfix/ task/ chore/&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">suggest:</span> <span class=\"string\">Run</span> <span class=\"string\">command</span> <span class=\"string\">`git</span> <span class=\"string\">checkout</span> <span class=\"string\">-b</span> <span class=\"string\">type/branch_name`</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">check:</span> <span class=\"string\">author_name</span></span><br><span class=\"line\">    <span class=\"attr\">regex:</span> <span class=\"string\">^[A-Za-z</span> <span class=\"string\">,.\\&#x27;-]+$|.*(\\[bot])</span></span><br><span class=\"line\">    <span class=\"attr\">error:</span> <span class=\"string\">The</span> <span class=\"string\">committer</span> <span class=\"string\">name</span> <span class=\"string\">seems</span> <span class=\"string\">invalid</span></span><br><span class=\"line\">    <span class=\"attr\">suggest:</span> <span class=\"string\">Run</span> <span class=\"string\">command</span> <span class=\"string\">`git</span> <span class=\"string\">config</span> <span class=\"string\">user.name</span> <span class=\"string\">&quot;Your Name&quot;</span><span class=\"string\">`</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">check:</span> <span class=\"string\">author_email</span></span><br><span class=\"line\">    <span class=\"attr\">regex:</span> <span class=\"string\">^.+@.+$</span></span><br><span class=\"line\">    <span class=\"attr\">error:</span> <span class=\"string\">The</span> <span class=\"string\">committer</span> <span class=\"string\">email</span> <span class=\"string\">seems</span> <span class=\"string\">invalid</span></span><br><span class=\"line\">    <span class=\"attr\">suggest:</span> <span class=\"string\">Run</span> <span class=\"string\">command</span> <span class=\"string\">`git</span> <span class=\"string\">config</span> <span class=\"string\">user.email</span> <span class=\"string\">yourname@example.com`</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">check:</span> <span class=\"string\">commit_signoff</span></span><br><span class=\"line\">    <span class=\"attr\">regex:</span> <span class=\"string\">Signed-off-by:.*[A-Za-z0-9]\\s+&lt;.+@.+&gt;</span></span><br><span class=\"line\">    <span class=\"attr\">error:</span> <span class=\"string\">Signed-off-by</span> <span class=\"string\">not</span> <span class=\"string\">found</span> <span class=\"string\">in</span> <span class=\"string\">latest</span> <span class=\"string\">commit</span></span><br><span class=\"line\">    <span class=\"attr\">suggest:</span> <span class=\"string\">Run</span> <span class=\"string\">command</span> <span class=\"string\">`git</span> <span class=\"string\">commit</span> <span class=\"string\">-m</span> <span class=\"string\">&quot;conventional commit message&quot;</span> <span class=\"string\">--signoff`</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">check:</span> <span class=\"string\">merge_base</span></span><br><span class=\"line\">    <span class=\"attr\">regex:</span> <span class=\"string\">main</span> <span class=\"comment\"># it can be master, develop, devel etc. based on your project.</span></span><br><span class=\"line\">    <span class=\"attr\">error:</span> <span class=\"string\">Current</span> <span class=\"string\">branch</span> <span class=\"string\">is</span> <span class=\"string\">not</span> <span class=\"string\">rebased</span> <span class=\"string\">onto</span> <span class=\"string\">target</span> <span class=\"string\">branch</span></span><br><span class=\"line\">    <span class=\"attr\">suggest:</span> <span class=\"string\">Ensure</span> <span class=\"string\">your</span> <span class=\"string\">branch</span> <span class=\"string\">is</span> <span class=\"string\">rebased</span> <span class=\"string\">with</span> <span class=\"string\">the</span> <span class=\"string\">target</span> <span class=\"string\">branch</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"用法\"><a href=\"#用法\" class=\"headerlink\" title=\"用法\"></a>用法</h2><h3 id=\"作为-GitHub-Actions\"><a href=\"#作为-GitHub-Actions\" class=\"headerlink\" title=\"作为 GitHub Actions\"></a>作为 GitHub Actions</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">name:</span> <span class=\"string\">Commit</span> <span class=\"string\">Check</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">on:</span></span><br><span class=\"line\">  <span class=\"attr\">push:</span></span><br><span class=\"line\">  <span class=\"attr\">pull_request:</span></span><br><span class=\"line\">    <span class=\"attr\">branches:</span> <span class=\"string\">&#x27;main&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">jobs:</span></span><br><span class=\"line\">  <span class=\"attr\">commit-check:</span></span><br><span class=\"line\">    <span class=\"attr\">runs-on:</span> <span class=\"string\">ubuntu-latest</span></span><br><span class=\"line\">    <span class=\"attr\">permissions:</span>  <span class=\"comment\"># use permissions because of pr-comments</span></span><br><span class=\"line\">      <span class=\"attr\">contents:</span> <span class=\"string\">read</span></span><br><span class=\"line\">      <span class=\"attr\">pull-requests:</span> <span class=\"string\">write</span></span><br><span class=\"line\">    <span class=\"attr\">steps:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">uses:</span> <span class=\"string\">actions/checkout@v4</span></span><br><span class=\"line\">        <span class=\"attr\">with:</span></span><br><span class=\"line\">          <span class=\"attr\">ref:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">github.event.pull_request.head.sha</span> <span class=\"string\">&#125;&#125;</span>  <span class=\"comment\"># checkout PR HEAD commit</span></span><br><span class=\"line\">          <span class=\"attr\">fetch-depth:</span> <span class=\"number\">0</span>  <span class=\"comment\"># required for merge-base check</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">uses:</span> <span class=\"string\">commit-check/commit-check-action@v1</span></span><br><span class=\"line\">        <span class=\"attr\">env:</span></span><br><span class=\"line\">          <span class=\"attr\">GITHUB_TOKEN:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">secrets.GITHUB_TOKEN</span> <span class=\"string\">&#125;&#125;</span> <span class=\"comment\"># required for pr-comments</span></span><br><span class=\"line\">        <span class=\"attr\">with:</span></span><br><span class=\"line\">          <span class=\"attr\">message:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">          <span class=\"attr\">branch:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">          <span class=\"attr\">author-name:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">          <span class=\"attr\">author-email:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">          <span class=\"attr\">commit-signoff:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">          <span class=\"attr\">merge-base:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">          <span class=\"attr\">job-summary:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">          <span class=\"attr\">pr-comments:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">github.event_name</span> <span class=\"string\">==</span> <span class=\"string\">&#x27;pull_request&#x27;</span> <span class=\"string\">&#125;&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"作为-pre-commit-hook\"><a href=\"#作为-pre-commit-hook\" class=\"headerlink\" title=\"作为 pre-commit hook\"></a>作为 pre-commit hook</h3><p>将以下配置添加到 <code>.pre-commit-config.yaml</code> 文件：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">-</span>   <span class=\"attr\">repo:</span> <span class=\"string\">https://github.com/commit-check/commit-check</span></span><br><span class=\"line\">    <span class=\"attr\">rev:</span> <span class=\"string\">the</span> <span class=\"string\">tag</span> <span class=\"string\">or</span> <span class=\"string\">revision</span></span><br><span class=\"line\">    <span class=\"attr\">hooks:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span>   <span class=\"attr\">id:</span> <span class=\"string\">check-message</span>  <span class=\"comment\"># requires hook prepare-commit-msg</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span>   <span class=\"attr\">id:</span> <span class=\"string\">check-branch</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span>   <span class=\"attr\">id:</span> <span class=\"string\">check-author-name</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span>   <span class=\"attr\">id:</span> <span class=\"string\">check-author-email</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span>   <span class=\"attr\">id:</span> <span class=\"string\">check-commit-signoff</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span>   <span class=\"attr\">id:</span> <span class=\"string\">check-merge-base</span> <span class=\"comment\"># requires downloading all git history</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"作为-CLI-工具\"><a href=\"#作为-CLI-工具\" class=\"headerlink\" title=\"作为 CLI 工具\"></a>作为 CLI 工具</h3><p>从 PyPI 安装：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">pip install commit-check</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># example</span></span><br><span class=\"line\">commit-check --message --branch --author-name --author-email --commit-signoff --merge-base</span><br></pre></td></tr></table></figure>\n\n<p>更多用法详见 <a href=\"https://github.com/commit-check/commit-check\">README</a>。</p>\n<hr>\n<p>如果有任何问题或建议，欢迎在 <a href=\"https://github.com/commit-check/commit-check/issues\">GitHub Issues</a> 中提出。</p>\n<hr>\n<p>转载本站文章请注明作者和出处，请勿用于任何商业用途。欢迎关注公众号「DevOps攻城狮」</p>","categories":[{"name":"DevOps","path":"api/categories/DevOps.json"}],"tags":[{"name":"DevOps","path":"api/tags/DevOps.json"},{"name":"commit-check","path":"api/tags/commit-check.json"}]}