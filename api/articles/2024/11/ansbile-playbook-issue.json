{"title":"PowerShell is not recognized as an internal or external command","slug":"2024/11/ansbile-playbook-issue","date":"2024-11-17T16:00:00.000Z","updated":"2025-04-06T17:46:41.809Z","comments":true,"path":"api/articles/2024/11/ansbile-playbook-issue.json","excerpt":"Recently, while setting up a new Windows Server 2022, I encountered an issue where my Ansible playbook, which previously worked without problems, failed to execute.Here’s the configuration I used for the Windows host in my Ansible inventory:","covers":null,"content":"<p>Recently, while setting up a new Windows Server 2022, I encountered an issue where my Ansible playbook, which previously worked without problems, failed to execute.</p>\n<p>Here’s the configuration I used for the Windows host in my Ansible inventory:</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[jenkins-agent-windows:vars]</span></span><br><span class=\"line\"><span class=\"attr\">ansible_user</span>=</span><br><span class=\"line\"><span class=\"attr\">ansible_ssh_pass</span>=</span><br><span class=\"line\"><span class=\"attr\">ansible_connection</span>=winrm</span><br><span class=\"line\"><span class=\"attr\">ansible_winrm_transport</span>=ntlm</span><br><span class=\"line\"><span class=\"attr\">ansible_winrm_server_cert_validation</span>=ignore</span><br></pre></td></tr></table></figure>\n\n<p>However, when I ran the playbook, the following error occurred:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">winrm send_input failed;</span><br><span class=\"line\">stdout:</span><br><span class=\"line\">stderr <span class=\"string\">&#x27;PowerShell&#x27;</span> is not recognized as an internal or external <span class=\"built_in\">command</span>, operable program or batch file.</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Cause-of-the-Issue\"><a href=\"#Cause-of-the-Issue\" class=\"headerlink\" title=\"Cause of the Issue\"></a>Cause of the Issue</h2><p>This is usually the case when the SYSTEM’s <code>PATH</code> environment variable has been changed and is no longer able to find <code>PowerShell.exe</code> in the path.</p>\n<p>Please verify the PATH environment contains the entry <code>C:\\Windows\\System32\\WindowsPowerShell\\v1.0</code> in there.</p>\n<h2 id=\"Solution\"><a href=\"#Solution\" class=\"headerlink\" title=\"Solution\"></a>Solution</h2><p>Right-click This PC &gt; Properties &gt; Advanced system settings &gt; Environment Variables.</p>\n<p>After adding <code>C:\\Windows\\System32\\WindowsPowerShell\\v1.0</code> to <code>PATH</code>, the error disappeared, and my Ansible playbook executed successfully.</p>\n","more":"<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[jenkins-agent-windows:vars]</span></span><br><span class=\"line\"><span class=\"attr\">ansible_user</span>=</span><br><span class=\"line\"><span class=\"attr\">ansible_ssh_pass</span>=</span><br><span class=\"line\"><span class=\"attr\">ansible_connection</span>=winrm</span><br><span class=\"line\"><span class=\"attr\">ansible_winrm_transport</span>=ntlm</span><br><span class=\"line\"><span class=\"attr\">ansible_winrm_server_cert_validation</span>=ignore</span><br></pre></td></tr></table></figure>\n\n<p>However, when I ran the playbook, the following error occurred:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">winrm send_input failed;</span><br><span class=\"line\">stdout:</span><br><span class=\"line\">stderr <span class=\"string\">&#x27;PowerShell&#x27;</span> is not recognized as an internal or external <span class=\"built_in\">command</span>, operable program or batch file.</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Cause-of-the-Issue\"><a href=\"#Cause-of-the-Issue\" class=\"headerlink\" title=\"Cause of the Issue\"></a>Cause of the Issue</h2><p>This is usually the case when the SYSTEM’s <code>PATH</code> environment variable has been changed and is no longer able to find <code>PowerShell.exe</code> in the path.</p>\n<p>Please verify the PATH environment contains the entry <code>C:\\Windows\\System32\\WindowsPowerShell\\v1.0</code> in there.</p>\n<h2 id=\"Solution\"><a href=\"#Solution\" class=\"headerlink\" title=\"Solution\"></a>Solution</h2><p>Right-click This PC &gt; Properties &gt; Advanced system settings &gt; Environment Variables.</p>\n<p>After adding <code>C:\\Windows\\System32\\WindowsPowerShell\\v1.0</code> to <code>PATH</code>, the error disappeared, and my Ansible playbook executed successfully.</p>","categories":[{"name":"DevOps","path":"api/categories/DevOps.json"}],"tags":[{"name":"Ansible","path":"api/tags/Ansible.json"}]}