{"title":"解决通过 Jenkins Artifactory plugin 上传 artifacts 失败的问题 “unable to find valid certification path to requested target”","slug":"2023/09/unable-to-find-valid-certification-path","date":"2023-09-11T10:53:26.000Z","updated":"2024-09-29T16:12:45.760Z","comments":true,"path":"api/articles/2023/09/unable-to-find-valid-certification-path.json","excerpt":null,"covers":null,"content":"<p>最近遇到了通过 Jenkins agent 无法上传 artifacts 到 Artifactory 的情况，具体错误如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[2023-09-11T08:21:53.385Z] Executing <span class=\"built_in\">command</span>: /bin/sh -c git <span class=\"built_in\">log</span> --pretty=format:%s -1</span><br><span class=\"line\">[2023-09-11T08:21:54.250Z] [consumer_0] Deploying artifact: https://artifactory.mycompany.com/artifactory/generic-int-den/my-project/hotfix/1.2.0.HF5/3/pj120_bin_opt_SunOS_3792bcf.tar.Z</span><br><span class=\"line\"></span><br><span class=\"line\">[2023-09-11T08:21:54.269Z] Error occurred <span class=\"keyword\">for</span> request GET /artifactory/api/system/version HTTP/1.1: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target.</span><br><span class=\"line\">[2023-09-11T08:21:54.282Z] Error occurred <span class=\"keyword\">for</span> request PUT /artifactory/generic-int-den/my-project/hotfix/1.2.0.HF5/3/pj120_bin_opt_SunOS_3792bcf.tar.Z;build.timestamp=1694418199972;build.name=hotfix%2F1.2.0.HF5;build.number=3 HTTP/1.1: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target.</span><br><span class=\"line\">[2023-09-11T08:21:54.284Z] [consumer_0] An exception occurred during execution:</span><br><span class=\"line\">[2023-09-11T08:21:54.284Z] java.lang.RuntimeException: javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</span><br><span class=\"line\">[2023-09-11T08:21:54.284Z] \tat org.jfrog.build.extractor.clientConfiguration.util.spec.SpecDeploymentConsumer.consumerRun(SpecDeploymentConsumer.java:44)</span><br><span class=\"line\">[2023-09-11T08:21:54.284Z] \tat org.jfrog.build.extractor.producerConsumer.ConsumerRunnableBase.run(ConsumerRunnableBase.java:11)</span><br><span class=\"line\">[2023-09-11T08:21:54.284Z] \tat java.lang.Thread.run(Thread.java:745)</span><br><span class=\"line\">[2023-09-11T08:21:54.285Z] Caused by: javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</span><br></pre></td></tr></table></figure>\n\n<p>这个问题产生的原因是通过 HTTPS 来上传文件的时候没有通过 Java 的安全认证。解决这个问题的办法就是重新生成认证文件，然后导入即可，具体的步骤如下。</p>\n<h2 id=\"生成安全认证（Security-Certificate）文件\"><a href=\"#生成安全认证（Security-Certificate）文件\" class=\"headerlink\" title=\"生成安全认证（Security Certificate）文件\"></a>生成安全认证（Security Certificate）文件</h2><p>步骤如下：</p>\n<ol>\n<li>首先生成通过浏览器打开的你的 Artifactory 网址</li>\n<li>在网址的左侧应该有一个锁的图标，点击 Connection is secure -》Certificate is valid -》Details -》 Export</li>\n<li>选择 DER-encoded binary, single certificate (*.der) 生成认证文件</li>\n</ol>\n<p>比如我生成的安全认证文件的名字叫：<code>artifactory.mycompany.der</code>（名字可以任意起，只要后缀名不变即可）</p>\n<h2 id=\"通过命令行导入安全认证\"><a href=\"#通过命令行导入安全认证\" class=\"headerlink\" title=\"通过命令行导入安全认证\"></a>通过命令行导入安全认证</h2><p>登录到那台有问题的 Solaris agent，上传 <code>artifactory.mycompany.der</code> 到指定目录下，然后找到 cacerts 的路径，执行如下命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">root@mysolaris:/# keytool -import -<span class=\"built_in\">alias</span> example -keystore /usr/java/jre/lib/security/cacerts -file /tmp/artifactory.mycompany.der</span><br><span class=\"line\"><span class=\"comment\"># 然后选择 yes</span></span><br></pre></td></tr></table></figure>\n\n<p>这时候会提示你输入密码，默认密码为 <code>changeit</code>，输入即可。然后重启你的 JVM 或是 VM。等再次通过该 Agent 上传 artifacts，一切恢复正常。</p>\n<blockquote>\n<p>可参考： <a href=\"https://stackoverflow.com/questions/21076179/pkix-path-building-failed-and-unable-to-find-valid-certification-path-to-requ\">https://stackoverflow.com/questions/21076179/pkix-path-building-failed-and-unable-to-find-valid-certification-path-to-requ</a></p>\n</blockquote>\n<hr>\n<p>转载本站文章请注明作者和出处，请勿用于任何商业用途。欢迎关注公众号「DevOps攻城狮」</p>\n","more":"<p>最近遇到了通过 Jenkins agent 无法上传 artifacts 到 Artifactory 的情况，具体错误如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[2023-09-11T08:21:53.385Z] Executing <span class=\"built_in\">command</span>: /bin/sh -c git <span class=\"built_in\">log</span> --pretty=format:%s -1</span><br><span class=\"line\">[2023-09-11T08:21:54.250Z] [consumer_0] Deploying artifact: https://artifactory.mycompany.com/artifactory/generic-int-den/my-project/hotfix/1.2.0.HF5/3/pj120_bin_opt_SunOS_3792bcf.tar.Z</span><br><span class=\"line\"></span><br><span class=\"line\">[2023-09-11T08:21:54.269Z] Error occurred <span class=\"keyword\">for</span> request GET /artifactory/api/system/version HTTP/1.1: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target.</span><br><span class=\"line\">[2023-09-11T08:21:54.282Z] Error occurred <span class=\"keyword\">for</span> request PUT /artifactory/generic-int-den/my-project/hotfix/1.2.0.HF5/3/pj120_bin_opt_SunOS_3792bcf.tar.Z;build.timestamp=1694418199972;build.name=hotfix%2F1.2.0.HF5;build.number=3 HTTP/1.1: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target.</span><br><span class=\"line\">[2023-09-11T08:21:54.284Z] [consumer_0] An exception occurred during execution:</span><br><span class=\"line\">[2023-09-11T08:21:54.284Z] java.lang.RuntimeException: javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</span><br><span class=\"line\">[2023-09-11T08:21:54.284Z] \tat org.jfrog.build.extractor.clientConfiguration.util.spec.SpecDeploymentConsumer.consumerRun(SpecDeploymentConsumer.java:44)</span><br><span class=\"line\">[2023-09-11T08:21:54.284Z] \tat org.jfrog.build.extractor.producerConsumer.ConsumerRunnableBase.run(ConsumerRunnableBase.java:11)</span><br><span class=\"line\">[2023-09-11T08:21:54.284Z] \tat java.lang.Thread.run(Thread.java:745)</span><br><span class=\"line\">[2023-09-11T08:21:54.285Z] Caused by: javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</span><br></pre></td></tr></table></figure>\n\n<p>这个问题产生的原因是通过 HTTPS 来上传文件的时候没有通过 Java 的安全认证。解决这个问题的办法就是重新生成认证文件，然后导入即可，具体的步骤如下。</p>\n<h2 id=\"生成安全认证（Security-Certificate）文件\"><a href=\"#生成安全认证（Security-Certificate）文件\" class=\"headerlink\" title=\"生成安全认证（Security Certificate）文件\"></a>生成安全认证（Security Certificate）文件</h2><p>步骤如下：</p>\n<ol>\n<li>首先生成通过浏览器打开的你的 Artifactory 网址</li>\n<li>在网址的左侧应该有一个锁的图标，点击 Connection is secure -》Certificate is valid -》Details -》 Export</li>\n<li>选择 DER-encoded binary, single certificate (*.der) 生成认证文件</li>\n</ol>\n<p>比如我生成的安全认证文件的名字叫：<code>artifactory.mycompany.der</code>（名字可以任意起，只要后缀名不变即可）</p>\n<h2 id=\"通过命令行导入安全认证\"><a href=\"#通过命令行导入安全认证\" class=\"headerlink\" title=\"通过命令行导入安全认证\"></a>通过命令行导入安全认证</h2><p>登录到那台有问题的 Solaris agent，上传 <code>artifactory.mycompany.der</code> 到指定目录下，然后找到 cacerts 的路径，执行如下命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">root@mysolaris:/# keytool -import -<span class=\"built_in\">alias</span> example -keystore /usr/java/jre/lib/security/cacerts -file /tmp/artifactory.mycompany.der</span><br><span class=\"line\"><span class=\"comment\"># 然后选择 yes</span></span><br></pre></td></tr></table></figure>\n\n<p>这时候会提示你输入密码，默认密码为 <code>changeit</code>，输入即可。然后重启你的 JVM 或是 VM。等再次通过该 Agent 上传 artifacts，一切恢复正常。</p>\n<blockquote>\n<p>可参考： <a href=\"https://stackoverflow.com/questions/21076179/pkix-path-building-failed-and-unable-to-find-valid-certification-path-to-requ\">https://stackoverflow.com/questions/21076179/pkix-path-building-failed-and-unable-to-find-valid-certification-path-to-requ</a></p>\n</blockquote>\n<hr>\n<p>转载本站文章请注明作者和出处，请勿用于任何商业用途。欢迎关注公众号「DevOps攻城狮」</p>\n","categories":[{"name":"Artifactory","path":"api/categories/Artifactory.json"}],"tags":[{"name":"Java","path":"api/tags/Java.json"},{"name":"Jenkins","path":"api/tags/Jenkins.json"},{"name":"Artifactory","path":"api/tags/Artifactory.json"}]}