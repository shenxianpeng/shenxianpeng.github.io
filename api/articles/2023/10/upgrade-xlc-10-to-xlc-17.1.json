{"title":"Problems and solutions when upgrading XLC from 10.1 to IBM Open XL C/C++ for AIX 17.1.0","slug":"2023/10/upgrade-xlc-10-to-xlc-17.1","date":"2023-10-08T10:53:26.000Z","updated":"2024-08-12T17:26:47.768Z","comments":true,"path":"api/articles/2023/10/upgrade-xlc-10-to-xlc-17.1.json","excerpt":null,"covers":null,"content":"<p>In this article, I would like to document the problems encountered when upgrading from IBM XLC 10.1 to XLC 17.1 (IBM Open XL C&#x2F;C++ for AIX 17.1.0) and how to fix the following 12 errors.</p>\n<p>If you’ve encountered any other errors, feel free to share your comments with or without a solution.</p>\n<h2 id=\"1-Change-cc-to-ibm-clang\"><a href=\"#1-Change-cc-to-ibm-clang\" class=\"headerlink\" title=\"1. Change cc to ibm-clang\"></a>1. Change cc to ibm-clang</h2><p>First you need to change all the related <code>cc</code> to <code>ibm-clang</code> in the the global Makefile. for example:</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- CC=cc</span></span><br><span class=\"line\"><span class=\"deletion\">- CXX=xlC_r</span></span><br><span class=\"line\"><span class=\"deletion\">- XCC=xlC_r</span></span><br><span class=\"line\"><span class=\"deletion\">- MAKE_SHARED=xlC_r</span></span><br><span class=\"line\"><span class=\"addition\">+ CC=ibm-clang</span></span><br><span class=\"line\"><span class=\"addition\">+ CXX=ibm-clang_r</span></span><br><span class=\"line\"><span class=\"addition\">+ XCC=ibm-clang_r</span></span><br><span class=\"line\"><span class=\"addition\">+ MAKE_SHARED=ibm-clang_r</span></span><br></pre></td></tr></table></figure>\n\n<p>And check following link of <a href=\"https://www.ibm.com/docs/en/openxl-c-and-cpp-aix/17.1.0?topic=options-mapping\">Mapping of options</a> to map new Clang options if any.</p>\n<h2 id=\"2-error-unknown-argument-‘-qmakedep-gcc’\"><a href=\"#2-error-unknown-argument-‘-qmakedep-gcc’\" class=\"headerlink\" title=\"2. error: unknown argument: ‘-qmakedep&#x3D;gcc’\"></a>2. error: unknown argument: ‘-qmakedep&#x3D;gcc’</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- GEN_DEPENDENTS_OPTIONS=-qmakedep=gcc  -E -MF $@.1 &gt; /dev/null</span></span><br><span class=\"line\"><span class=\"addition\">+ GEN_DEPENDENTS_OPTIONS= -E -MF $@.1 &gt; /dev/null</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-should-not-return-a-value-Wreturn-type\"><a href=\"#3-should-not-return-a-value-Wreturn-type\" class=\"headerlink\" title=\"3. should not return a value [-Wreturn-type]\"></a>3. should not return a value [-Wreturn-type]</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- return -1;</span></span><br><span class=\"line\"><span class=\"addition\">+ return;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-error-non-void-function-‘main’-should-return-a-value-Wreturn-type\"><a href=\"#4-error-non-void-function-‘main’-should-return-a-value-Wreturn-type\" class=\"headerlink\" title=\"4. error: non-void function ‘main’ should return a value [-Wreturn-type]\"></a>4. error: non-void function ‘main’ should return a value [-Wreturn-type]</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- return;</span></span><br><span class=\"line\"><span class=\"addition\">+ return 0;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-error-unsupported-option-‘-G’-for-target-‘powerpc64-ibm-aix7-3-0-0’\"><a href=\"#5-error-unsupported-option-‘-G’-for-target-‘powerpc64-ibm-aix7-3-0-0’\" class=\"headerlink\" title=\"5. error: unsupported option ‘-G’ for target ‘powerpc64-ibm-aix7.3.0.0’\"></a>5. error: unsupported option ‘-G’ for target ‘powerpc64-ibm-aix7.3.0.0’</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- LIB_101_FLAGS := -G</span></span><br><span class=\"line\"><span class=\"addition\">+ LIB_101_FLAGS := -shared -Wl,-G</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"6-Undefined-symbol-libxxxx-so\"><a href=\"#6-Undefined-symbol-libxxxx-so\" class=\"headerlink\" title=\"6. Undefined symbol (libxxxx.so)\"></a>6. Undefined symbol (libxxxx.so)</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- LIB_10_FLAGS := -bexport:$(SRC)/makefiles/xxxx.def</span></span><br><span class=\"line\"><span class=\"addition\">+ LIB_10_FLAGS := -lstdc++ -lm -bexport:$(SRC)/makefiles/xxxx.def</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"7-unsupported-option-qlongdouble\"><a href=\"#7-unsupported-option-qlongdouble\" class=\"headerlink\" title=\"7. unsupported option -qlongdouble\"></a>7. unsupported option -qlongdouble</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- drv_connect.c.CC_OPTIONS=$(CFLAGS) -qlongdouble -brtl</span></span><br><span class=\"line\"><span class=\"addition\">+ drv_loadfunc.c.CC_OPTIONS=$(CFLAGS) $(IDIR) -brtl</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"8-Undefined-symbol-Z8u9-closei\"><a href=\"#8-Undefined-symbol-Z8u9-closei\" class=\"headerlink\" title=\"8. Undefined symbol: ._Z8u9_closei\"></a>8. Undefined symbol: ._Z8u9_closei</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- extern int u9_close(int fd) ;</span></span><br><span class=\"line\"><span class=\"addition\">+ extern &quot;C&quot; int u9_close(int fd) ;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"9-ERROR-Undefined-symbol-pow\"><a href=\"#9-ERROR-Undefined-symbol-pow\" class=\"headerlink\" title=\"9. ERROR: Undefined symbol: .pow\"></a>9. ERROR: Undefined symbol: .pow</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- CXXLIBES = -lpthread -lC -lstdc++</span></span><br><span class=\"line\"><span class=\"addition\">+ CXXLIBES = -lpthread -lC -lstdc++ -lm</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"10-‘main’-argument-array-must-be-of-type-‘char-’\"><a href=\"#10-‘main’-argument-array-must-be-of-type-‘char-’\" class=\"headerlink\" title=\"10. ‘main’ (argument array) must be of type ‘char **’\"></a>10. ‘main’ (argument array) must be of type ‘char **’</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- d_char *argv[];</span></span><br><span class=\"line\"><span class=\"addition\">+ char *argv[];</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"11-first-parameter-of-‘main’-argument-count-must-be-of-type-‘int’\"><a href=\"#11-first-parameter-of-‘main’-argument-count-must-be-of-type-‘int’\" class=\"headerlink\" title=\"11. first parameter of ‘main’ (argument count) must be of type ‘int’\"></a>11. first parameter of ‘main’ (argument count) must be of type ‘int’</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- int main(char *argc, char *argv[])</span></span><br><span class=\"line\"><span class=\"addition\">+ int main(int argc, char *argv[])</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"12-ERROR-Undefined-symbol-ZdaPv\"><a href=\"#12-ERROR-Undefined-symbol-ZdaPv\" class=\"headerlink\" title=\"12. ERROR: Undefined symbol: ._ZdaPv\"></a>12. ERROR: Undefined symbol: ._ZdaPv</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- LIB_3_LIBS\t:= -lverse -llog_nosig</span></span><br><span class=\"line\"><span class=\"addition\">+ LIB_3_LIBS\t:= -lverse -llog_nosig -lstdc++</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<p>转载本站文章请注明作者和出处，请勿用于任何商业用途。欢迎关注公众号「DevOps攻城狮」</p>\n","more":"<p>In this article, I would like to document the problems encountered when upgrading from IBM XLC 10.1 to XLC 17.1 (IBM Open XL C&#x2F;C++ for AIX 17.1.0) and how to fix the following 12 errors.</p>\n<p>If you’ve encountered any other errors, feel free to share your comments with or without a solution.</p>\n<h2 id=\"1-Change-cc-to-ibm-clang\"><a href=\"#1-Change-cc-to-ibm-clang\" class=\"headerlink\" title=\"1. Change cc to ibm-clang\"></a>1. Change cc to ibm-clang</h2><p>First you need to change all the related <code>cc</code> to <code>ibm-clang</code> in the the global Makefile. for example:</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- CC=cc</span></span><br><span class=\"line\"><span class=\"deletion\">- CXX=xlC_r</span></span><br><span class=\"line\"><span class=\"deletion\">- XCC=xlC_r</span></span><br><span class=\"line\"><span class=\"deletion\">- MAKE_SHARED=xlC_r</span></span><br><span class=\"line\"><span class=\"addition\">+ CC=ibm-clang</span></span><br><span class=\"line\"><span class=\"addition\">+ CXX=ibm-clang_r</span></span><br><span class=\"line\"><span class=\"addition\">+ XCC=ibm-clang_r</span></span><br><span class=\"line\"><span class=\"addition\">+ MAKE_SHARED=ibm-clang_r</span></span><br></pre></td></tr></table></figure>\n\n<p>And check following link of <a href=\"https://www.ibm.com/docs/en/openxl-c-and-cpp-aix/17.1.0?topic=options-mapping\">Mapping of options</a> to map new Clang options if any.</p>\n<h2 id=\"2-error-unknown-argument-‘-qmakedep-gcc’\"><a href=\"#2-error-unknown-argument-‘-qmakedep-gcc’\" class=\"headerlink\" title=\"2. error: unknown argument: ‘-qmakedep&#x3D;gcc’\"></a>2. error: unknown argument: ‘-qmakedep&#x3D;gcc’</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- GEN_DEPENDENTS_OPTIONS=-qmakedep=gcc  -E -MF $@.1 &gt; /dev/null</span></span><br><span class=\"line\"><span class=\"addition\">+ GEN_DEPENDENTS_OPTIONS= -E -MF $@.1 &gt; /dev/null</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-should-not-return-a-value-Wreturn-type\"><a href=\"#3-should-not-return-a-value-Wreturn-type\" class=\"headerlink\" title=\"3. should not return a value [-Wreturn-type]\"></a>3. should not return a value [-Wreturn-type]</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- return -1;</span></span><br><span class=\"line\"><span class=\"addition\">+ return;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-error-non-void-function-‘main’-should-return-a-value-Wreturn-type\"><a href=\"#4-error-non-void-function-‘main’-should-return-a-value-Wreturn-type\" class=\"headerlink\" title=\"4. error: non-void function ‘main’ should return a value [-Wreturn-type]\"></a>4. error: non-void function ‘main’ should return a value [-Wreturn-type]</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- return;</span></span><br><span class=\"line\"><span class=\"addition\">+ return 0;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-error-unsupported-option-‘-G’-for-target-‘powerpc64-ibm-aix7-3-0-0’\"><a href=\"#5-error-unsupported-option-‘-G’-for-target-‘powerpc64-ibm-aix7-3-0-0’\" class=\"headerlink\" title=\"5. error: unsupported option ‘-G’ for target ‘powerpc64-ibm-aix7.3.0.0’\"></a>5. error: unsupported option ‘-G’ for target ‘powerpc64-ibm-aix7.3.0.0’</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- LIB_101_FLAGS := -G</span></span><br><span class=\"line\"><span class=\"addition\">+ LIB_101_FLAGS := -shared -Wl,-G</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"6-Undefined-symbol-libxxxx-so\"><a href=\"#6-Undefined-symbol-libxxxx-so\" class=\"headerlink\" title=\"6. Undefined symbol (libxxxx.so)\"></a>6. Undefined symbol (libxxxx.so)</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- LIB_10_FLAGS := -bexport:$(SRC)/makefiles/xxxx.def</span></span><br><span class=\"line\"><span class=\"addition\">+ LIB_10_FLAGS := -lstdc++ -lm -bexport:$(SRC)/makefiles/xxxx.def</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"7-unsupported-option-qlongdouble\"><a href=\"#7-unsupported-option-qlongdouble\" class=\"headerlink\" title=\"7. unsupported option -qlongdouble\"></a>7. unsupported option -qlongdouble</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- drv_connect.c.CC_OPTIONS=$(CFLAGS) -qlongdouble -brtl</span></span><br><span class=\"line\"><span class=\"addition\">+ drv_loadfunc.c.CC_OPTIONS=$(CFLAGS) $(IDIR) -brtl</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"8-Undefined-symbol-Z8u9-closei\"><a href=\"#8-Undefined-symbol-Z8u9-closei\" class=\"headerlink\" title=\"8. Undefined symbol: ._Z8u9_closei\"></a>8. Undefined symbol: ._Z8u9_closei</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- extern int u9_close(int fd) ;</span></span><br><span class=\"line\"><span class=\"addition\">+ extern &quot;C&quot; int u9_close(int fd) ;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"9-ERROR-Undefined-symbol-pow\"><a href=\"#9-ERROR-Undefined-symbol-pow\" class=\"headerlink\" title=\"9. ERROR: Undefined symbol: .pow\"></a>9. ERROR: Undefined symbol: .pow</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- CXXLIBES = -lpthread -lC -lstdc++</span></span><br><span class=\"line\"><span class=\"addition\">+ CXXLIBES = -lpthread -lC -lstdc++ -lm</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"10-‘main’-argument-array-must-be-of-type-‘char-’\"><a href=\"#10-‘main’-argument-array-must-be-of-type-‘char-’\" class=\"headerlink\" title=\"10. ‘main’ (argument array) must be of type ‘char **’\"></a>10. ‘main’ (argument array) must be of type ‘char **’</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- d_char *argv[];</span></span><br><span class=\"line\"><span class=\"addition\">+ char *argv[];</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"11-first-parameter-of-‘main’-argument-count-must-be-of-type-‘int’\"><a href=\"#11-first-parameter-of-‘main’-argument-count-must-be-of-type-‘int’\" class=\"headerlink\" title=\"11. first parameter of ‘main’ (argument count) must be of type ‘int’\"></a>11. first parameter of ‘main’ (argument count) must be of type ‘int’</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- int main(char *argc, char *argv[])</span></span><br><span class=\"line\"><span class=\"addition\">+ int main(int argc, char *argv[])</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"12-ERROR-Undefined-symbol-ZdaPv\"><a href=\"#12-ERROR-Undefined-symbol-ZdaPv\" class=\"headerlink\" title=\"12. ERROR: Undefined symbol: ._ZdaPv\"></a>12. ERROR: Undefined symbol: ._ZdaPv</h2><figure class=\"highlight diff\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- LIB_3_LIBS\t:= -lverse -llog_nosig</span></span><br><span class=\"line\"><span class=\"addition\">+ LIB_3_LIBS\t:= -lverse -llog_nosig -lstdc++</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<p>转载本站文章请注明作者和出处，请勿用于任何商业用途。欢迎关注公众号「DevOps攻城狮」</p>\n","categories":[{"name":"AIX","path":"api/categories/AIX.json"}],"tags":[{"name":"AIX","path":"api/tags/AIX.json"},{"name":"Clang","path":"api/tags/Clang.json"},{"name":"XLC","path":"api/tags/XLC.json"},{"name":"IBM","path":"api/tags/IBM.json"}]}