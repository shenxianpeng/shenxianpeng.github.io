{"title":"Nightwatch 异步操作","slug":"2017/10/nightwatch-async-operation","date":"2017-10-21T13:26:43.000Z","updated":"2023-12-26T03:33:12.094Z","comments":true,"path":"api/articles/2017/10/nightwatch-async-operation.json","excerpt":null,"covers":null,"content":"<p>在自动化测试中常常需要通过一个 command（或 function ）中返回的值来进行下一步的操作，JavaScript 与 JAVA 在调用返回值时有所不同，JS 中需要特定的写法来进行这种异步操作。</p>\n<p>以下面的 get License 数量为例，首先需要 get 一次 License 数量，然后进行一些列操作之后，再一次 get License 数量，比较这两次 License 数量值。</p>\n<p>getLicenseNum 方法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">getLicenseNum</span>: <span class=\"keyword\">function</span> (<span class=\"params\">cb</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> license = <span class=\"string\">&#x27;ul &gt; li.license-id.ng-binding&#x27;</span>;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">waitForElementVisible</span>(license, <span class=\"number\">5000</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">api</span>.<span class=\"title function_\">elements</span>(<span class=\"string\">&#x27;css selector&#x27;</span>, license, <span class=\"keyword\">function</span> (<span class=\"params\">result</span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">cb</span>(result.<span class=\"property\">value</span>.<span class=\"property\">length</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>对两次得到的 License num 进行比较：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;JavaScrpit asynchronous operation&#x27;</span>: <span class=\"keyword\">function</span>(<span class=\"params\">client</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> license = client.<span class=\"property\">page</span>.<span class=\"title function_\">license</span>();</span><br><span class=\"line\">    <span class=\"keyword\">let</span> num1, num2;</span><br><span class=\"line\">    license.<span class=\"title function_\">getLicenseNum</span>(<span class=\"keyword\">function</span>(<span class=\"params\">num</span>) &#123;</span><br><span class=\"line\">        num1 = num;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    license.<span class=\"title function_\">getLicenseNum</span>(<span class=\"keyword\">function</span>(<span class=\"params\">num</span>) &#123;</span><br><span class=\"line\">        num2 = num;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    client.<span class=\"title function_\">perform</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        client.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(num2 - num1, <span class=\"number\">1</span>, <span class=\"string\">&#x27;license number increase 1&#x27;</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","more":"<p>在自动化测试中常常需要通过一个 command（或 function ）中返回的值来进行下一步的操作，JavaScript 与 JAVA 在调用返回值时有所不同，JS 中需要特定的写法来进行这种异步操作。</p>\n<p>以下面的 get License 数量为例，首先需要 get 一次 License 数量，然后进行一些列操作之后，再一次 get License 数量，比较这两次 License 数量值。</p>\n<p>getLicenseNum 方法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">getLicenseNum</span>: <span class=\"keyword\">function</span> (<span class=\"params\">cb</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> license = <span class=\"string\">&#x27;ul &gt; li.license-id.ng-binding&#x27;</span>;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">waitForElementVisible</span>(license, <span class=\"number\">5000</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">api</span>.<span class=\"title function_\">elements</span>(<span class=\"string\">&#x27;css selector&#x27;</span>, license, <span class=\"keyword\">function</span> (<span class=\"params\">result</span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">cb</span>(result.<span class=\"property\">value</span>.<span class=\"property\">length</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>对两次得到的 License num 进行比较：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;JavaScrpit asynchronous operation&#x27;</span>: <span class=\"keyword\">function</span>(<span class=\"params\">client</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> license = client.<span class=\"property\">page</span>.<span class=\"title function_\">license</span>();</span><br><span class=\"line\">    <span class=\"keyword\">let</span> num1, num2;</span><br><span class=\"line\">    license.<span class=\"title function_\">getLicenseNum</span>(<span class=\"keyword\">function</span>(<span class=\"params\">num</span>) &#123;</span><br><span class=\"line\">        num1 = num;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    license.<span class=\"title function_\">getLicenseNum</span>(<span class=\"keyword\">function</span>(<span class=\"params\">num</span>) &#123;</span><br><span class=\"line\">        num2 = num;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    client.<span class=\"title function_\">perform</span>(<span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        client.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(num2 - num1, <span class=\"number\">1</span>, <span class=\"string\">&#x27;license number increase 1&#x27;</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":[{"name":"Automation","path":"api/categories/Automation.json"}],"tags":[{"name":"Nightwatch","path":"api/tags/Nightwatch.json"},{"name":"Automation","path":"api/tags/Automation.json"}]}