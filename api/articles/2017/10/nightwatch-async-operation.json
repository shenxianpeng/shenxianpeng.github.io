{"title":"Nightwatch 异步操作","slug":"2017/10/nightwatch-async-operation","date":"2017-10-21T13:26:43.000Z","updated":"2020-05-12T08:18:10.196Z","comments":true,"path":"api/articles/2017/10/nightwatch-async-operation.json","excerpt":null,"covers":null,"content":"<p>在自动化测试中常常需要通过一个 command（或 function ）中返回的值来进行下一步的操作，JavaScript 与 JAVA 在调用返回值时有所不同，JS 中需要特定的写法来进行这种异步操作。</p>\n<p>以下面的 get License 数量为例，首先需要 get 一次 License 数量，然后进行一些列操作之后，再一次 get License 数量，比较这两次 License 数量值。</p>\n<p>getLicenseNum 方法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getLicenseNum: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">cb</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> license = <span class=\"string\">'ul &gt; li.license-id.ng-binding'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.waitForElementVisible(license, <span class=\"number\">5000</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.api.elements(<span class=\"string\">'css selector'</span>, license, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">result</span>) </span>&#123;</span><br><span class=\"line\">        cb(result.value.length);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>对两次得到的 License num 进行比较：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">'JavaScrpit asynchronous operation'</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">client</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> license = client.page.license();</span><br><span class=\"line\">    <span class=\"keyword\">let</span> num1, num2;</span><br><span class=\"line\">    license.getLicenseNum(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">        num1 = num;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    license.getLicenseNum(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">        num2 = num;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    client.perform(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        client.assert.equal(num2 - num1, <span class=\"number\">1</span>, <span class=\"string\">'license number increase 1'</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","more":"<p>在自动化测试中常常需要通过一个 command（或 function ）中返回的值来进行下一步的操作，JavaScript 与 JAVA 在调用返回值时有所不同，JS 中需要特定的写法来进行这种异步操作。</p>\n<p>以下面的 get License 数量为例，首先需要 get 一次 License 数量，然后进行一些列操作之后，再一次 get License 数量，比较这两次 License 数量值。</p>\n<p>getLicenseNum 方法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getLicenseNum: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">cb</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> license = <span class=\"string\">'ul &gt; li.license-id.ng-binding'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.waitForElementVisible(license, <span class=\"number\">5000</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.api.elements(<span class=\"string\">'css selector'</span>, license, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">result</span>) </span>&#123;</span><br><span class=\"line\">        cb(result.value.length);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>对两次得到的 License num 进行比较：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">'JavaScrpit asynchronous operation'</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">client</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> license = client.page.license();</span><br><span class=\"line\">    <span class=\"keyword\">let</span> num1, num2;</span><br><span class=\"line\">    license.getLicenseNum(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">        num1 = num;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    license.getLicenseNum(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">        num2 = num;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    client.perform(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        client.assert.equal(num2 - num1, <span class=\"number\">1</span>, <span class=\"string\">'license number increase 1'</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":[{"name":"Automation","path":"api/categories/Automation.json"}],"tags":[{"name":"Automation","path":"api/tags/Automation.json"},{"name":"Nightwatch","path":"api/tags/Nightwatch.json"}]}