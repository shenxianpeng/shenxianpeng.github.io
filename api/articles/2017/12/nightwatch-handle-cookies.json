{"title":"Nightwatch 得到和验证 cookies","slug":"2017/12/nightwatch-handle-cookies","date":"2017-12-14T06:21:56.000Z","updated":"2023-11-30T09:08:41.869Z","comments":true,"path":"api/articles/2017/12/nightwatch-handle-cookies.json","excerpt":null,"covers":null,"content":"<h2 id=\"测试用例\"><a href=\"#测试用例\" class=\"headerlink\" title=\"测试用例\"></a>测试用例</h2><p>验证登录 cookies 和清除 access_token。测试用例设计如下</p>\n<h2 id=\"测试用例设计\"><a href=\"#测试用例设计\" class=\"headerlink\" title=\"测试用例设计\"></a>测试用例设计</h2><p>登录系统时，不选择记住我按钮，验证 cookies</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">client.<span class=\"title function_\">getCookies</span>(<span class=\"keyword\">function</span> <span class=\"title function_\">cb</span>(<span class=\"params\">result</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(result.<span class=\"property\">value</span>.<span class=\"property\">length</span>, <span class=\"number\">3</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(result.<span class=\"property\">value</span>[<span class=\"number\">0</span>].<span class=\"property\">name</span>, <span class=\"string\">&#x27;domain&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(result.<span class=\"property\">value</span>[<span class=\"number\">1</span>].<span class=\"property\">name</span>, <span class=\"string\">&#x27;user_id&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(result.<span class=\"property\">value</span>[<span class=\"number\">2</span>].<span class=\"property\">name</span>, <span class=\"string\">&#x27;access_token&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>登录系统时，选择记住我按钮，验证 cookies</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">client.<span class=\"title function_\">getCookies</span>(<span class=\"keyword\">function</span> <span class=\"title function_\">cb</span>(<span class=\"params\">result</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(result.<span class=\"property\">value</span>.<span class=\"property\">length</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(result.<span class=\"property\">value</span>[<span class=\"number\">0</span>].<span class=\"property\">name</span>, <span class=\"string\">&#x27;domain&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(result.<span class=\"property\">value</span>[<span class=\"number\">1</span>].<span class=\"property\">name</span>, <span class=\"string\">&#x27;user_id&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(result.<span class=\"property\">value</span>[<span class=\"number\">2</span>].<span class=\"property\">name</span>, <span class=\"string\">&#x27;identifier&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(result.<span class=\"property\">value</span>[<span class=\"number\">3</span>].<span class=\"property\">name</span>, <span class=\"string\">&#x27;access_token&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(result.<span class=\"property\">value</span>[<span class=\"number\">4</span>].<span class=\"property\">name</span>, <span class=\"string\">&#x27;persistent_token&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>登录系统时，不选择记住我按钮，删除 cookies</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> accesstoken;</span><br><span class=\"line\">client.<span class=\"title function_\">getCookies</span>(<span class=\"keyword\">function</span> <span class=\"title function_\">cb</span>(<span class=\"params\">result</span>) &#123;</span><br><span class=\"line\">    accesstoken = result.<span class=\"property\">value</span>[<span class=\"number\">2</span>].<span class=\"property\">name</span>;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">deleteCookie</span>(accesstoken, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// refresh current page, logout</span></span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">refresh</span>().<span class=\"title function_\">waitForElementVisible</span>(<span class=\"string\">&#x27;div.login-form&#x27;</span>, <span class=\"number\">5000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>登录系统时，选择记住我按钮，删除 cookies</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> accesstoken;</span><br><span class=\"line\">client.<span class=\"title function_\">getCookies</span>(<span class=\"keyword\">function</span> <span class=\"title function_\">cb</span>(<span class=\"params\">result</span>) &#123;</span><br><span class=\"line\">    accesstoken = result.<span class=\"property\">value</span>[<span class=\"number\">3</span>].<span class=\"property\">name</span>;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">deleteCookie</span>(accesstoken, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// refresh current page, still login</span></span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">refresh</span>().<span class=\"title function_\">waitForElementVisible</span>(<span class=\"string\">&#x27;.andes-header&#x27;</span>, <span class=\"number\">5000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"如何知道登录都有哪些参数\"><a href=\"#如何知道登录都有哪些参数\" class=\"headerlink\" title=\"如何知道登录都有哪些参数\"></a>如何知道登录都有哪些参数</h2><p>事先在手动测试的时候打开 chrome 浏览器，然后按 F12，登录时查看 Network。</p>\n<p>以成功百度登录时为例，可以看到 Headers 里的参数，我们可以通过验证这些参数来确定登录成功了。</p>\n<p>这样我们就可以这些参数来实现对 cookie，token 等等参数进行自动化测试的验证。</p>\n","more":"<h2 id=\"测试用例\"><a href=\"#测试用例\" class=\"headerlink\" title=\"测试用例\"></a>测试用例</h2><p>验证登录 cookies 和清除 access_token。测试用例设计如下</p>\n<h2 id=\"测试用例设计\"><a href=\"#测试用例设计\" class=\"headerlink\" title=\"测试用例设计\"></a>测试用例设计</h2><p>登录系统时，不选择记住我按钮，验证 cookies</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">client.<span class=\"title function_\">getCookies</span>(<span class=\"keyword\">function</span> <span class=\"title function_\">cb</span>(<span class=\"params\">result</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(result.<span class=\"property\">value</span>.<span class=\"property\">length</span>, <span class=\"number\">3</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(result.<span class=\"property\">value</span>[<span class=\"number\">0</span>].<span class=\"property\">name</span>, <span class=\"string\">&#x27;domain&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(result.<span class=\"property\">value</span>[<span class=\"number\">1</span>].<span class=\"property\">name</span>, <span class=\"string\">&#x27;user_id&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(result.<span class=\"property\">value</span>[<span class=\"number\">2</span>].<span class=\"property\">name</span>, <span class=\"string\">&#x27;access_token&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>登录系统时，选择记住我按钮，验证 cookies</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">client.<span class=\"title function_\">getCookies</span>(<span class=\"keyword\">function</span> <span class=\"title function_\">cb</span>(<span class=\"params\">result</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(result.<span class=\"property\">value</span>.<span class=\"property\">length</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(result.<span class=\"property\">value</span>[<span class=\"number\">0</span>].<span class=\"property\">name</span>, <span class=\"string\">&#x27;domain&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(result.<span class=\"property\">value</span>[<span class=\"number\">1</span>].<span class=\"property\">name</span>, <span class=\"string\">&#x27;user_id&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(result.<span class=\"property\">value</span>[<span class=\"number\">2</span>].<span class=\"property\">name</span>, <span class=\"string\">&#x27;identifier&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(result.<span class=\"property\">value</span>[<span class=\"number\">3</span>].<span class=\"property\">name</span>, <span class=\"string\">&#x27;access_token&#x27;</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">assert</span>.<span class=\"title function_\">equal</span>(result.<span class=\"property\">value</span>[<span class=\"number\">4</span>].<span class=\"property\">name</span>, <span class=\"string\">&#x27;persistent_token&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>登录系统时，不选择记住我按钮，删除 cookies</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> accesstoken;</span><br><span class=\"line\">client.<span class=\"title function_\">getCookies</span>(<span class=\"keyword\">function</span> <span class=\"title function_\">cb</span>(<span class=\"params\">result</span>) &#123;</span><br><span class=\"line\">    accesstoken = result.<span class=\"property\">value</span>[<span class=\"number\">2</span>].<span class=\"property\">name</span>;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">deleteCookie</span>(accesstoken, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// refresh current page, logout</span></span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">refresh</span>().<span class=\"title function_\">waitForElementVisible</span>(<span class=\"string\">&#x27;div.login-form&#x27;</span>, <span class=\"number\">5000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>登录系统时，选择记住我按钮，删除 cookies</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> accesstoken;</span><br><span class=\"line\">client.<span class=\"title function_\">getCookies</span>(<span class=\"keyword\">function</span> <span class=\"title function_\">cb</span>(<span class=\"params\">result</span>) &#123;</span><br><span class=\"line\">    accesstoken = result.<span class=\"property\">value</span>[<span class=\"number\">3</span>].<span class=\"property\">name</span>;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">deleteCookie</span>(accesstoken, <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// refresh current page, still login</span></span><br><span class=\"line\">        <span class=\"variable language_\">this</span>.<span class=\"title function_\">refresh</span>().<span class=\"title function_\">waitForElementVisible</span>(<span class=\"string\">&#x27;.andes-header&#x27;</span>, <span class=\"number\">5000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"如何知道登录都有哪些参数\"><a href=\"#如何知道登录都有哪些参数\" class=\"headerlink\" title=\"如何知道登录都有哪些参数\"></a>如何知道登录都有哪些参数</h2><p>事先在手动测试的时候打开 chrome 浏览器，然后按 F12，登录时查看 Network。</p>\n<p>以成功百度登录时为例，可以看到 Headers 里的参数，我们可以通过验证这些参数来确定登录成功了。</p>\n<p>这样我们就可以这些参数来实现对 cookie，token 等等参数进行自动化测试的验证。</p>\n","categories":[{"name":"Automation","path":"api/categories/Automation.json"}],"tags":[{"name":"Nightwatch","path":"api/tags/Nightwatch.json"},{"name":"Javascript","path":"api/tags/Javascript.json"}]}