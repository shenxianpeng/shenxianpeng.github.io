{"title":"ERROR: Error cloning remote repo 'origin' timeout=10","slug":"2019/08/jenkins-troubleshooting","date":"2019-08-15T16:00:00.000Z","updated":"2022-03-16T16:02:27.538Z","comments":true,"path":"api/articles/2019/08/jenkins-troubleshooting.json","excerpt":"Jenkins 问题解决记录（一）最近 Jenkins Build 不知为何总是 git clone 失败，报这个错误,  ERROR: Error cloning remote repo ‘origin’。我首先怀疑是网络原因，我们的 Bitbucket 在 Git clone 时所占带宽很大造成短暂断网情况，怀疑是 IT 更改了 Bitbucket 的设置，但我手动去那台 agent 上执行却没问题，好像跟 IT 无关再看日志这里有一处显示 timeout=10，这时候我突然想起来前些日子我删除了非常大的一个文件夹，然后做了一次提交，这会导致我们的仓库增大，在做一次完整的 clone 的时候所需要的时间可能超过 Jenkins 默认 10 分钟。去 Google 搜索最后找到这个 issue JENKINS-47660，和我的问题一样。","covers":["/2019/08/jenkins-troubleshooting/advanced-clone-behaviour.png"],"content":"<h2 id=\"Jenkins-问题解决记录（一）\"><a href=\"#Jenkins-问题解决记录（一）\" class=\"headerlink\" title=\"Jenkins 问题解决记录（一）\"></a>Jenkins 问题解决记录（一）</h2><p>最近 Jenkins Build 不知为何总是 git clone 失败，报这个错误,  ERROR: Error cloning remote repo ‘origin’。</p>\n<ol>\n<li>我首先怀疑是网络原因，我们的 Bitbucket 在 Git clone 时所占带宽很大造成短暂断网情况，怀疑是 IT 更改了 Bitbucket 的设置，但我手动去那台 agent 上执行却没问题，好像跟 IT 无关</li>\n<li>再看日志这里有一处显示 timeout=10，这时候我突然想起来前些日子我删除了非常大的一个文件夹，然后做了一次提交，这会导致我们的仓库增大，在做一次完整的 clone 的时候所需要的时间可能超过 Jenkins 默认 10 分钟。</li>\n</ol>\n<p>去 Google 搜索最后找到这个 issue JENKINS-47660，和我的问题一样。</p>\n<a id=\"more\"></a>\n\n<h2 id=\"解决办法-Troubleshooting\"><a href=\"#解决办法-Troubleshooting\" class=\"headerlink\" title=\"解决办法 Troubleshooting\"></a>解决办法 Troubleshooting</h2><p>最终我找到 Git clone 有个 Behaviors 属性，找到里面的 Advanced clone behaviours 功能，将 Fetch tags 去掉（因为我暂时不用，去掉也可能减少那么一丁点的时间吧），勾选了 Shallow clone，然后将 Shallow clone depth 设置为 1，（这个设置等同于 –depth 1），Timeout 时间从 10 分钟改为 15 分钟。最终的设置如图：</p>\n<p><img src=\"/2019/08/jenkins-troubleshooting/advanced-clone-behaviour.png\" alt=\"Advanced clone behaviours\"></p>\n<h2 id=\"Full-Log-below\"><a href=\"#Full-Log-below\" class=\"headerlink\" title=\"Full Log below\"></a>Full Log below</h2><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">using credential d1cbab74-823d-41aa-abb7</span><br><span class=\"line\"> Wiping out workspace first.</span><br><span class=\"line\"> Cloning the remote Git repository</span><br><span class=\"line\"> Cloning with configured refspecs honoured and without tags</span><br><span class=\"line\"> Cloning repository https:&#x2F;&#x2F;git.company.com&#x2F;scm&#x2F;db&#x2F;blog.git</span><br><span class=\"line\">  &gt; C:\\Program Files\\Git\\bin\\git.exe init C:\\agent\\workspace\\develop # timeout&#x3D;10</span><br><span class=\"line\"> Fetching upstream changes from https:&#x2F;&#x2F;git.company.com&#x2F;scm&#x2F;db&#x2F;blog.git</span><br><span class=\"line\">  &gt; C:\\Program Files\\Git\\bin\\git.exe --version # timeout&#x3D;10</span><br><span class=\"line\"> using GIT_ASKPASS to set credentials blwmv</span><br><span class=\"line\">  &gt; C:\\Program Files\\Git\\bin\\git.exe fetch --no-tags --progress https:&#x2F;&#x2F;git.company.com&#x2F;scm&#x2F;db&#x2F;blog.git +refs&#x2F;heads&#x2F;develop:refs&#x2F;remotes&#x2F;origin&#x2F;develop</span><br><span class=\"line\"> ERROR: Error cloning remote repo &#39;origin&#39;</span><br><span class=\"line\"> hudson.plugins.git.GitException: Command &quot;C:\\Program Files\\Git\\bin\\git.exe fetch --no-tags --progress https:&#x2F;&#x2F;git.company.com&#x2F;scm&#x2F;db&#x2F;blog.git +refs&#x2F;heads&#x2F;develop:refs&#x2F;remotes&#x2F;origin&#x2F;develop&quot; returned status code 130:</span><br><span class=\"line\"> stdout:</span><br><span class=\"line\"> stderr: remote: Counting objects: 1</span><br><span class=\"line\">remote: Counting objects: 242690, done.</span><br><span class=\"line\"> remote: Compressing objects:   0% (1&#x2F;75028)</span><br><span class=\"line\">remote: Compressing objects:   1% (751&#x2F;75028)</span><br><span class=\"line\">remote: Compressing objects:   2% (1501&#x2F;75028)</span><br><span class=\"line\">remote: Compressing objects:   3% (2251&#x2F;75028)</span><br><span class=\"line\">remote: Compressing objects:   4% (3002&#x2F;75028)</span><br><span class=\"line\">remote: Compressing objects:   5% (3752&#x2F;75028)</span><br><span class=\"line\">... ...</span><br><span class=\"line\">remote: Compressing objects: 100% (75028&#x2F;75028), done.</span><br><span class=\"line\"> Receiving objects:   0% (1&#x2F;242690)</span><br><span class=\"line\">Receiving objects:   1% (2427&#x2F;242690)</span><br><span class=\"line\">Receiving objects:   1% (4762&#x2F;242690), 972.00 KiB | 949.00 KiB&#x2F;s</span><br><span class=\"line\">Receiving objects:   2% (4854&#x2F;242690), 972.00 KiB | 949.00 KiB&#x2F;s</span><br><span class=\"line\">Receiving objects:   3% (7281&#x2F;242690), 1.38 MiB | 919.00 KiB&#x2F;s</span><br><span class=\"line\">Receiving objects:   3% (8998&#x2F;242690), 1.82 MiB | 645.00 KiB&#x2F;s</span><br><span class=\"line\">Receiving objects:   4% (9708&#x2F;242690), 1.82 MiB | 645.00 KiB&#x2F;s</span><br><span class=\"line\">Receiving objects:   4% (9778&#x2F;242690), 1.82 MiB | 645.00 KiB&#x2F;s</span><br><span class=\"line\">Receiving objects:   5% (12135&#x2F;242690), 1.82 MiB | 645.00 KiB&#x2F;s</span><br><span class=\"line\">... ...</span><br><span class=\"line\">Receiving objects:  86% (209321&#x2F;242690), 1.01 GiB | 2.08 MiB&#x2F;s</span><br><span class=\"line\"> \tat org.jenkinsci.plugins.gitclient.CliGitAPIImpl.launchCommandIn(CliGitAPIImpl.java:2042)</span><br><span class=\"line\"> \tat org.jenkinsci.plugins.gitclient.CliGitAPIImpl.launchCommandWithCredentials(CliGitAPIImpl.java:1761)</span><br><span class=\"line\"> \tat org.jenkinsci.plugins.gitclient.CliGitAPIImpl.access$400(CliGitAPIImpl.java:72)</span><br><span class=\"line\"> \tat org.jenkinsci.plugins.gitclient.CliGitAPIImpl$1.execute(CliGitAPIImpl.java:442)</span><br><span class=\"line\"> \tat org.jenkinsci.plugins.gitclient.CliGitAPIImpl$2.execute(CliGitAPIImpl.java:655)</span><br><span class=\"line\"> \tat org.jenkinsci.plugins.gitclient.RemoteGitImpl$CommandInvocationHandler$1.call(RemoteGitImpl.java:153)</span><br><span class=\"line\"> \tat org.jenkinsci.plugins.gitclient.RemoteGitImpl$CommandInvocationHandler$1.call(RemoteGitImpl.java:146)</span><br><span class=\"line\"> \tat hudson.remoting.UserRequest.perform(UserRequest.java:212)</span><br><span class=\"line\"> \tat hudson.remoting.UserRequest.perform(UserRequest.java:54)</span><br><span class=\"line\"> \tat hudson.remoting.Request$2.run(Request.java:369)</span><br><span class=\"line\"> \tat hudson.remoting.InterceptingExecutorService$1.call(InterceptingExecutorService.java:72)</span><br><span class=\"line\"> \tat java.util.concurrent.FutureTask.run(Unknown Source)</span><br><span class=\"line\"> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)</span><br><span class=\"line\"> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)</span><br><span class=\"line\"> \tat java.lang.Thread.run(Unknown Source)</span><br><span class=\"line\"> \tSuppressed: hudson.remoting.Channel$CallSiteStackTrace: Remote call to dendevu2uvbw01</span><br><span class=\"line\"> \t\tat hudson.remoting.Channel.attachCallSiteStackTrace(Channel.java:1743)</span><br><span class=\"line\"> \t\tat hudson.remoting.UserRequest$ExceptionResponse.retrieve(UserRequest.java:357)</span><br><span class=\"line\"> \t\tat hudson.remoting.Channel.call(Channel.java:957)</span><br><span class=\"line\"> \t\tat org.jenkinsci.plugins.gitclient.RemoteGitImpl$CommandInvocationHandler.execute(RemoteGitImpl.java:146)</span><br><span class=\"line\"> \t\tat sun.reflect.GeneratedMethodAccessor1074.invoke(Unknown Source)</span><br><span class=\"line\"> \t\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class=\"line\"> \t\tat java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class=\"line\"> \t\tat org.jenkinsci.plugins.gitclient.RemoteGitImpl$CommandInvocationHandler.invoke(RemoteGitImpl.java:132)</span><br><span class=\"line\"> \t\tat com.sun.proxy.$Proxy124.execute(Unknown Source)</span><br><span class=\"line\"> \t\tat hudson.plugins.git.GitSCM.retrieveChanges(GitSCM.java:1152)</span><br><span class=\"line\"> \t\tat hudson.plugins.git.GitSCM.checkout(GitSCM.java:1192)</span><br><span class=\"line\"> \t\tat org.jenkinsci.plugins.workflow.steps.scm.SCMStep.checkout(SCMStep.java:124)</span><br><span class=\"line\"> \t\tat org.jenkinsci.plugins.workflow.steps.scm.SCMStep$StepExecutionImpl.run(SCMStep.java:93)</span><br><span class=\"line\"> \t\tat org.jenkinsci.plugins.workflow.steps.scm.SCMStep$StepExecutionImpl.run(SCMStep.java:80)</span><br><span class=\"line\"> \t\tat org.jenkinsci.plugins.workflow.steps.SynchronousNonBlockingStepExecution.lambda$start$0(SynchronousNonBlockingStepExecution.java:47)</span><br><span class=\"line\"> \t\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)</span><br><span class=\"line\"> \t\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class=\"line\"> \t\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class=\"line\"> \t\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class=\"line\"> \t\tat java.lang.Thread.run(Thread.java:748)</span><br><span class=\"line\"> [Pipeline] &#125;</span><br><span class=\"line\"> [Pipeline] &#x2F;&#x2F; ws</span><br><span class=\"line\"> [Pipeline] &#125;</span><br><span class=\"line\"> [Pipeline] &#x2F;&#x2F; node</span><br><span class=\"line\"> [Pipeline] &#125;</span><br><span class=\"line\"> [Pipeline] &#x2F;&#x2F; stage</span><br><span class=\"line\"> [Pipeline] &#125;</span><br><span class=\"line\"> Failed in branch Windows build</span><br></pre></td></tr></table></figure>\n","more":"<h2 id=\"解决办法-Troubleshooting\"><a href=\"#解决办法-Troubleshooting\" class=\"headerlink\" title=\"解决办法 Troubleshooting\"></a>解决办法 Troubleshooting</h2><p>最终我找到 Git clone 有个 Behaviors 属性，找到里面的 Advanced clone behaviours 功能，将 Fetch tags 去掉（因为我暂时不用，去掉也可能减少那么一丁点的时间吧），勾选了 Shallow clone，然后将 Shallow clone depth 设置为 1，（这个设置等同于 –depth 1），Timeout 时间从 10 分钟改为 15 分钟。最终的设置如图：</p>\n<p><img src=\"/2019/08/jenkins-troubleshooting/advanced-clone-behaviour.png\" alt=\"Advanced clone behaviours\"></p>\n<h2 id=\"Full-Log-below\"><a href=\"#Full-Log-below\" class=\"headerlink\" title=\"Full Log below\"></a>Full Log below</h2><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">using credential d1cbab74-823d-41aa-abb7</span><br><span class=\"line\"> Wiping out workspace first.</span><br><span class=\"line\"> Cloning the remote Git repository</span><br><span class=\"line\"> Cloning with configured refspecs honoured and without tags</span><br><span class=\"line\"> Cloning repository https:&#x2F;&#x2F;git.company.com&#x2F;scm&#x2F;db&#x2F;blog.git</span><br><span class=\"line\">  &gt; C:\\Program Files\\Git\\bin\\git.exe init C:\\agent\\workspace\\develop # timeout&#x3D;10</span><br><span class=\"line\"> Fetching upstream changes from https:&#x2F;&#x2F;git.company.com&#x2F;scm&#x2F;db&#x2F;blog.git</span><br><span class=\"line\">  &gt; C:\\Program Files\\Git\\bin\\git.exe --version # timeout&#x3D;10</span><br><span class=\"line\"> using GIT_ASKPASS to set credentials blwmv</span><br><span class=\"line\">  &gt; C:\\Program Files\\Git\\bin\\git.exe fetch --no-tags --progress https:&#x2F;&#x2F;git.company.com&#x2F;scm&#x2F;db&#x2F;blog.git +refs&#x2F;heads&#x2F;develop:refs&#x2F;remotes&#x2F;origin&#x2F;develop</span><br><span class=\"line\"> ERROR: Error cloning remote repo &#39;origin&#39;</span><br><span class=\"line\"> hudson.plugins.git.GitException: Command &quot;C:\\Program Files\\Git\\bin\\git.exe fetch --no-tags --progress https:&#x2F;&#x2F;git.company.com&#x2F;scm&#x2F;db&#x2F;blog.git +refs&#x2F;heads&#x2F;develop:refs&#x2F;remotes&#x2F;origin&#x2F;develop&quot; returned status code 130:</span><br><span class=\"line\"> stdout:</span><br><span class=\"line\"> stderr: remote: Counting objects: 1</span><br><span class=\"line\">remote: Counting objects: 242690, done.</span><br><span class=\"line\"> remote: Compressing objects:   0% (1&#x2F;75028)</span><br><span class=\"line\">remote: Compressing objects:   1% (751&#x2F;75028)</span><br><span class=\"line\">remote: Compressing objects:   2% (1501&#x2F;75028)</span><br><span class=\"line\">remote: Compressing objects:   3% (2251&#x2F;75028)</span><br><span class=\"line\">remote: Compressing objects:   4% (3002&#x2F;75028)</span><br><span class=\"line\">remote: Compressing objects:   5% (3752&#x2F;75028)</span><br><span class=\"line\">... ...</span><br><span class=\"line\">remote: Compressing objects: 100% (75028&#x2F;75028), done.</span><br><span class=\"line\"> Receiving objects:   0% (1&#x2F;242690)</span><br><span class=\"line\">Receiving objects:   1% (2427&#x2F;242690)</span><br><span class=\"line\">Receiving objects:   1% (4762&#x2F;242690), 972.00 KiB | 949.00 KiB&#x2F;s</span><br><span class=\"line\">Receiving objects:   2% (4854&#x2F;242690), 972.00 KiB | 949.00 KiB&#x2F;s</span><br><span class=\"line\">Receiving objects:   3% (7281&#x2F;242690), 1.38 MiB | 919.00 KiB&#x2F;s</span><br><span class=\"line\">Receiving objects:   3% (8998&#x2F;242690), 1.82 MiB | 645.00 KiB&#x2F;s</span><br><span class=\"line\">Receiving objects:   4% (9708&#x2F;242690), 1.82 MiB | 645.00 KiB&#x2F;s</span><br><span class=\"line\">Receiving objects:   4% (9778&#x2F;242690), 1.82 MiB | 645.00 KiB&#x2F;s</span><br><span class=\"line\">Receiving objects:   5% (12135&#x2F;242690), 1.82 MiB | 645.00 KiB&#x2F;s</span><br><span class=\"line\">... ...</span><br><span class=\"line\">Receiving objects:  86% (209321&#x2F;242690), 1.01 GiB | 2.08 MiB&#x2F;s</span><br><span class=\"line\"> \tat org.jenkinsci.plugins.gitclient.CliGitAPIImpl.launchCommandIn(CliGitAPIImpl.java:2042)</span><br><span class=\"line\"> \tat org.jenkinsci.plugins.gitclient.CliGitAPIImpl.launchCommandWithCredentials(CliGitAPIImpl.java:1761)</span><br><span class=\"line\"> \tat org.jenkinsci.plugins.gitclient.CliGitAPIImpl.access$400(CliGitAPIImpl.java:72)</span><br><span class=\"line\"> \tat org.jenkinsci.plugins.gitclient.CliGitAPIImpl$1.execute(CliGitAPIImpl.java:442)</span><br><span class=\"line\"> \tat org.jenkinsci.plugins.gitclient.CliGitAPIImpl$2.execute(CliGitAPIImpl.java:655)</span><br><span class=\"line\"> \tat org.jenkinsci.plugins.gitclient.RemoteGitImpl$CommandInvocationHandler$1.call(RemoteGitImpl.java:153)</span><br><span class=\"line\"> \tat org.jenkinsci.plugins.gitclient.RemoteGitImpl$CommandInvocationHandler$1.call(RemoteGitImpl.java:146)</span><br><span class=\"line\"> \tat hudson.remoting.UserRequest.perform(UserRequest.java:212)</span><br><span class=\"line\"> \tat hudson.remoting.UserRequest.perform(UserRequest.java:54)</span><br><span class=\"line\"> \tat hudson.remoting.Request$2.run(Request.java:369)</span><br><span class=\"line\"> \tat hudson.remoting.InterceptingExecutorService$1.call(InterceptingExecutorService.java:72)</span><br><span class=\"line\"> \tat java.util.concurrent.FutureTask.run(Unknown Source)</span><br><span class=\"line\"> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)</span><br><span class=\"line\"> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)</span><br><span class=\"line\"> \tat java.lang.Thread.run(Unknown Source)</span><br><span class=\"line\"> \tSuppressed: hudson.remoting.Channel$CallSiteStackTrace: Remote call to dendevu2uvbw01</span><br><span class=\"line\"> \t\tat hudson.remoting.Channel.attachCallSiteStackTrace(Channel.java:1743)</span><br><span class=\"line\"> \t\tat hudson.remoting.UserRequest$ExceptionResponse.retrieve(UserRequest.java:357)</span><br><span class=\"line\"> \t\tat hudson.remoting.Channel.call(Channel.java:957)</span><br><span class=\"line\"> \t\tat org.jenkinsci.plugins.gitclient.RemoteGitImpl$CommandInvocationHandler.execute(RemoteGitImpl.java:146)</span><br><span class=\"line\"> \t\tat sun.reflect.GeneratedMethodAccessor1074.invoke(Unknown Source)</span><br><span class=\"line\"> \t\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class=\"line\"> \t\tat java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class=\"line\"> \t\tat org.jenkinsci.plugins.gitclient.RemoteGitImpl$CommandInvocationHandler.invoke(RemoteGitImpl.java:132)</span><br><span class=\"line\"> \t\tat com.sun.proxy.$Proxy124.execute(Unknown Source)</span><br><span class=\"line\"> \t\tat hudson.plugins.git.GitSCM.retrieveChanges(GitSCM.java:1152)</span><br><span class=\"line\"> \t\tat hudson.plugins.git.GitSCM.checkout(GitSCM.java:1192)</span><br><span class=\"line\"> \t\tat org.jenkinsci.plugins.workflow.steps.scm.SCMStep.checkout(SCMStep.java:124)</span><br><span class=\"line\"> \t\tat org.jenkinsci.plugins.workflow.steps.scm.SCMStep$StepExecutionImpl.run(SCMStep.java:93)</span><br><span class=\"line\"> \t\tat org.jenkinsci.plugins.workflow.steps.scm.SCMStep$StepExecutionImpl.run(SCMStep.java:80)</span><br><span class=\"line\"> \t\tat org.jenkinsci.plugins.workflow.steps.SynchronousNonBlockingStepExecution.lambda$start$0(SynchronousNonBlockingStepExecution.java:47)</span><br><span class=\"line\"> \t\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)</span><br><span class=\"line\"> \t\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class=\"line\"> \t\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class=\"line\"> \t\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class=\"line\"> \t\tat java.lang.Thread.run(Thread.java:748)</span><br><span class=\"line\"> [Pipeline] &#125;</span><br><span class=\"line\"> [Pipeline] &#x2F;&#x2F; ws</span><br><span class=\"line\"> [Pipeline] &#125;</span><br><span class=\"line\"> [Pipeline] &#x2F;&#x2F; node</span><br><span class=\"line\"> [Pipeline] &#125;</span><br><span class=\"line\"> [Pipeline] &#x2F;&#x2F; stage</span><br><span class=\"line\"> [Pipeline] &#125;</span><br><span class=\"line\"> Failed in branch Windows build</span><br></pre></td></tr></table></figure>","categories":[{"name":"Jenkins","path":"api/categories/Jenkins.json"}],"tags":[{"name":"Jenkins","path":"api/tags/Jenkins.json"},{"name":"Troubleshooting","path":"api/tags/Troubleshooting.json"}]}