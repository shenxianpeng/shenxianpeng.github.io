{"title":"Automatically commit code by Jenkins","slug":"2019/05/auto-bump-build-version","date":"2019-05-12T13:21:55.000Z","updated":"2025-04-24T18:54:49.387Z","comments":true,"path":"api/articles/2019/05/auto-bump-build-version.json","excerpt":"When we need to release a product, we should change copyright, build version, release month, release note…<br>How to modify multiple files automatically?","covers":null,"content":"<p>When we need to release a product, we should change copyright, build version, release month, release note…<br>How to modify multiple files automatically?</p>\n<span id=\"more\"></span>\n<p>I used a Jenkins pipeline project, the project is parameterized(string parameter) and regular expressions to implement.</p>\n<ol>\n<li><p>Here is the string parameter for copyright:</p>\n<ul>\n<li><p>Name: copyright</p>\n</li>\n<li><p>Default Value: 1995—2019</p>\n</li>\n<li><p>Description: Copyright format:1995—2019</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">stage(<span class=\"string\">&#x27;change copyrigh&#x27;</span>) &#123;</span><br><span class=\"line\">    steps &#123;</span><br><span class=\"line\">        sh label: <span class=\"string\">&#x27;&#x27;</span>, script: <span class=\"string\">&#x27;sed -i -E &quot;s/(1995—[0-9]&#123;4&#125;)/$&#123;copyright&#125;/&quot; 1033/AutoRun.ini&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>Here is the string parameter for build version:</p>\n<ul>\n<li><p>Name: build_version</p>\n</li>\n<li><p>Default Value: 1.2.2.1002</p>\n</li>\n<li><p>Description: build version format: 1.2.2.1002</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">stage(<span class=\"string\">&#x27;change build version&#x27;</span>) &#123;</span><br><span class=\"line\">    steps &#123;</span><br><span class=\"line\">        sh label: <span class=\"string\">&#x27;&#x27;</span>, script: <span class=\"string\">&#x27;sed -i -E &quot;s/([0-9].[0-9].[0-9].[0-9]&#123;4&#125;)/$&#123;build_version&#125;/&quot; 1033/AutoRun.ini&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>Here is the string parameter for build version:</p>\n<ul>\n<li><p>Name: release_month</p>\n</li>\n<li><p>Default Value: May 2019</p>\n</li>\n<li><p>Description: release month format: May 2019</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">stage(<span class=\"string\">&#x27;change release month&#x27;</span>) &#123;</span><br><span class=\"line\">    steps &#123;</span><br><span class=\"line\">        sh label: <span class=\"string\">&#x27;&#x27;</span>, script: <span class=\"string\">&#x27;&#x27;</span><span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"string\">        sed -i -E &quot;s/([a-z]* 20[0-9]&#123;2&#125;)/$&#123;release_month&#125;/&quot; 1033/AutoRun.ini</span></span><br><span class=\"line\"><span class=\"string\">        sed -i -E &quot;s/([a-z]* 20[0-9]&#123;2&#125;)/$&#123;release_month&#125;/&quot; 1033/MainMenu.ini</span></span><br><span class=\"line\"><span class=\"string\">        &#x27;</span><span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>push change to Git</p>\n <figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">stage(<span class=\"string\">&#x27;git push to Git&#x27;</span>) &#123;</span><br><span class=\"line\">    steps &#123;</span><br><span class=\"line\">        sshagent([<span class=\"string\">&#x27;8dd766ba-ac0f-4302-afa8-bee59c726dee&#x27;</span>]) &#123;</span><br><span class=\"line\">            sh(<span class=\"string\">&quot;git add 1033/AutoRun.ini&quot;</span>)</span><br><span class=\"line\">            sh(<span class=\"string\">&quot;git add 1033/MainMenu.ini&quot;</span>)</span><br><span class=\"line\">            sh(<span class=\"string\">&quot;git commit -m &#x27;Bld # <span class=\"variable\">$&#123;build_version&#125;</span>&#x27;&quot;</span>)</span><br><span class=\"line\">            sh(<span class=\"string\">&quot;git push -u origin master&quot;</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Whole Jenkins Pipeline looks like:</p>\n <figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">pipeline &#123;</span><br><span class=\"line\">    agent &#123;</span><br><span class=\"line\">        label <span class=\"string\">&#x27;master&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    stages&#123;</span><br><span class=\"line\">        stage(<span class=\"string\">&#x27;git clone&#x27;</span>) &#123;</span><br><span class=\"line\">            steps&#123;</span><br><span class=\"line\">                git branch: <span class=\"string\">&#x27;master&#x27;</span>,</span><br><span class=\"line\">                credentialsId: <span class=\"string\">&#x27;8dd766ba-ac0f-4302-afa8-bee59c726dee&#x27;</span>,</span><br><span class=\"line\">                url: <span class=\"string\">&#x27;git@github.com:shenxianpeng/blog.git&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        stage(<span class=\"string\">&#x27;change copyrigh&#x27;</span>) &#123;</span><br><span class=\"line\">        steps &#123;</span><br><span class=\"line\">            sh label: <span class=\"string\">&#x27;&#x27;</span>, script: <span class=\"string\">&#x27;sed -i -E &quot;s/(1995—[0-9]&#123;4&#125;)/$&#123;copyright&#125;/&quot; 1033/AutoRun.ini&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        stage(<span class=\"string\">&#x27;change release month&#x27;</span>) &#123;</span><br><span class=\"line\">        steps &#123;</span><br><span class=\"line\">            sh label: <span class=\"string\">&#x27;&#x27;</span>, script: <span class=\"string\">&#x27;&#x27;</span><span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"string\">            sed -i -E &quot;s/([a-z]* 20[0-9]&#123;2&#125;)/$&#123;release_month&#125;/&quot; 1033/AutoRun.ini</span></span><br><span class=\"line\"><span class=\"string\">            sed -i -E &quot;s/([a-z]* 20[0-9]&#123;2&#125;)/$&#123;release_month&#125;/&quot; 1033/MainMenu.ini</span></span><br><span class=\"line\"><span class=\"string\">            &#x27;</span><span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        stage(<span class=\"string\">&#x27;change build version&#x27;</span>) &#123;</span><br><span class=\"line\">        steps &#123;</span><br><span class=\"line\">            sh label: <span class=\"string\">&#x27;&#x27;</span>, script: <span class=\"string\">&#x27;sed -i -E &quot;s/([0-9].[0-9].[0-9].[0-9]&#123;4&#125;)/$&#123;build_version&#125;/&quot; 1033/AutoRun.ini&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        stage(<span class=\"string\">&#x27;git push to Git&#x27;</span>) &#123;</span><br><span class=\"line\">            steps &#123;</span><br><span class=\"line\">                sshagent([<span class=\"string\">&#x27;8dd766ba-ac0f-4302-afa8-bee59c726dee&#x27;</span>]) &#123;</span><br><span class=\"line\">                    sh(<span class=\"string\">&quot;git add 1033/AutoRun.ini&quot;</span>)</span><br><span class=\"line\">                    sh(<span class=\"string\">&quot;git add 1033/MainMenu.ini&quot;</span>)</span><br><span class=\"line\">                    sh(<span class=\"string\">&quot;git commit -m &#x27;Bld # <span class=\"variable\">$&#123;build_version&#125;</span>&#x27;&quot;</span>)</span><br><span class=\"line\">                    sh(<span class=\"string\">&quot;git push -u origin master&quot;</span>)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ol>\n","more":"<p>I used a Jenkins pipeline project, the project is parameterized(string parameter) and regular expressions to implement.</p>\n<ol>\n<li><p>Here is the string parameter for copyright:</p>\n<ul>\n<li><p>Name: copyright</p>\n</li>\n<li><p>Default Value: 1995—2019</p>\n</li>\n<li><p>Description: Copyright format:1995—2019</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">stage(<span class=\"string\">&#x27;change copyrigh&#x27;</span>) &#123;</span><br><span class=\"line\">    steps &#123;</span><br><span class=\"line\">        sh label: <span class=\"string\">&#x27;&#x27;</span>, script: <span class=\"string\">&#x27;sed -i -E &quot;s/(1995—[0-9]&#123;4&#125;)/$&#123;copyright&#125;/&quot; 1033/AutoRun.ini&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>Here is the string parameter for build version:</p>\n<ul>\n<li><p>Name: build_version</p>\n</li>\n<li><p>Default Value: 1.2.2.1002</p>\n</li>\n<li><p>Description: build version format: 1.2.2.1002</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">stage(<span class=\"string\">&#x27;change build version&#x27;</span>) &#123;</span><br><span class=\"line\">    steps &#123;</span><br><span class=\"line\">        sh label: <span class=\"string\">&#x27;&#x27;</span>, script: <span class=\"string\">&#x27;sed -i -E &quot;s/([0-9].[0-9].[0-9].[0-9]&#123;4&#125;)/$&#123;build_version&#125;/&quot; 1033/AutoRun.ini&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>Here is the string parameter for build version:</p>\n<ul>\n<li><p>Name: release_month</p>\n</li>\n<li><p>Default Value: May 2019</p>\n</li>\n<li><p>Description: release month format: May 2019</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">stage(<span class=\"string\">&#x27;change release month&#x27;</span>) &#123;</span><br><span class=\"line\">    steps &#123;</span><br><span class=\"line\">        sh label: <span class=\"string\">&#x27;&#x27;</span>, script: <span class=\"string\">&#x27;&#x27;</span><span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"string\">        sed -i -E &quot;s/([a-z]* 20[0-9]&#123;2&#125;)/$&#123;release_month&#125;/&quot; 1033/AutoRun.ini</span></span><br><span class=\"line\"><span class=\"string\">        sed -i -E &quot;s/([a-z]* 20[0-9]&#123;2&#125;)/$&#123;release_month&#125;/&quot; 1033/MainMenu.ini</span></span><br><span class=\"line\"><span class=\"string\">        &#x27;</span><span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>push change to Git</p>\n <figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">stage(<span class=\"string\">&#x27;git push to Git&#x27;</span>) &#123;</span><br><span class=\"line\">    steps &#123;</span><br><span class=\"line\">        sshagent([<span class=\"string\">&#x27;8dd766ba-ac0f-4302-afa8-bee59c726dee&#x27;</span>]) &#123;</span><br><span class=\"line\">            sh(<span class=\"string\">&quot;git add 1033/AutoRun.ini&quot;</span>)</span><br><span class=\"line\">            sh(<span class=\"string\">&quot;git add 1033/MainMenu.ini&quot;</span>)</span><br><span class=\"line\">            sh(<span class=\"string\">&quot;git commit -m &#x27;Bld # <span class=\"variable\">$&#123;build_version&#125;</span>&#x27;&quot;</span>)</span><br><span class=\"line\">            sh(<span class=\"string\">&quot;git push -u origin master&quot;</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Whole Jenkins Pipeline looks like:</p>\n <figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">pipeline &#123;</span><br><span class=\"line\">    agent &#123;</span><br><span class=\"line\">        label <span class=\"string\">&#x27;master&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    stages&#123;</span><br><span class=\"line\">        stage(<span class=\"string\">&#x27;git clone&#x27;</span>) &#123;</span><br><span class=\"line\">            steps&#123;</span><br><span class=\"line\">                git branch: <span class=\"string\">&#x27;master&#x27;</span>,</span><br><span class=\"line\">                credentialsId: <span class=\"string\">&#x27;8dd766ba-ac0f-4302-afa8-bee59c726dee&#x27;</span>,</span><br><span class=\"line\">                url: <span class=\"string\">&#x27;git@github.com:shenxianpeng/blog.git&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        stage(<span class=\"string\">&#x27;change copyrigh&#x27;</span>) &#123;</span><br><span class=\"line\">        steps &#123;</span><br><span class=\"line\">            sh label: <span class=\"string\">&#x27;&#x27;</span>, script: <span class=\"string\">&#x27;sed -i -E &quot;s/(1995—[0-9]&#123;4&#125;)/$&#123;copyright&#125;/&quot; 1033/AutoRun.ini&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        stage(<span class=\"string\">&#x27;change release month&#x27;</span>) &#123;</span><br><span class=\"line\">        steps &#123;</span><br><span class=\"line\">            sh label: <span class=\"string\">&#x27;&#x27;</span>, script: <span class=\"string\">&#x27;&#x27;</span><span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"string\">            sed -i -E &quot;s/([a-z]* 20[0-9]&#123;2&#125;)/$&#123;release_month&#125;/&quot; 1033/AutoRun.ini</span></span><br><span class=\"line\"><span class=\"string\">            sed -i -E &quot;s/([a-z]* 20[0-9]&#123;2&#125;)/$&#123;release_month&#125;/&quot; 1033/MainMenu.ini</span></span><br><span class=\"line\"><span class=\"string\">            &#x27;</span><span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        stage(<span class=\"string\">&#x27;change build version&#x27;</span>) &#123;</span><br><span class=\"line\">        steps &#123;</span><br><span class=\"line\">            sh label: <span class=\"string\">&#x27;&#x27;</span>, script: <span class=\"string\">&#x27;sed -i -E &quot;s/([0-9].[0-9].[0-9].[0-9]&#123;4&#125;)/$&#123;build_version&#125;/&quot; 1033/AutoRun.ini&#x27;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        stage(<span class=\"string\">&#x27;git push to Git&#x27;</span>) &#123;</span><br><span class=\"line\">            steps &#123;</span><br><span class=\"line\">                sshagent([<span class=\"string\">&#x27;8dd766ba-ac0f-4302-afa8-bee59c726dee&#x27;</span>]) &#123;</span><br><span class=\"line\">                    sh(<span class=\"string\">&quot;git add 1033/AutoRun.ini&quot;</span>)</span><br><span class=\"line\">                    sh(<span class=\"string\">&quot;git add 1033/MainMenu.ini&quot;</span>)</span><br><span class=\"line\">                    sh(<span class=\"string\">&quot;git commit -m &#x27;Bld # <span class=\"variable\">$&#123;build_version&#125;</span>&#x27;&quot;</span>)</span><br><span class=\"line\">                    sh(<span class=\"string\">&quot;git push -u origin master&quot;</span>)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ol>","categories":[{"name":"Jenkins","path":"api/categories/Jenkins.json"}],"tags":[{"name":"Jenkins","path":"api/tags/Jenkins.json"},{"name":"Pipeline","path":"api/tags/Pipeline.json"},{"name":"Release","path":"api/tags/Release.json"}]}