{"title":"Jenkins Windows agent configuration","slug":"2019/05/jenkins-windows-agent","date":"2019-05-12T10:39:59.000Z","updated":"2024-02-17T16:04:32.003Z","comments":true,"path":"api/articles/2019/05/jenkins-windows-agent.json","excerpt":null,"covers":null,"content":"<h2 id=\"Prepare-Java-runtime\"><a href=\"#Prepare-Java-runtime\" class=\"headerlink\" title=\"Prepare Java runtime\"></a>Prepare Java runtime</h2><h3 id=\"1-Download-Java\"><a href=\"#1-Download-Java\" class=\"headerlink\" title=\"1. Download Java\"></a>1. <a href=\"https://www.java.com/en/download/\">Download Java</a></h3><h4 id=\"2-Configure-Java-Windows-path\"><a href=\"#2-Configure-Java-Windows-path\" class=\"headerlink\" title=\"2. Configure Java Windows path\"></a>2. Configure Java Windows path</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">JAVA_HOME=C:\\Program Files\\Java\\jdk1.8.0_201</span><br><span class=\"line\">CLASSPATH=.;%JAVA_HOME%\\lib;%JAVA_HOME%\\jre\\lib</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Create-Node\"><a href=\"#Create-Node\" class=\"headerlink\" title=\"Create Node\"></a>Create Node</h2><h3 id=\"1-Jenkins-home-page-Manage-Node-New-Node-such-as-window-build-machine\"><a href=\"#1-Jenkins-home-page-Manage-Node-New-Node-such-as-window-build-machine\" class=\"headerlink\" title=\"1. Jenkins home page-&gt;Manage Node-&gt;New Node, such as window-build-machine\"></a>1. Jenkins home page-&gt;Manage Node-&gt;New Node, such as window-build-machine</h3><h4 id=\"2-List-windows-agent-settings\"><a href=\"#2-List-windows-agent-settings\" class=\"headerlink\" title=\"2. List windows agent settings\"></a>2. List windows agent settings</h4><table>\n<thead>\n<tr>\n<th>Items</th>\n<th>Settings</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Name</td>\n<td>window-build-machine</td>\n</tr>\n<tr>\n<td>Description</td>\n<td>used for windows build</td>\n</tr>\n<tr>\n<td>of executors</td>\n<td>1</td>\n</tr>\n<tr>\n<td>Remote root directory</td>\n<td>C:\\agent</td>\n</tr>\n<tr>\n<td>Labels</td>\n<td>windows, build</td>\n</tr>\n<tr>\n<td>Usage</td>\n<td>Use this node as much as possible</td>\n</tr>\n<tr>\n<td>Launch method</td>\n<td>Let Jenkins control this Windows slave as a Windows service</td>\n</tr>\n<tr>\n<td>Administrator user name</td>\n<td>.\\Administrator</td>\n</tr>\n<tr>\n<td>Password</td>\n<td>mypassword</td>\n</tr>\n<tr>\n<td>Host</td>\n<td>192.168.1.111</td>\n</tr>\n<tr>\n<td>Run service as</td>\n<td>Use Administrator account given above</td>\n</tr>\n<tr>\n<td>Availability</td>\n<td>Keep this agent online as much as paossible</td>\n</tr>\n</tbody></table>\n<h4 id=\"3-Save-then-Connect\"><a href=\"#3-Save-then-Connect\" class=\"headerlink\" title=\"3. Save then Connect\"></a>3. Save then Connect</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[2019-05-11 01:32:50] [windows-slaves] Connecting to 192.168.1.111</span><br><span class=\"line\">Checking <span class=\"keyword\">if</span> Java exists</span><br><span class=\"line\">java -version returned 1.8.0.</span><br><span class=\"line\">[2019-05-11 01:32:50] [windows-slaves] Copying jenkins-slave.xml</span><br><span class=\"line\">[2019-05-11 01:32:50] [windows-slaves] Copying slave.jar</span><br><span class=\"line\">[2019-05-11 01:32:50] [windows-slaves] Starting the service</span><br><span class=\"line\">[2019-05-11 01:32:50] [windows-slaves] Waiting <span class=\"keyword\">for</span> the service to become ready</span><br><span class=\"line\">[2019-05-11 01:32:55] [windows-slaves] Connecting to port 52,347</span><br><span class=\"line\">&lt;===[JENKINS REMOTING CAPACITY]===&gt;Remoting version: 3.29</span><br><span class=\"line\">This is a Windows agent</span><br><span class=\"line\">Agent successfully connected and online</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Troubleshooting\"><a href=\"#Troubleshooting\" class=\"headerlink\" title=\"Troubleshooting\"></a>Troubleshooting</h2><p>The following issues I met and how I fixed them.</p>\n<h3 id=\"1-ERROR-Message-not-found-for-errorCode-0xC00000AC\"><a href=\"#1-ERROR-Message-not-found-for-errorCode-0xC00000AC\" class=\"headerlink\" title=\"1. ERROR: Message not found for errorCode: 0xC00000AC\"></a>1. ERROR: Message not found for errorCode: 0xC00000AC</h3><p>You need need to install JDK, and config JAVA environment variable.</p>\n<h3 id=\"2-How-to-fix-add-windows-node-as-Windows-service-error\"><a href=\"#2-How-to-fix-add-windows-node-as-Windows-service-error\" class=\"headerlink\" title=\"2. How to fix add windows node as Windows service error\"></a>2. How to fix add windows node as Windows service error</h3><p>Ref to <a href=\"https://issues.jenkins-ci.org/browse/JENKINS-16418\">JENKINS-16418</a>.</p>\n<h3 id=\"3-org-jinterop-dcom-common-JIException-Message-not-found-for-errorCode-0x00000005\"><a href=\"#3-org-jinterop-dcom-common-JIException-Message-not-found-for-errorCode-0x00000005\" class=\"headerlink\" title=\"3. org.jinterop.dcom.common.JIException: Message not found for errorCode: 0x00000005\"></a>3. org.jinterop.dcom.common.JIException: Message not found for errorCode: 0x00000005</h3><p>Fixed permission for the following registry keys</p>\n<ol>\n<li>HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\Wow6432Node\\CLSID{72C24DD5-D70A-438B-8A42-98424B88AFB8}</li>\n<li>HKEY_CLASSES_ROOT\\CLSID{76A64158-CB41-11D1-8B02-00600806D9B6}</li>\n</ol>\n<p>Steps to fix it</p>\n<ul>\n<li>Open ‘regedit’ (as Administrator), Find (Ctrl+F) the registry key: “{72C24DD5-D70A-438B-8A42-98424B88AFB8}” in HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\Wow6432Node\\CLSID</li>\n<li>Right click and select ‘Permissions’, Change owner to administrators group (Advanced…).</li>\n<li>Change permissions for administrators group. Grant Full Control。</li>\n<li>Change owner back to TrustedInstaller (user is “NT Service\\TrustedInstaller” on local machine)</li>\n</ul>\n<p>Repeat the above steps to fix permission for HKEY_CLASSES_ROOT\\CLSID{76A64158-CB41-11D1-8B02-00600806D9B6}</p>\n<p>Finally, Restart Remote Registry Service (Administrative Tools &#x2F; Services).</p>\n<h3 id=\"4-ERROR-Unexpected-error-in-launching-an-agent\"><a href=\"#4-ERROR-Unexpected-error-in-launching-an-agent\" class=\"headerlink\" title=\"4. ERROR: Unexpected error in launching an agent\"></a>4. ERROR: Unexpected error in launching an agent</h3><p>This is probably a bug in Jenkins.</p>\n<ol>\n<li>Login remote machine and open Services find <code>jenkinsslave-C__agent</code></li>\n<li>Set startup type: Automatic</li>\n<li>Log On: select This account, type correct account and password</li>\n<li>start jenkinsslave-C__agent</li>\n</ol>\n<h3 id=\"5-Caused-by-org-jinterop-dcom-common-JIRuntimeException-Message-not-found-for-errorCode-0x800703FA\"><a href=\"#5-Caused-by-org-jinterop-dcom-common-JIRuntimeException-Message-not-found-for-errorCode-0x800703FA\" class=\"headerlink\" title=\"5. Caused by: org.jinterop.dcom.common.JIRuntimeException: Message not found for errorCode: 0x800703FA\"></a>5. Caused by: org.jinterop.dcom.common.JIRuntimeException: Message not found for errorCode: 0x800703FA</h3><p>Slave under domain account, If your slave is running under a domain account and you get an error code 0x800703FA, change a group policy:</p>\n<ol>\n<li>open the group policy editor (gpedit.msc)</li>\n<li>go to Computer Configuration-&gt;Administrative Templates-&gt;System-&gt; UserProfiles, “Do not forcefully unload the user registry at user logoff”</li>\n<li>Change the setting from “Not Configured” to “Enabled”, which disables the new User Profile Service feature (‘DisableForceUnload’ is the value added to the registry)</li>\n</ol>\n<h3 id=\"6-ERROR-Message-not-found-for-errorCode-0xC0000001-Caused-by-jcifs-smb-SmbException-Failed-to-connect-0-0-0-0-10-xxx-xxx-xxx\"><a href=\"#6-ERROR-Message-not-found-for-errorCode-0xC0000001-Caused-by-jcifs-smb-SmbException-Failed-to-connect-0-0-0-0-10-xxx-xxx-xxx\" class=\"headerlink\" title=\"6. ERROR: Message not found for errorCode: 0xC0000001 Caused by: jcifs.smb.SmbException: Failed to connect: 0.0.0.0&lt;00&gt;&#x2F;10.xxx.xxx.xxx\"></a>6. ERROR: Message not found for errorCode: 0xC0000001 Caused by: jcifs.smb.SmbException: Failed to connect: 0.0.0.0&lt;00&gt;&#x2F;10.xxx.xxx.xxx</h3><p>Need to enable SMB1</p>\n<ol>\n<li>Search in the start menu for ‘Turn Windows features on or off’ and open it.</li>\n<li>Find ‘SMB1.0&#x2F;CIFS File Sharing Support’ in the list of optional features that appears, and select the checkbox next to it.</li>\n<li>Click OK and Windows will add the selected feature.</li>\n</ol>\n<p>You’ll be asked to restart your computer as part of this process.</p>\n<h3 id=\"7-NET-Framework-2-0-or-later-is-required-on-this-computer-to-run-a-Jenkins-agent-as-a-Windows-service\"><a href=\"#7-NET-Framework-2-0-or-later-is-required-on-this-computer-to-run-a-Jenkins-agent-as-a-Windows-service\" class=\"headerlink\" title=\"7. .NET Framework 2.0 or later is required on this computer to run a Jenkins agent as a Windows service\"></a>7. .NET Framework 2.0 or later is required on this computer to run a Jenkins agent as a Windows service</h3><p>Need to upgrade your .NET Framework. Here is a <a href=\"https://shenxianpeng.github.io/2020/07/jenkins-windows-agent-connect-problem/\">link</a> for update .NET Framework.</p>\n<h3 id=\"6-more-connect-jenkins-agent-problem-on-windows\"><a href=\"#6-more-connect-jenkins-agent-problem-on-windows\" class=\"headerlink\" title=\"6. more connect jenkins agent problem on windows\"></a>6. more connect jenkins agent problem on windows</h3><p>Please refer to this link <a href=\"https://github.com/jenkinsci/windows-slaves-plugin/blob/master/docs/troubleshooting.adoc\">https://github.com/jenkinsci/windows-slaves-plugin/blob/master/docs/troubleshooting.adoc</a></p>\n","more":"<h2 id=\"Prepare-Java-runtime\"><a href=\"#Prepare-Java-runtime\" class=\"headerlink\" title=\"Prepare Java runtime\"></a>Prepare Java runtime</h2><h3 id=\"1-Download-Java\"><a href=\"#1-Download-Java\" class=\"headerlink\" title=\"1. Download Java\"></a>1. <a href=\"https://www.java.com/en/download/\">Download Java</a></h3><h4 id=\"2-Configure-Java-Windows-path\"><a href=\"#2-Configure-Java-Windows-path\" class=\"headerlink\" title=\"2. Configure Java Windows path\"></a>2. Configure Java Windows path</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">JAVA_HOME=C:\\Program Files\\Java\\jdk1.8.0_201</span><br><span class=\"line\">CLASSPATH=.;%JAVA_HOME%\\lib;%JAVA_HOME%\\jre\\lib</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Create-Node\"><a href=\"#Create-Node\" class=\"headerlink\" title=\"Create Node\"></a>Create Node</h2><h3 id=\"1-Jenkins-home-page-Manage-Node-New-Node-such-as-window-build-machine\"><a href=\"#1-Jenkins-home-page-Manage-Node-New-Node-such-as-window-build-machine\" class=\"headerlink\" title=\"1. Jenkins home page-&gt;Manage Node-&gt;New Node, such as window-build-machine\"></a>1. Jenkins home page-&gt;Manage Node-&gt;New Node, such as window-build-machine</h3><h4 id=\"2-List-windows-agent-settings\"><a href=\"#2-List-windows-agent-settings\" class=\"headerlink\" title=\"2. List windows agent settings\"></a>2. List windows agent settings</h4><table>\n<thead>\n<tr>\n<th>Items</th>\n<th>Settings</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Name</td>\n<td>window-build-machine</td>\n</tr>\n<tr>\n<td>Description</td>\n<td>used for windows build</td>\n</tr>\n<tr>\n<td>of executors</td>\n<td>1</td>\n</tr>\n<tr>\n<td>Remote root directory</td>\n<td>C:\\agent</td>\n</tr>\n<tr>\n<td>Labels</td>\n<td>windows, build</td>\n</tr>\n<tr>\n<td>Usage</td>\n<td>Use this node as much as possible</td>\n</tr>\n<tr>\n<td>Launch method</td>\n<td>Let Jenkins control this Windows slave as a Windows service</td>\n</tr>\n<tr>\n<td>Administrator user name</td>\n<td>.\\Administrator</td>\n</tr>\n<tr>\n<td>Password</td>\n<td>mypassword</td>\n</tr>\n<tr>\n<td>Host</td>\n<td>192.168.1.111</td>\n</tr>\n<tr>\n<td>Run service as</td>\n<td>Use Administrator account given above</td>\n</tr>\n<tr>\n<td>Availability</td>\n<td>Keep this agent online as much as paossible</td>\n</tr>\n</tbody></table>\n<h4 id=\"3-Save-then-Connect\"><a href=\"#3-Save-then-Connect\" class=\"headerlink\" title=\"3. Save then Connect\"></a>3. Save then Connect</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[2019-05-11 01:32:50] [windows-slaves] Connecting to 192.168.1.111</span><br><span class=\"line\">Checking <span class=\"keyword\">if</span> Java exists</span><br><span class=\"line\">java -version returned 1.8.0.</span><br><span class=\"line\">[2019-05-11 01:32:50] [windows-slaves] Copying jenkins-slave.xml</span><br><span class=\"line\">[2019-05-11 01:32:50] [windows-slaves] Copying slave.jar</span><br><span class=\"line\">[2019-05-11 01:32:50] [windows-slaves] Starting the service</span><br><span class=\"line\">[2019-05-11 01:32:50] [windows-slaves] Waiting <span class=\"keyword\">for</span> the service to become ready</span><br><span class=\"line\">[2019-05-11 01:32:55] [windows-slaves] Connecting to port 52,347</span><br><span class=\"line\">&lt;===[JENKINS REMOTING CAPACITY]===&gt;Remoting version: 3.29</span><br><span class=\"line\">This is a Windows agent</span><br><span class=\"line\">Agent successfully connected and online</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Troubleshooting\"><a href=\"#Troubleshooting\" class=\"headerlink\" title=\"Troubleshooting\"></a>Troubleshooting</h2><p>The following issues I met and how I fixed them.</p>\n<h3 id=\"1-ERROR-Message-not-found-for-errorCode-0xC00000AC\"><a href=\"#1-ERROR-Message-not-found-for-errorCode-0xC00000AC\" class=\"headerlink\" title=\"1. ERROR: Message not found for errorCode: 0xC00000AC\"></a>1. ERROR: Message not found for errorCode: 0xC00000AC</h3><p>You need need to install JDK, and config JAVA environment variable.</p>\n<h3 id=\"2-How-to-fix-add-windows-node-as-Windows-service-error\"><a href=\"#2-How-to-fix-add-windows-node-as-Windows-service-error\" class=\"headerlink\" title=\"2. How to fix add windows node as Windows service error\"></a>2. How to fix add windows node as Windows service error</h3><p>Ref to <a href=\"https://issues.jenkins-ci.org/browse/JENKINS-16418\">JENKINS-16418</a>.</p>\n<h3 id=\"3-org-jinterop-dcom-common-JIException-Message-not-found-for-errorCode-0x00000005\"><a href=\"#3-org-jinterop-dcom-common-JIException-Message-not-found-for-errorCode-0x00000005\" class=\"headerlink\" title=\"3. org.jinterop.dcom.common.JIException: Message not found for errorCode: 0x00000005\"></a>3. org.jinterop.dcom.common.JIException: Message not found for errorCode: 0x00000005</h3><p>Fixed permission for the following registry keys</p>\n<ol>\n<li>HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\Wow6432Node\\CLSID{72C24DD5-D70A-438B-8A42-98424B88AFB8}</li>\n<li>HKEY_CLASSES_ROOT\\CLSID{76A64158-CB41-11D1-8B02-00600806D9B6}</li>\n</ol>\n<p>Steps to fix it</p>\n<ul>\n<li>Open ‘regedit’ (as Administrator), Find (Ctrl+F) the registry key: “{72C24DD5-D70A-438B-8A42-98424B88AFB8}” in HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\Wow6432Node\\CLSID</li>\n<li>Right click and select ‘Permissions’, Change owner to administrators group (Advanced…).</li>\n<li>Change permissions for administrators group. Grant Full Control。</li>\n<li>Change owner back to TrustedInstaller (user is “NT Service\\TrustedInstaller” on local machine)</li>\n</ul>\n<p>Repeat the above steps to fix permission for HKEY_CLASSES_ROOT\\CLSID{76A64158-CB41-11D1-8B02-00600806D9B6}</p>\n<p>Finally, Restart Remote Registry Service (Administrative Tools &#x2F; Services).</p>\n<h3 id=\"4-ERROR-Unexpected-error-in-launching-an-agent\"><a href=\"#4-ERROR-Unexpected-error-in-launching-an-agent\" class=\"headerlink\" title=\"4. ERROR: Unexpected error in launching an agent\"></a>4. ERROR: Unexpected error in launching an agent</h3><p>This is probably a bug in Jenkins.</p>\n<ol>\n<li>Login remote machine and open Services find <code>jenkinsslave-C__agent</code></li>\n<li>Set startup type: Automatic</li>\n<li>Log On: select This account, type correct account and password</li>\n<li>start jenkinsslave-C__agent</li>\n</ol>\n<h3 id=\"5-Caused-by-org-jinterop-dcom-common-JIRuntimeException-Message-not-found-for-errorCode-0x800703FA\"><a href=\"#5-Caused-by-org-jinterop-dcom-common-JIRuntimeException-Message-not-found-for-errorCode-0x800703FA\" class=\"headerlink\" title=\"5. Caused by: org.jinterop.dcom.common.JIRuntimeException: Message not found for errorCode: 0x800703FA\"></a>5. Caused by: org.jinterop.dcom.common.JIRuntimeException: Message not found for errorCode: 0x800703FA</h3><p>Slave under domain account, If your slave is running under a domain account and you get an error code 0x800703FA, change a group policy:</p>\n<ol>\n<li>open the group policy editor (gpedit.msc)</li>\n<li>go to Computer Configuration-&gt;Administrative Templates-&gt;System-&gt; UserProfiles, “Do not forcefully unload the user registry at user logoff”</li>\n<li>Change the setting from “Not Configured” to “Enabled”, which disables the new User Profile Service feature (‘DisableForceUnload’ is the value added to the registry)</li>\n</ol>\n<h3 id=\"6-ERROR-Message-not-found-for-errorCode-0xC0000001-Caused-by-jcifs-smb-SmbException-Failed-to-connect-0-0-0-0-10-xxx-xxx-xxx\"><a href=\"#6-ERROR-Message-not-found-for-errorCode-0xC0000001-Caused-by-jcifs-smb-SmbException-Failed-to-connect-0-0-0-0-10-xxx-xxx-xxx\" class=\"headerlink\" title=\"6. ERROR: Message not found for errorCode: 0xC0000001 Caused by: jcifs.smb.SmbException: Failed to connect: 0.0.0.0&lt;00&gt;&#x2F;10.xxx.xxx.xxx\"></a>6. ERROR: Message not found for errorCode: 0xC0000001 Caused by: jcifs.smb.SmbException: Failed to connect: 0.0.0.0&lt;00&gt;&#x2F;10.xxx.xxx.xxx</h3><p>Need to enable SMB1</p>\n<ol>\n<li>Search in the start menu for ‘Turn Windows features on or off’ and open it.</li>\n<li>Find ‘SMB1.0&#x2F;CIFS File Sharing Support’ in the list of optional features that appears, and select the checkbox next to it.</li>\n<li>Click OK and Windows will add the selected feature.</li>\n</ol>\n<p>You’ll be asked to restart your computer as part of this process.</p>\n<h3 id=\"7-NET-Framework-2-0-or-later-is-required-on-this-computer-to-run-a-Jenkins-agent-as-a-Windows-service\"><a href=\"#7-NET-Framework-2-0-or-later-is-required-on-this-computer-to-run-a-Jenkins-agent-as-a-Windows-service\" class=\"headerlink\" title=\"7. .NET Framework 2.0 or later is required on this computer to run a Jenkins agent as a Windows service\"></a>7. .NET Framework 2.0 or later is required on this computer to run a Jenkins agent as a Windows service</h3><p>Need to upgrade your .NET Framework. Here is a <a href=\"https://shenxianpeng.github.io/2020/07/jenkins-windows-agent-connect-problem/\">link</a> for update .NET Framework.</p>\n<h3 id=\"6-more-connect-jenkins-agent-problem-on-windows\"><a href=\"#6-more-connect-jenkins-agent-problem-on-windows\" class=\"headerlink\" title=\"6. more connect jenkins agent problem on windows\"></a>6. more connect jenkins agent problem on windows</h3><p>Please refer to this link <a href=\"https://github.com/jenkinsci/windows-slaves-plugin/blob/master/docs/troubleshooting.adoc\">https://github.com/jenkinsci/windows-slaves-plugin/blob/master/docs/troubleshooting.adoc</a></p>\n","categories":[{"name":"Jenkins","path":"api/categories/Jenkins.json"}],"tags":[{"name":"Jenkins","path":"api/tags/Jenkins.json"}]}