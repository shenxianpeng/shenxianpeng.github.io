{"title":"Jenkins Windows agent configuration","slug":"2019/05/jenkins-windows-agent","date":"2019-05-12T10:39:59.000Z","updated":"2022-12-02T08:02:52.508Z","comments":true,"path":"api/articles/2019/05/jenkins-windows-agent.json","excerpt":null,"covers":null,"content":"<h2 id=\"Prepare-Java-runtime\"><a href=\"#Prepare-Java-runtime\" class=\"headerlink\" title=\"Prepare Java runtime\"></a>Prepare Java runtime</h2><h3 id=\"1-Download-Java\"><a href=\"#1-Download-Java\" class=\"headerlink\" title=\"1. Download Java\"></a>1. <a href=\"https://www.java.com/en/download/\">Download Java</a></h3><h4 id=\"2-Configure-Java-Windows-path\"><a href=\"#2-Configure-Java-Windows-path\" class=\"headerlink\" title=\"2. Configure Java Windows path\"></a>2. Configure Java Windows path</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">JAVA_HOME=C:\\Program Files\\Java\\jdk1.8.0_201</span><br><span class=\"line\">CLASSPATH=.;%JAVA_HOME%\\lib;%JAVA_HOME%\\jre\\lib</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Create-Node\"><a href=\"#Create-Node\" class=\"headerlink\" title=\"Create Node\"></a>Create Node</h2><h3 id=\"1-Jenkins-home-page-gt-Manage-Node-gt-New-Node-such-as-window-build-machine\"><a href=\"#1-Jenkins-home-page-gt-Manage-Node-gt-New-Node-such-as-window-build-machine\" class=\"headerlink\" title=\"1. Jenkins home page-&gt;Manage Node-&gt;New Node, such as window-build-machine\"></a>1. Jenkins home page-&gt;Manage Node-&gt;New Node, such as window-build-machine</h3><h4 id=\"2-List-windows-agent-settings\"><a href=\"#2-List-windows-agent-settings\" class=\"headerlink\" title=\"2. List windows agent settings\"></a>2. List windows agent settings</h4><table>\n<thead>\n<tr>\n<th>Items</th>\n<th>Settings</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Name</td>\n<td>window-build-machine</td>\n</tr>\n<tr>\n<td>Description</td>\n<td>used for windows build</td>\n</tr>\n<tr>\n<td>of executors</td>\n<td>1</td>\n</tr>\n<tr>\n<td>Remote root directory</td>\n<td>C:\\agent</td>\n</tr>\n<tr>\n<td>Labels</td>\n<td>windows, build</td>\n</tr>\n<tr>\n<td>Usage</td>\n<td>Use this node as much as possible</td>\n</tr>\n<tr>\n<td>Launch method</td>\n<td>Let Jenkins control this Windows slave as a Windows service</td>\n</tr>\n<tr>\n<td>Administrator user name</td>\n<td>.\\Administrator</td>\n</tr>\n<tr>\n<td>Password</td>\n<td>mypassword</td>\n</tr>\n<tr>\n<td>Host</td>\n<td>192.168.1.111</td>\n</tr>\n<tr>\n<td>Run service as</td>\n<td>Use Administrator account given above</td>\n</tr>\n<tr>\n<td>Availability</td>\n<td>Keep this agent online as much as paossible</td>\n</tr>\n</tbody></table>\n<h4 id=\"3-Save-then-Connect\"><a href=\"#3-Save-then-Connect\" class=\"headerlink\" title=\"3. Save then Connect\"></a>3. Save then Connect</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[2019-05-11 01:32:50] [windows-slaves] Connecting to 192.168.1.111</span><br><span class=\"line\">Checking <span class=\"keyword\">if</span> Java exists</span><br><span class=\"line\">java -version returned 1.8.0.</span><br><span class=\"line\">[2019-05-11 01:32:50] [windows-slaves] Copying jenkins-slave.xml</span><br><span class=\"line\">[2019-05-11 01:32:50] [windows-slaves] Copying slave.jar</span><br><span class=\"line\">[2019-05-11 01:32:50] [windows-slaves] Starting the service</span><br><span class=\"line\">[2019-05-11 01:32:50] [windows-slaves] Waiting <span class=\"keyword\">for</span> the service to become ready</span><br><span class=\"line\">[2019-05-11 01:32:55] [windows-slaves] Connecting to port 52,347</span><br><span class=\"line\">&lt;===[JENKINS REMOTING CAPACITY]===&gt;Remoting version: 3.29</span><br><span class=\"line\">This is a Windows agent</span><br><span class=\"line\">Agent successfully connected and online</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Troubleshooting\"><a href=\"#Troubleshooting\" class=\"headerlink\" title=\"Troubleshooting\"></a>Troubleshooting</h2><table>\n<thead>\n<tr>\n<th>No.</th>\n<th>Problem</th>\n<th>how to fix</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>ERROR: Message not found for errorCode: 0xC00000AC</td>\n<td>need to install JDK, and config JAVA environment variable</td>\n</tr>\n<tr>\n<td>2</td>\n<td>how to fix add windows node as Windows service error</td>\n<td><a href=\"https://issues.jenkins-ci.org/browse/JENKINS-16418\">JENKINS-16418</a></td>\n</tr>\n<tr>\n<td>3</td>\n<td>org.jinterop.dcom.common.JIException: Message not found for errorCode: 0x00000005</td>\n<td>HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\Wow6432Node\\CLSID {72C24DD5-D70A-438B-8A42-98424B88AFB8} <br> HKEY_CLASSES_ROOT\\CLSID{76A64158-CB41-11D1-8B02-00600806D9B6} <br>Launch ‘regedit’ (as Administrator) <br>Find (Ctrl+F) the following registry key: “{72C24DD5-D70A-438B-8A42-98424B88AFB8}” in HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\Wow6432Node\\CLSID\\ <br>Right click and select ‘Permissions’, Change owner to administrators group (Advanced…). <br>Change permissions for administrators group. Grant Full Control <br>Change owner back to TrustedInstaller (user is “NT Service\\TrustedInstaller” on local machine)<br>Repeat the steps above for HKEY_CLASSES_ROOT\\CLSID {76A64158-CB41-11D1-8B02-00600806D9B6} <br>Restart Remote Registry Service (Administrative Tools &#x2F; Services)</td>\n</tr>\n<tr>\n<td>4</td>\n<td>ERROR: Unexpected error in launching an agent. This is probably a bug in Jenkins</td>\n<td>Login remote machine and open Services find jenkinsslave-C__agent <br>Set startup type: Automatic <br>Log On: select This account, type correct account and password <br>start jenkinsslave-C__agent</td>\n</tr>\n<tr>\n<td>5</td>\n<td>Caused by: org.jinterop.dcom.common.JIRuntimeException: Message not found for errorCode: 0x800703FA</td>\n<td>Slave under domain account <br>If your slave is running under a domain account and you get an error code 0x800703FA, change a group policy: <br>open the group policy editor (gpedit.msc) <br>go to Computer Configuration-&gt;Administrative Templates-&gt;System-&gt; UserProfiles, “Do not forcefully unload the user registry at user logoff” <br>Change the setting from “Not Configured” to “Enabled”, which disables the new User Profile Service feature (‘DisableForceUnload’ is the value added to the registry)</td>\n</tr>\n<tr>\n<td>6</td>\n<td>more connect jenkins agent problem on windows …</td>\n<td>please refer to this link <a href=\"https://github.com/jenkinsci/windows-slaves-plugin/blob/master/docs/troubleshooting.adoc\">https://github.com/jenkinsci/windows-slaves-plugin/blob/master/docs/troubleshooting.adoc</a></td>\n</tr>\n<tr>\n<td>7</td>\n<td>ERROR: Message not found for errorCode: 0xC0000001 Caused by: jcifs.smb.SmbException: Failed to connect: 0.0.0.0&lt;00&gt;&#x2F;10.xxx.xxx.xxx</td>\n<td>need to enable SMB1 <br>Search in the start menu for ‘Turn Windows features on or off’ and open it. <br>Search for ‘SMB1.0&#x2F;CIFS File Sharing Support’ in the list of optional features that appears, and select the checkbox next to it. <br>Click OK and Windows will add the selected feature. You’ll be asked to restart your computer as part of this process</td>\n</tr>\n</tbody></table>\n","more":"<h2 id=\"Prepare-Java-runtime\"><a href=\"#Prepare-Java-runtime\" class=\"headerlink\" title=\"Prepare Java runtime\"></a>Prepare Java runtime</h2><h3 id=\"1-Download-Java\"><a href=\"#1-Download-Java\" class=\"headerlink\" title=\"1. Download Java\"></a>1. <a href=\"https://www.java.com/en/download/\">Download Java</a></h3><h4 id=\"2-Configure-Java-Windows-path\"><a href=\"#2-Configure-Java-Windows-path\" class=\"headerlink\" title=\"2. Configure Java Windows path\"></a>2. Configure Java Windows path</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">JAVA_HOME=C:\\Program Files\\Java\\jdk1.8.0_201</span><br><span class=\"line\">CLASSPATH=.;%JAVA_HOME%\\lib;%JAVA_HOME%\\jre\\lib</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Create-Node\"><a href=\"#Create-Node\" class=\"headerlink\" title=\"Create Node\"></a>Create Node</h2><h3 id=\"1-Jenkins-home-page-gt-Manage-Node-gt-New-Node-such-as-window-build-machine\"><a href=\"#1-Jenkins-home-page-gt-Manage-Node-gt-New-Node-such-as-window-build-machine\" class=\"headerlink\" title=\"1. Jenkins home page-&gt;Manage Node-&gt;New Node, such as window-build-machine\"></a>1. Jenkins home page-&gt;Manage Node-&gt;New Node, such as window-build-machine</h3><h4 id=\"2-List-windows-agent-settings\"><a href=\"#2-List-windows-agent-settings\" class=\"headerlink\" title=\"2. List windows agent settings\"></a>2. List windows agent settings</h4><table>\n<thead>\n<tr>\n<th>Items</th>\n<th>Settings</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Name</td>\n<td>window-build-machine</td>\n</tr>\n<tr>\n<td>Description</td>\n<td>used for windows build</td>\n</tr>\n<tr>\n<td>of executors</td>\n<td>1</td>\n</tr>\n<tr>\n<td>Remote root directory</td>\n<td>C:\\agent</td>\n</tr>\n<tr>\n<td>Labels</td>\n<td>windows, build</td>\n</tr>\n<tr>\n<td>Usage</td>\n<td>Use this node as much as possible</td>\n</tr>\n<tr>\n<td>Launch method</td>\n<td>Let Jenkins control this Windows slave as a Windows service</td>\n</tr>\n<tr>\n<td>Administrator user name</td>\n<td>.\\Administrator</td>\n</tr>\n<tr>\n<td>Password</td>\n<td>mypassword</td>\n</tr>\n<tr>\n<td>Host</td>\n<td>192.168.1.111</td>\n</tr>\n<tr>\n<td>Run service as</td>\n<td>Use Administrator account given above</td>\n</tr>\n<tr>\n<td>Availability</td>\n<td>Keep this agent online as much as paossible</td>\n</tr>\n</tbody></table>\n<h4 id=\"3-Save-then-Connect\"><a href=\"#3-Save-then-Connect\" class=\"headerlink\" title=\"3. Save then Connect\"></a>3. Save then Connect</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[2019-05-11 01:32:50] [windows-slaves] Connecting to 192.168.1.111</span><br><span class=\"line\">Checking <span class=\"keyword\">if</span> Java exists</span><br><span class=\"line\">java -version returned 1.8.0.</span><br><span class=\"line\">[2019-05-11 01:32:50] [windows-slaves] Copying jenkins-slave.xml</span><br><span class=\"line\">[2019-05-11 01:32:50] [windows-slaves] Copying slave.jar</span><br><span class=\"line\">[2019-05-11 01:32:50] [windows-slaves] Starting the service</span><br><span class=\"line\">[2019-05-11 01:32:50] [windows-slaves] Waiting <span class=\"keyword\">for</span> the service to become ready</span><br><span class=\"line\">[2019-05-11 01:32:55] [windows-slaves] Connecting to port 52,347</span><br><span class=\"line\">&lt;===[JENKINS REMOTING CAPACITY]===&gt;Remoting version: 3.29</span><br><span class=\"line\">This is a Windows agent</span><br><span class=\"line\">Agent successfully connected and online</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Troubleshooting\"><a href=\"#Troubleshooting\" class=\"headerlink\" title=\"Troubleshooting\"></a>Troubleshooting</h2><table>\n<thead>\n<tr>\n<th>No.</th>\n<th>Problem</th>\n<th>how to fix</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>ERROR: Message not found for errorCode: 0xC00000AC</td>\n<td>need to install JDK, and config JAVA environment variable</td>\n</tr>\n<tr>\n<td>2</td>\n<td>how to fix add windows node as Windows service error</td>\n<td><a href=\"https://issues.jenkins-ci.org/browse/JENKINS-16418\">JENKINS-16418</a></td>\n</tr>\n<tr>\n<td>3</td>\n<td>org.jinterop.dcom.common.JIException: Message not found for errorCode: 0x00000005</td>\n<td>HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\Wow6432Node\\CLSID {72C24DD5-D70A-438B-8A42-98424B88AFB8} <br> HKEY_CLASSES_ROOT\\CLSID{76A64158-CB41-11D1-8B02-00600806D9B6} <br>Launch ‘regedit’ (as Administrator) <br>Find (Ctrl+F) the following registry key: “{72C24DD5-D70A-438B-8A42-98424B88AFB8}” in HKEY_LOCAL_MACHINE\\SOFTWARE\\Classes\\Wow6432Node\\CLSID\\ <br>Right click and select ‘Permissions’, Change owner to administrators group (Advanced…). <br>Change permissions for administrators group. Grant Full Control <br>Change owner back to TrustedInstaller (user is “NT Service\\TrustedInstaller” on local machine)<br>Repeat the steps above for HKEY_CLASSES_ROOT\\CLSID {76A64158-CB41-11D1-8B02-00600806D9B6} <br>Restart Remote Registry Service (Administrative Tools &#x2F; Services)</td>\n</tr>\n<tr>\n<td>4</td>\n<td>ERROR: Unexpected error in launching an agent. This is probably a bug in Jenkins</td>\n<td>Login remote machine and open Services find jenkinsslave-C__agent <br>Set startup type: Automatic <br>Log On: select This account, type correct account and password <br>start jenkinsslave-C__agent</td>\n</tr>\n<tr>\n<td>5</td>\n<td>Caused by: org.jinterop.dcom.common.JIRuntimeException: Message not found for errorCode: 0x800703FA</td>\n<td>Slave under domain account <br>If your slave is running under a domain account and you get an error code 0x800703FA, change a group policy: <br>open the group policy editor (gpedit.msc) <br>go to Computer Configuration-&gt;Administrative Templates-&gt;System-&gt; UserProfiles, “Do not forcefully unload the user registry at user logoff” <br>Change the setting from “Not Configured” to “Enabled”, which disables the new User Profile Service feature (‘DisableForceUnload’ is the value added to the registry)</td>\n</tr>\n<tr>\n<td>6</td>\n<td>more connect jenkins agent problem on windows …</td>\n<td>please refer to this link <a href=\"https://github.com/jenkinsci/windows-slaves-plugin/blob/master/docs/troubleshooting.adoc\">https://github.com/jenkinsci/windows-slaves-plugin/blob/master/docs/troubleshooting.adoc</a></td>\n</tr>\n<tr>\n<td>7</td>\n<td>ERROR: Message not found for errorCode: 0xC0000001 Caused by: jcifs.smb.SmbException: Failed to connect: 0.0.0.0&lt;00&gt;&#x2F;10.xxx.xxx.xxx</td>\n<td>need to enable SMB1 <br>Search in the start menu for ‘Turn Windows features on or off’ and open it. <br>Search for ‘SMB1.0&#x2F;CIFS File Sharing Support’ in the list of optional features that appears, and select the checkbox next to it. <br>Click OK and Windows will add the selected feature. You’ll be asked to restart your computer as part of this process</td>\n</tr>\n</tbody></table>\n","categories":[{"name":"Jenkins","path":"api/categories/Jenkins.json"}],"tags":[{"name":"Jenkins","path":"api/tags/Jenkins.json"}]}