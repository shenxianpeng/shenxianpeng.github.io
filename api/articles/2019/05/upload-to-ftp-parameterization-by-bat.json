{"title":"通过参数化上传文件到 FTP 服务器","slug":"2019/05/upload-to-ftp-parameterization-by-bat","date":"2019-05-13T15:43:21.000Z","updated":"2023-02-08T07:06:49.798Z","comments":true,"path":"api/articles/2019/05/upload-to-ftp-parameterization-by-bat.json","excerpt":"实现 CI&#x2F;CD 过程中，常常需要将构建好的 build 上传到一个公共的服务器，供测试、开发来获取最新的 build。如何上传 build 成果物到 FTP server，又不想把 FTP server登录的用户名和密码存在脚本里，想做这样的参数化如何实现呢？upload_to_ftp.bat [hostname] [username] [password] [local_path] [remote_pat]<br>","covers":null,"content":"<p>实现 CI&#x2F;CD 过程中，常常需要将构建好的 build 上传到一个公共的服务器，供测试、开发来获取最新的 build。如何上传 build 成果物到 FTP server，又不想把 FTP server登录的用户名和密码存在脚本里，想做这样的参数化如何实现呢？</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">upload_to_ftp.bat [hostname] [username] [password] [local_path] [remote_pat]</span><br></pre></td></tr></table></figure>\n\n<span id=\"more\"></span>\n\n<p>windows batch 由于它的局限性，在实现上是比较麻烦的，但还是有办法。如何用 windows batch 来实现呢？借助一个临时文件，把需要的参数写入到临时文件里，然后通过 ftp -s 参数读取文件，最后把临时文件删除的方式来实现。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">@<span class=\"built_in\">echo</span> off</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">set</span> ftp_hostname=%1</span><br><span class=\"line\"><span class=\"built_in\">set</span> ftp_username=%2</span><br><span class=\"line\"><span class=\"built_in\">set</span> ftp_password=%3</span><br><span class=\"line\"><span class=\"built_in\">set</span> local_path=%4</span><br><span class=\"line\"><span class=\"built_in\">set</span> remote_path=%5</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> %ftp_hostname%! == ! ( <span class=\"built_in\">echo</span> <span class=\"string\">&quot;ftp_hostname not set correctly&quot;</span> &amp; goto USAGE )</span><br><span class=\"line\"><span class=\"keyword\">if</span> %ftp_username%! == ! ( <span class=\"built_in\">echo</span> <span class=\"string\">&quot;ftp_username not set correctly&quot;</span> &amp; goto USAGE )</span><br><span class=\"line\"><span class=\"keyword\">if</span> %ftp_password%! == ! ( <span class=\"built_in\">echo</span> <span class=\"string\">&quot;ftp_password not set correctly&quot;</span> &amp; goto USAGE )</span><br><span class=\"line\"><span class=\"keyword\">if</span> %local_path%! == ! ( <span class=\"built_in\">echo</span> <span class=\"string\">&quot;local_path not set correctly&quot;</span> &amp; goto USAGE )</span><br><span class=\"line\"><span class=\"keyword\">if</span> %remote_path%! == ! ( <span class=\"built_in\">echo</span> <span class=\"string\">&quot;remote_path not set correctly&quot;</span> &amp; goto USAGE )</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> open %ftp_hostname% &gt; ftp.txt</span><br><span class=\"line\"><span class=\"built_in\">echo</span> user %ftp_username% %ftp_password% &gt;&gt; ftp.txt</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"built_in\">cd</span> %remote_path% &gt;&gt; ftp.txt</span><br><span class=\"line\"><span class=\"built_in\">echo</span> lcd %local_path% &gt;&gt;ftp.txt</span><br><span class=\"line\"><span class=\"built_in\">echo</span> prompt off &gt;&gt;ftp.txt</span><br><span class=\"line\"><span class=\"built_in\">echo</span> bin &gt;&gt; ftp.txt</span><br><span class=\"line\"><span class=\"built_in\">echo</span> mput * &gt;&gt; ftp.txt</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"built_in\">bye</span> &gt;&gt; ftp.txt</span><br><span class=\"line\">ftp -n -s:ftp.txt</span><br><span class=\"line\"></span><br><span class=\"line\">del ftp.txt</span><br><span class=\"line\">goto END</span><br><span class=\"line\"></span><br><span class=\"line\">:USAGE</span><br><span class=\"line\"><span class=\"built_in\">echo</span>.</span><br><span class=\"line\"><span class=\"built_in\">echo</span>.   - -------------------------------------------------------------------------------</span><br><span class=\"line\"><span class=\"built_in\">echo</span>.   - upload_to_ftp.bat [hostname] [username] [password] [local_path] [remote_pat]  -</span><br><span class=\"line\"><span class=\"built_in\">echo</span>.   - Example:                                                                      -</span><br><span class=\"line\"><span class=\"built_in\">echo</span>.   - upload_to_ftp.bat 192.168.1.1 guest guest D:\\Media\\* C:\\Builds\\               -</span><br><span class=\"line\"><span class=\"built_in\">echo</span>.   - -------------------------------------------------------------------------------</span><br><span class=\"line\"><span class=\"built_in\">echo</span>.</span><br><span class=\"line\"></span><br><span class=\"line\">:END</span><br></pre></td></tr></table></figure>\n","more":"<p>windows batch 由于它的局限性，在实现上是比较麻烦的，但还是有办法。如何用 windows batch 来实现呢？借助一个临时文件，把需要的参数写入到临时文件里，然后通过 ftp -s 参数读取文件，最后把临时文件删除的方式来实现。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">@<span class=\"built_in\">echo</span> off</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">set</span> ftp_hostname=%1</span><br><span class=\"line\"><span class=\"built_in\">set</span> ftp_username=%2</span><br><span class=\"line\"><span class=\"built_in\">set</span> ftp_password=%3</span><br><span class=\"line\"><span class=\"built_in\">set</span> local_path=%4</span><br><span class=\"line\"><span class=\"built_in\">set</span> remote_path=%5</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> %ftp_hostname%! == ! ( <span class=\"built_in\">echo</span> <span class=\"string\">&quot;ftp_hostname not set correctly&quot;</span> &amp; goto USAGE )</span><br><span class=\"line\"><span class=\"keyword\">if</span> %ftp_username%! == ! ( <span class=\"built_in\">echo</span> <span class=\"string\">&quot;ftp_username not set correctly&quot;</span> &amp; goto USAGE )</span><br><span class=\"line\"><span class=\"keyword\">if</span> %ftp_password%! == ! ( <span class=\"built_in\">echo</span> <span class=\"string\">&quot;ftp_password not set correctly&quot;</span> &amp; goto USAGE )</span><br><span class=\"line\"><span class=\"keyword\">if</span> %local_path%! == ! ( <span class=\"built_in\">echo</span> <span class=\"string\">&quot;local_path not set correctly&quot;</span> &amp; goto USAGE )</span><br><span class=\"line\"><span class=\"keyword\">if</span> %remote_path%! == ! ( <span class=\"built_in\">echo</span> <span class=\"string\">&quot;remote_path not set correctly&quot;</span> &amp; goto USAGE )</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> open %ftp_hostname% &gt; ftp.txt</span><br><span class=\"line\"><span class=\"built_in\">echo</span> user %ftp_username% %ftp_password% &gt;&gt; ftp.txt</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"built_in\">cd</span> %remote_path% &gt;&gt; ftp.txt</span><br><span class=\"line\"><span class=\"built_in\">echo</span> lcd %local_path% &gt;&gt;ftp.txt</span><br><span class=\"line\"><span class=\"built_in\">echo</span> prompt off &gt;&gt;ftp.txt</span><br><span class=\"line\"><span class=\"built_in\">echo</span> bin &gt;&gt; ftp.txt</span><br><span class=\"line\"><span class=\"built_in\">echo</span> mput * &gt;&gt; ftp.txt</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"built_in\">bye</span> &gt;&gt; ftp.txt</span><br><span class=\"line\">ftp -n -s:ftp.txt</span><br><span class=\"line\"></span><br><span class=\"line\">del ftp.txt</span><br><span class=\"line\">goto END</span><br><span class=\"line\"></span><br><span class=\"line\">:USAGE</span><br><span class=\"line\"><span class=\"built_in\">echo</span>.</span><br><span class=\"line\"><span class=\"built_in\">echo</span>.   - -------------------------------------------------------------------------------</span><br><span class=\"line\"><span class=\"built_in\">echo</span>.   - upload_to_ftp.bat [hostname] [username] [password] [local_path] [remote_pat]  -</span><br><span class=\"line\"><span class=\"built_in\">echo</span>.   - Example:                                                                      -</span><br><span class=\"line\"><span class=\"built_in\">echo</span>.   - upload_to_ftp.bat 192.168.1.1 guest guest D:\\Media\\* C:\\Builds\\               -</span><br><span class=\"line\"><span class=\"built_in\">echo</span>.   - -------------------------------------------------------------------------------</span><br><span class=\"line\"><span class=\"built_in\">echo</span>.</span><br><span class=\"line\"></span><br><span class=\"line\">:END</span><br></pre></td></tr></table></figure>","categories":[{"name":"Automation","path":"api/categories/Automation.json"}],"tags":[{"name":"Shell","path":"api/tags/Shell.json"},{"name":"Automation","path":"api/tags/Automation.json"},{"name":"FTP","path":"api/tags/FTP.json"}]}