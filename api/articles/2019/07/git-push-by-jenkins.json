{"title":"通过 Jenkins 来提交修改的代码 git push by Jenkins","slug":"2019/07/git-push-by-jenkins","date":"2019-07-22T13:54:42.000Z","updated":"2023-12-15T09:25:16.947Z","comments":true,"path":"api/articles/2019/07/git-push-by-jenkins.json","excerpt":"在持续集成中，你可能需要通过 Jenkins 来修改代码，并且将修改后的代码提交到Git仓库里。怎么做呢？最方便的做法还是 Jenkins 提供对应的插件，但是很遗憾我没找到合适的。另外我也觉得通过脚本的方式来实现会更加稳定，不用担心 Jenkins 以及插件升级带来潜在不好用的可能。","covers":null,"content":"<p>在持续集成中，你可能需要通过 Jenkins 来修改代码，并且将修改后的代码提交到Git仓库里。怎么做呢？最方便的做法还是 Jenkins 提供对应的插件，但是很遗憾我没找到合适的。另外我也觉得通过脚本的方式来实现会更加稳定，不用担心 Jenkins 以及插件升级带来潜在不好用的可能。</p>\n<span id=\"more\"></span>\n\n<p>以下 <code>pipeline</code> 片段供参考使用：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">// This pipeline is used <span class=\"keyword\">for</span> bumping build number</span><br><span class=\"line\"></span><br><span class=\"line\">pipeline &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    environment &#123;</span><br><span class=\"line\">        MYGIT = credentials(<span class=\"string\">&quot;d1cbab74-823d-41aa-abb7&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    stages &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        stage(<span class=\"string\">&#x27;Git clone repo&#x27;</span>) &#123;</span><br><span class=\"line\">            steps &#123;</span><br><span class=\"line\">                sh <span class=\"string\">&#x27;git clone -b develop --depth 1 https://$MYGIT_USR:&quot;$MYGIT_PSW&quot;@github.com/shenxianpeng/blog.git&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        stage(<span class=\"string\">&#x27;Change code stage&#x27;</span>)&#123;</span><br><span class=\"line\">            steps &#123;</span><br><span class=\"line\">                sh <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        stage(<span class=\"string\">&#x27;Git push to remote repo&#x27;</span>) &#123;</span><br><span class=\"line\">            steps &#123;</span><br><span class=\"line\">                sh label: <span class=\"string\">&#x27;&#x27;</span>, script: <span class=\"string\">&#x27;&#x27;</span><span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"string\">                cd blog</span></span><br><span class=\"line\"><span class=\"string\">                git add .</span></span><br><span class=\"line\"><span class=\"string\">                git commit -m &quot;Bld # 1001&quot;</span></span><br><span class=\"line\"><span class=\"string\">                git push https://$MYGIT_USR:&quot;$MYGIT_PSW&quot;@github.com/shenxianpeng/blog.git --all&#x27;</span><span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里面我所遇到最大的坑，我之前脚本是这样写的：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">stage(<span class=\"string\">&#x27;Git push to remote&#x27;</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    // not works script</span><br><span class=\"line\"></span><br><span class=\"line\">    steps &#123;</span><br><span class=\"line\">        sh <span class=\"string\">&#x27;cd blog&#x27;</span></span><br><span class=\"line\">        sh <span class=\"string\">&#x27;git add .&#x27;</span></span><br><span class=\"line\">        sh <span class=\"string\">&#x27;git commit -m &quot;$&#123;JIRA_NO&#125; Bld # $&#123;BUILD_NO&#125;&quot;&#x27;</span></span><br><span class=\"line\">        sh <span class=\"string\">&#x27;git push https://$MYGIT_USR:&quot;$MYGIT_PSW&quot;@github.com/shenxianpeng/blog.git --all&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在最后一个阶段提交代码时，shell 脚本不能使用单引号 ‘’，要使用三引号才行’’’ ‘’’。我在这里花了很多时间，一直找不到问题所在，因为我在上面的shell脚本使用的时候用单引号 ‘’ 可以正常 git clone 代码，但在提交代码时不行，最后我 Jenkins 的 Pipeline Syntax 生成的脚本，提交代码成功。</p>\n","more":"<p>以下 <code>pipeline</code> 片段供参考使用：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">// This pipeline is used <span class=\"keyword\">for</span> bumping build number</span><br><span class=\"line\"></span><br><span class=\"line\">pipeline &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    environment &#123;</span><br><span class=\"line\">        MYGIT = credentials(<span class=\"string\">&quot;d1cbab74-823d-41aa-abb7&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    stages &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        stage(<span class=\"string\">&#x27;Git clone repo&#x27;</span>) &#123;</span><br><span class=\"line\">            steps &#123;</span><br><span class=\"line\">                sh <span class=\"string\">&#x27;git clone -b develop --depth 1 https://$MYGIT_USR:&quot;$MYGIT_PSW&quot;@github.com/shenxianpeng/blog.git&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        stage(<span class=\"string\">&#x27;Change code stage&#x27;</span>)&#123;</span><br><span class=\"line\">            steps &#123;</span><br><span class=\"line\">                sh <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        stage(<span class=\"string\">&#x27;Git push to remote repo&#x27;</span>) &#123;</span><br><span class=\"line\">            steps &#123;</span><br><span class=\"line\">                sh label: <span class=\"string\">&#x27;&#x27;</span>, script: <span class=\"string\">&#x27;&#x27;</span><span class=\"string\">&#x27;</span></span><br><span class=\"line\"><span class=\"string\">                cd blog</span></span><br><span class=\"line\"><span class=\"string\">                git add .</span></span><br><span class=\"line\"><span class=\"string\">                git commit -m &quot;Bld # 1001&quot;</span></span><br><span class=\"line\"><span class=\"string\">                git push https://$MYGIT_USR:&quot;$MYGIT_PSW&quot;@github.com/shenxianpeng/blog.git --all&#x27;</span><span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里面我所遇到最大的坑，我之前脚本是这样写的：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">stage(<span class=\"string\">&#x27;Git push to remote&#x27;</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    // not works script</span><br><span class=\"line\"></span><br><span class=\"line\">    steps &#123;</span><br><span class=\"line\">        sh <span class=\"string\">&#x27;cd blog&#x27;</span></span><br><span class=\"line\">        sh <span class=\"string\">&#x27;git add .&#x27;</span></span><br><span class=\"line\">        sh <span class=\"string\">&#x27;git commit -m &quot;$&#123;JIRA_NO&#125; Bld # $&#123;BUILD_NO&#125;&quot;&#x27;</span></span><br><span class=\"line\">        sh <span class=\"string\">&#x27;git push https://$MYGIT_USR:&quot;$MYGIT_PSW&quot;@github.com/shenxianpeng/blog.git --all&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在最后一个阶段提交代码时，shell 脚本不能使用单引号 ‘’，要使用三引号才行’’’ ‘’’。我在这里花了很多时间，一直找不到问题所在，因为我在上面的shell脚本使用的时候用单引号 ‘’ 可以正常 git clone 代码，但在提交代码时不行，最后我 Jenkins 的 Pipeline Syntax 生成的脚本，提交代码成功。</p>","categories":[{"name":"Jenkins","path":"api/categories/Jenkins.json"}],"tags":[{"name":"Git","path":"api/tags/Git.json"},{"name":"Jenkins","path":"api/tags/Jenkins.json"},{"name":"Pipeline","path":"api/tags/Pipeline.json"}]}