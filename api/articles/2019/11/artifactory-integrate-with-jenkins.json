{"title":"Artifactory 与 Jenkins 集成","slug":"2019/11/artifactory-integrate-with-jenkins","date":"2019-11-17T08:00:34.000Z","updated":"2024-05-28T17:17:16.321Z","comments":true,"path":"api/articles/2019/11/artifactory-integrate-with-jenkins.json","excerpt":"上一篇 初识 JFrog Artifactory，介绍了什么是 Artifactory，以及如何安装、启动和升级。本篇介绍 Artifactory 与 Jenkins 的集成，因为没有与 CI 工具集成的 Artifactory 是没有灵魂的。通过集成，可以让 Jenkins 在完成构建之后，可以直接将制品（比如 build）推送到 Artifactory，供测试下载、部署或是后续的 Jenkins 任务去继续进行持续集成。","covers":["/2019/11/artifactory-integrate-with-jenkins/jenkins-artifactory-integration.png","/2019/11/artifactory-integrate-with-jenkins/post-to-artifactory.png","/2019/11/artifactory-integrate-with-jenkins/artifactory-builds.png"],"content":"<p>上一篇 <a href=\"https://shenxianpeng.github.io/2019/11/artifactory-install-and-upgrade/\">初识 JFrog Artifactory</a>，介绍了什么是 Artifactory，以及如何安装、启动和升级。</p>\n<p>本篇介绍 Artifactory 与 Jenkins 的集成，因为没有与 CI 工具集成的 Artifactory 是没有灵魂的。</p>\n<p>通过集成，可以让 Jenkins 在完成构建之后，可以直接将制品（比如 build）推送到 Artifactory，供测试下载、部署或是后续的 Jenkins 任务去继续进行持续集成。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"Jenkins-里配置-Artifactory\"><a href=\"#Jenkins-里配置-Artifactory\" class=\"headerlink\" title=\"Jenkins 里配置 Artifactory\"></a>Jenkins 里配置 Artifactory</h2><p>打开 Manage Jenkins-&gt;Configure System，找到 Artifactory，点击 Add Artifactory Server， 输入 Server ID 和 URL</p>\n<ol>\n<li>Server ID 是给你的 Artifactory 起个别名，这样使用 Jenkins pipeline 的时候会用到</li>\n<li>URL 是你的 Artifactory 服务器的地址，例如 <code>http://art.company.com:8040/artifactory</code></li>\n<li>配置完成后，点击Test Connection，返回 <code>Found Artifactory 6.14.0</code> 表示配置成功。</li>\n</ol>\n<p>如图所示: <img src=\"/2019/11/artifactory-integrate-with-jenkins/jenkins-artifactory-integration.png\" alt=\"配置和测试\"></p>\n<h2 id=\"使用-Pipeline-调用-Artifactory\"><a href=\"#使用-Pipeline-调用-Artifactory\" class=\"headerlink\" title=\"使用 Pipeline 调用 Artifactory\"></a>使用 Pipeline 调用 Artifactory</h2><p>这里演示了两种方式，我在项目中用的是 Jenkins Shared Library；当然你也可以仅仅使用 Jenkinsfile，把如下两个 groovy 文件组合成一个 Jenkinsfile。</p>\n<h3 id=\"方式1：Jenkins-Shared-Library\"><a href=\"#方式1：Jenkins-Shared-Library\" class=\"headerlink\" title=\"方式1：Jenkins Shared Library\"></a>方式1：Jenkins Shared Library</h3><p><code>build.groovy</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">def <span class=\"function\"><span class=\"title\">call</span></span>() &#123;</span><br><span class=\"line\">  pipeline &#123;</span><br><span class=\"line\">    <span class=\"comment\"># 省略其他代码</span></span><br><span class=\"line\">    post &#123;</span><br><span class=\"line\">      <span class=\"comment\"># 这里只有在 Jenkins Job 成功的时候才将 build post 到 artifactory</span></span><br><span class=\"line\">      success &#123;</span><br><span class=\"line\">        script &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (env.BRANCH_NAME == <span class=\"string\">&#x27;develop&#x27;</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\"># 如果当前是 develop 分支，则将 release 和 debug build 都 post 到 artifactory</span></span><br><span class=\"line\">            artifactory(<span class=\"string\">&quot;<span class=\"variable\">$&#123;PATTERN_RELEASE_PATH&#125;</span>&quot;</span>, <span class=\"string\">&quot;<span class=\"variable\">$&#123;TARGET_PATH&#125;</span>&quot;</span>, <span class=\"string\">&quot;<span class=\"variable\">$&#123;BUILD_NAME&#125;</span>&quot;</span>, <span class=\"string\">&quot;<span class=\"variable\">$&#123;BUILD_NUMBER&#125;</span>&quot;</span>)</span><br><span class=\"line\">            artifactory(<span class=\"string\">&quot;<span class=\"variable\">$&#123;PATTERN_DEBUG_PATH&#125;</span>&quot;</span>,   <span class=\"string\">&quot;<span class=\"variable\">$&#123;TARGET_PATH&#125;</span>&quot;</span>, <span class=\"string\">&quot;<span class=\"variable\">$&#123;BUILD_NAME&#125;</span>&quot;</span>, <span class=\"string\">&quot;<span class=\"variable\">$&#123;BUILD_NUMBER&#125;</span>&quot;</span>)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (env.BRANCH_NAME.startsWith(<span class=\"string\">&#x27;PR&#x27;</span>)) &#123;</span><br><span class=\"line\">            <span class=\"comment\"># 如果当前是 pull request 分支，则只将 release build 都 post 到 artifactory</span></span><br><span class=\"line\">            artifactory(<span class=\"string\">&quot;<span class=\"variable\">$&#123;PATTERN_RELEASE_PATH&#125;</span>&quot;</span>, <span class=\"string\">&quot;<span class=\"variable\">$&#123;TARGET_PATH&#125;</span>&quot;</span>, <span class=\"string\">&quot;<span class=\"variable\">$&#123;BUILD_NAME&#125;</span>&quot;</span>, <span class=\"string\">&quot;<span class=\"variable\">$&#123;BUILD_NUMBER&#125;</span>&quot;</span>)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>artifactory.groovy</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">import groovy.transform.Field</span><br><span class=\"line\"></span><br><span class=\"line\">@Field artifactoryServerId   = <span class=\"string\">&quot;art-1&quot;</span></span><br><span class=\"line\">@Field artifactoryURL        = <span class=\"string\">&quot;http://art.company.com:8040/artifactory&quot;</span></span><br><span class=\"line\">@Field artifactoryCredential = <span class=\"string\">&quot;d1cbab74-823d-41aa-abb7&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">def call(String patternPath, String targetPath, String buildName, String buildNumber) &#123;</span><br><span class=\"line\">  rtServer (</span><br><span class=\"line\">    <span class=\"built_in\">id</span>: <span class=\"string\">&quot;<span class=\"variable\">$&#123;artifactoryServerId&#125;</span>&quot;</span>,</span><br><span class=\"line\">    url: <span class=\"string\">&quot;<span class=\"variable\">$&#123;artifactoryURL&#125;</span>&quot;</span>,</span><br><span class=\"line\">    credentialsId: <span class=\"string\">&quot;<span class=\"variable\">$&#123;artifactoryCredential&#125;</span>&quot;</span></span><br><span class=\"line\">  )</span><br><span class=\"line\">  rtPublishBuildInfo (</span><br><span class=\"line\">      serverId: <span class=\"string\">&quot;<span class=\"variable\">$&#123;artifactoryServerId&#125;</span>&quot;</span></span><br><span class=\"line\">  )</span><br><span class=\"line\">  rtUpload (</span><br><span class=\"line\">    serverId: <span class=\"string\">&quot;<span class=\"variable\">$&#123;artifactoryServerId&#125;</span>&quot;</span>,</span><br><span class=\"line\">    spec: <span class=\"string\">&quot;&quot;</span><span class=\"string\">&quot;&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;</span>files<span class=\"string\">&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">        &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;</span>pattern<span class=\"string\">&quot;: &quot;</span><span class=\"variable\">$&#123;patternPath&#125;</span><span class=\"string\">&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;</span>target<span class=\"string\">&quot;: &quot;</span><span class=\"variable\">$&#123;targetPath&#125;</span><span class=\"string\">&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      ]</span></span><br><span class=\"line\"><span class=\"string\">    &#125;&quot;</span><span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">    buildNumber: <span class=\"string\">&quot;<span class=\"variable\">$&#123;buildNumber&#125;</span>&quot;</span>,</span><br><span class=\"line\">    buildName: <span class=\"string\">&quot;<span class=\"variable\">$&#123;buildName&#125;</span>&quot;</span>,</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"方式2：Jenkinsfile\"><a href=\"#方式2：Jenkinsfile\" class=\"headerlink\" title=\"方式2：Jenkinsfile\"></a>方式2：Jenkinsfile</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">pipeline &#123;</span><br><span class=\"line\">  <span class=\"comment\"># 省略其他代码</span></span><br><span class=\"line\">  stage(<span class=\"string\">&#x27;config art&#x27;</span>)&#123;</span><br><span class=\"line\">    rtServer (</span><br><span class=\"line\">    <span class=\"built_in\">id</span>: <span class=\"string\">&quot;art-1&quot;</span>,</span><br><span class=\"line\">    url: <span class=\"string\">&quot;http://art.company.com:8040/artifactory&quot;</span>,</span><br><span class=\"line\">    credentialsId: <span class=\"string\">&quot;d1cbab74-823d-41aa-abb7&quot;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  post &#123;</span><br><span class=\"line\">    <span class=\"comment\"># 这里只有在 Jenkins Job 成功的时候才将 build post 到 artifactory</span></span><br><span class=\"line\">    success &#123;</span><br><span class=\"line\">      script &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (env.BRANCH_NAME == <span class=\"string\">&#x27;develop&#x27;</span>) &#123;</span><br><span class=\"line\">          rtUpload (</span><br><span class=\"line\">            serverId: <span class=\"string\">&quot;art-1&quot;</span>,</span><br><span class=\"line\">            spec: <span class=\"string\">&quot;&quot;</span><span class=\"string\">&quot;&#123;</span></span><br><span class=\"line\"><span class=\"string\">              &quot;</span>files<span class=\"string\">&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">                &#123;</span></span><br><span class=\"line\"><span class=\"string\">                &quot;</span>pattern<span class=\"string\">&quot;: &quot;</span>/release/build/*.zip<span class=\"string\">&quot;,</span></span><br><span class=\"line\"><span class=\"string\">                &quot;</span>target<span class=\"string\">&quot;: &quot;</span>demo/develop/<span class=\"string\">&quot;</span></span><br><span class=\"line\"><span class=\"string\">                &#125;</span></span><br><span class=\"line\"><span class=\"string\">              ]</span></span><br><span class=\"line\"><span class=\"string\">            &#125;&quot;</span><span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">            buildNumber: <span class=\"string\">&quot;<span class=\"variable\">$&#123;buildNumber&#125;</span>&quot;</span>,</span><br><span class=\"line\">            buildName: <span class=\"string\">&quot;<span class=\"variable\">$&#123;buildName&#125;</span>&quot;</span>,</span><br><span class=\"line\">          )</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (env.BRANCH_NAME.startsWith(<span class=\"string\">&#x27;PR&#x27;</span>)) &#123;</span><br><span class=\"line\">          rtUpload (</span><br><span class=\"line\">            serverId: <span class=\"string\">&quot;art-1&quot;</span>,</span><br><span class=\"line\">            spec: <span class=\"string\">&quot;&quot;</span><span class=\"string\">&quot;&#123;</span></span><br><span class=\"line\"><span class=\"string\">                &quot;</span>files<span class=\"string\">&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">                  &#123;</span></span><br><span class=\"line\"><span class=\"string\">                  &quot;</span>pattern<span class=\"string\">&quot;: &quot;</span>/release/build/*.zip<span class=\"string\">&quot;,</span></span><br><span class=\"line\"><span class=\"string\">                  &quot;</span>target<span class=\"string\">&quot;: &quot;</span>demo/pull-request/<span class=\"string\">&quot;</span></span><br><span class=\"line\"><span class=\"string\">                  &#125;</span></span><br><span class=\"line\"><span class=\"string\">                ]</span></span><br><span class=\"line\"><span class=\"string\">            &#125;&quot;</span><span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">            buildNumber: <span class=\"string\">&quot;<span class=\"variable\">$&#123;buildNumber&#125;</span>&quot;</span>,</span><br><span class=\"line\">            buildName: <span class=\"string\">&quot;<span class=\"variable\">$&#123;buildName&#125;</span>&quot;</span>,</span><br><span class=\"line\">          )</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Jenkins-与-Artifactory-集成成功\"><a href=\"#Jenkins-与-Artifactory-集成成功\" class=\"headerlink\" title=\"Jenkins 与 Artifactory 集成成功\"></a>Jenkins 与 Artifactory 集成成功</h2><p>蓝色表示构建成功，绿色圆圈表示 Build 已经 Post 到 Artifactory 上了。</p>\n<p><img src=\"/2019/11/artifactory-integrate-with-jenkins/post-to-artifactory.png\" alt=\"显示构建以及 Post 成功\"></p>\n<p>点击绿色圆圈可以跳转到 Artifactory 看到制品。</p>\n<p><img src=\"/2019/11/artifactory-integrate-with-jenkins/artifactory-builds.png\" alt=\"Artifactory\"></p>\n<p>Jenkins 与 Artifactory 打通了。完！</p>\n","more":"<h2 id=\"Jenkins-里配置-Artifactory\"><a href=\"#Jenkins-里配置-Artifactory\" class=\"headerlink\" title=\"Jenkins 里配置 Artifactory\"></a>Jenkins 里配置 Artifactory</h2><p>打开 Manage Jenkins-&gt;Configure System，找到 Artifactory，点击 Add Artifactory Server， 输入 Server ID 和 URL</p>\n<ol>\n<li>Server ID 是给你的 Artifactory 起个别名，这样使用 Jenkins pipeline 的时候会用到</li>\n<li>URL 是你的 Artifactory 服务器的地址，例如 <code>http://art.company.com:8040/artifactory</code></li>\n<li>配置完成后，点击Test Connection，返回 <code>Found Artifactory 6.14.0</code> 表示配置成功。</li>\n</ol>\n<p>如图所示: <img src=\"/2019/11/artifactory-integrate-with-jenkins/jenkins-artifactory-integration.png\" alt=\"配置和测试\"></p>\n<h2 id=\"使用-Pipeline-调用-Artifactory\"><a href=\"#使用-Pipeline-调用-Artifactory\" class=\"headerlink\" title=\"使用 Pipeline 调用 Artifactory\"></a>使用 Pipeline 调用 Artifactory</h2><p>这里演示了两种方式，我在项目中用的是 Jenkins Shared Library；当然你也可以仅仅使用 Jenkinsfile，把如下两个 groovy 文件组合成一个 Jenkinsfile。</p>\n<h3 id=\"方式1：Jenkins-Shared-Library\"><a href=\"#方式1：Jenkins-Shared-Library\" class=\"headerlink\" title=\"方式1：Jenkins Shared Library\"></a>方式1：Jenkins Shared Library</h3><p><code>build.groovy</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">def <span class=\"function\"><span class=\"title\">call</span></span>() &#123;</span><br><span class=\"line\">  pipeline &#123;</span><br><span class=\"line\">    <span class=\"comment\"># 省略其他代码</span></span><br><span class=\"line\">    post &#123;</span><br><span class=\"line\">      <span class=\"comment\"># 这里只有在 Jenkins Job 成功的时候才将 build post 到 artifactory</span></span><br><span class=\"line\">      success &#123;</span><br><span class=\"line\">        script &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (env.BRANCH_NAME == <span class=\"string\">&#x27;develop&#x27;</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\"># 如果当前是 develop 分支，则将 release 和 debug build 都 post 到 artifactory</span></span><br><span class=\"line\">            artifactory(<span class=\"string\">&quot;<span class=\"variable\">$&#123;PATTERN_RELEASE_PATH&#125;</span>&quot;</span>, <span class=\"string\">&quot;<span class=\"variable\">$&#123;TARGET_PATH&#125;</span>&quot;</span>, <span class=\"string\">&quot;<span class=\"variable\">$&#123;BUILD_NAME&#125;</span>&quot;</span>, <span class=\"string\">&quot;<span class=\"variable\">$&#123;BUILD_NUMBER&#125;</span>&quot;</span>)</span><br><span class=\"line\">            artifactory(<span class=\"string\">&quot;<span class=\"variable\">$&#123;PATTERN_DEBUG_PATH&#125;</span>&quot;</span>,   <span class=\"string\">&quot;<span class=\"variable\">$&#123;TARGET_PATH&#125;</span>&quot;</span>, <span class=\"string\">&quot;<span class=\"variable\">$&#123;BUILD_NAME&#125;</span>&quot;</span>, <span class=\"string\">&quot;<span class=\"variable\">$&#123;BUILD_NUMBER&#125;</span>&quot;</span>)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (env.BRANCH_NAME.startsWith(<span class=\"string\">&#x27;PR&#x27;</span>)) &#123;</span><br><span class=\"line\">            <span class=\"comment\"># 如果当前是 pull request 分支，则只将 release build 都 post 到 artifactory</span></span><br><span class=\"line\">            artifactory(<span class=\"string\">&quot;<span class=\"variable\">$&#123;PATTERN_RELEASE_PATH&#125;</span>&quot;</span>, <span class=\"string\">&quot;<span class=\"variable\">$&#123;TARGET_PATH&#125;</span>&quot;</span>, <span class=\"string\">&quot;<span class=\"variable\">$&#123;BUILD_NAME&#125;</span>&quot;</span>, <span class=\"string\">&quot;<span class=\"variable\">$&#123;BUILD_NUMBER&#125;</span>&quot;</span>)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>artifactory.groovy</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">import groovy.transform.Field</span><br><span class=\"line\"></span><br><span class=\"line\">@Field artifactoryServerId   = <span class=\"string\">&quot;art-1&quot;</span></span><br><span class=\"line\">@Field artifactoryURL        = <span class=\"string\">&quot;http://art.company.com:8040/artifactory&quot;</span></span><br><span class=\"line\">@Field artifactoryCredential = <span class=\"string\">&quot;d1cbab74-823d-41aa-abb7&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">def call(String patternPath, String targetPath, String buildName, String buildNumber) &#123;</span><br><span class=\"line\">  rtServer (</span><br><span class=\"line\">    <span class=\"built_in\">id</span>: <span class=\"string\">&quot;<span class=\"variable\">$&#123;artifactoryServerId&#125;</span>&quot;</span>,</span><br><span class=\"line\">    url: <span class=\"string\">&quot;<span class=\"variable\">$&#123;artifactoryURL&#125;</span>&quot;</span>,</span><br><span class=\"line\">    credentialsId: <span class=\"string\">&quot;<span class=\"variable\">$&#123;artifactoryCredential&#125;</span>&quot;</span></span><br><span class=\"line\">  )</span><br><span class=\"line\">  rtPublishBuildInfo (</span><br><span class=\"line\">      serverId: <span class=\"string\">&quot;<span class=\"variable\">$&#123;artifactoryServerId&#125;</span>&quot;</span></span><br><span class=\"line\">  )</span><br><span class=\"line\">  rtUpload (</span><br><span class=\"line\">    serverId: <span class=\"string\">&quot;<span class=\"variable\">$&#123;artifactoryServerId&#125;</span>&quot;</span>,</span><br><span class=\"line\">    spec: <span class=\"string\">&quot;&quot;</span><span class=\"string\">&quot;&#123;</span></span><br><span class=\"line\"><span class=\"string\">      &quot;</span>files<span class=\"string\">&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">        &#123;</span></span><br><span class=\"line\"><span class=\"string\">        &quot;</span>pattern<span class=\"string\">&quot;: &quot;</span><span class=\"variable\">$&#123;patternPath&#125;</span><span class=\"string\">&quot;,</span></span><br><span class=\"line\"><span class=\"string\">        &quot;</span>target<span class=\"string\">&quot;: &quot;</span><span class=\"variable\">$&#123;targetPath&#125;</span><span class=\"string\">&quot;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">      ]</span></span><br><span class=\"line\"><span class=\"string\">    &#125;&quot;</span><span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">    buildNumber: <span class=\"string\">&quot;<span class=\"variable\">$&#123;buildNumber&#125;</span>&quot;</span>,</span><br><span class=\"line\">    buildName: <span class=\"string\">&quot;<span class=\"variable\">$&#123;buildName&#125;</span>&quot;</span>,</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"方式2：Jenkinsfile\"><a href=\"#方式2：Jenkinsfile\" class=\"headerlink\" title=\"方式2：Jenkinsfile\"></a>方式2：Jenkinsfile</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">pipeline &#123;</span><br><span class=\"line\">  <span class=\"comment\"># 省略其他代码</span></span><br><span class=\"line\">  stage(<span class=\"string\">&#x27;config art&#x27;</span>)&#123;</span><br><span class=\"line\">    rtServer (</span><br><span class=\"line\">    <span class=\"built_in\">id</span>: <span class=\"string\">&quot;art-1&quot;</span>,</span><br><span class=\"line\">    url: <span class=\"string\">&quot;http://art.company.com:8040/artifactory&quot;</span>,</span><br><span class=\"line\">    credentialsId: <span class=\"string\">&quot;d1cbab74-823d-41aa-abb7&quot;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  post &#123;</span><br><span class=\"line\">    <span class=\"comment\"># 这里只有在 Jenkins Job 成功的时候才将 build post 到 artifactory</span></span><br><span class=\"line\">    success &#123;</span><br><span class=\"line\">      script &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (env.BRANCH_NAME == <span class=\"string\">&#x27;develop&#x27;</span>) &#123;</span><br><span class=\"line\">          rtUpload (</span><br><span class=\"line\">            serverId: <span class=\"string\">&quot;art-1&quot;</span>,</span><br><span class=\"line\">            spec: <span class=\"string\">&quot;&quot;</span><span class=\"string\">&quot;&#123;</span></span><br><span class=\"line\"><span class=\"string\">              &quot;</span>files<span class=\"string\">&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">                &#123;</span></span><br><span class=\"line\"><span class=\"string\">                &quot;</span>pattern<span class=\"string\">&quot;: &quot;</span>/release/build/*.zip<span class=\"string\">&quot;,</span></span><br><span class=\"line\"><span class=\"string\">                &quot;</span>target<span class=\"string\">&quot;: &quot;</span>demo/develop/<span class=\"string\">&quot;</span></span><br><span class=\"line\"><span class=\"string\">                &#125;</span></span><br><span class=\"line\"><span class=\"string\">              ]</span></span><br><span class=\"line\"><span class=\"string\">            &#125;&quot;</span><span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">            buildNumber: <span class=\"string\">&quot;<span class=\"variable\">$&#123;buildNumber&#125;</span>&quot;</span>,</span><br><span class=\"line\">            buildName: <span class=\"string\">&quot;<span class=\"variable\">$&#123;buildName&#125;</span>&quot;</span>,</span><br><span class=\"line\">          )</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (env.BRANCH_NAME.startsWith(<span class=\"string\">&#x27;PR&#x27;</span>)) &#123;</span><br><span class=\"line\">          rtUpload (</span><br><span class=\"line\">            serverId: <span class=\"string\">&quot;art-1&quot;</span>,</span><br><span class=\"line\">            spec: <span class=\"string\">&quot;&quot;</span><span class=\"string\">&quot;&#123;</span></span><br><span class=\"line\"><span class=\"string\">                &quot;</span>files<span class=\"string\">&quot;: [</span></span><br><span class=\"line\"><span class=\"string\">                  &#123;</span></span><br><span class=\"line\"><span class=\"string\">                  &quot;</span>pattern<span class=\"string\">&quot;: &quot;</span>/release/build/*.zip<span class=\"string\">&quot;,</span></span><br><span class=\"line\"><span class=\"string\">                  &quot;</span>target<span class=\"string\">&quot;: &quot;</span>demo/pull-request/<span class=\"string\">&quot;</span></span><br><span class=\"line\"><span class=\"string\">                  &#125;</span></span><br><span class=\"line\"><span class=\"string\">                ]</span></span><br><span class=\"line\"><span class=\"string\">            &#125;&quot;</span><span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">            buildNumber: <span class=\"string\">&quot;<span class=\"variable\">$&#123;buildNumber&#125;</span>&quot;</span>,</span><br><span class=\"line\">            buildName: <span class=\"string\">&quot;<span class=\"variable\">$&#123;buildName&#125;</span>&quot;</span>,</span><br><span class=\"line\">          )</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Jenkins-与-Artifactory-集成成功\"><a href=\"#Jenkins-与-Artifactory-集成成功\" class=\"headerlink\" title=\"Jenkins 与 Artifactory 集成成功\"></a>Jenkins 与 Artifactory 集成成功</h2><p>蓝色表示构建成功，绿色圆圈表示 Build 已经 Post 到 Artifactory 上了。</p>\n<p><img src=\"/2019/11/artifactory-integrate-with-jenkins/post-to-artifactory.png\" alt=\"显示构建以及 Post 成功\"></p>\n<p>点击绿色圆圈可以跳转到 Artifactory 看到制品。</p>\n<p><img src=\"/2019/11/artifactory-integrate-with-jenkins/artifactory-builds.png\" alt=\"Artifactory\"></p>\n<p>Jenkins 与 Artifactory 打通了。完！</p>","categories":[{"name":"JFrog","path":"api/categories/JFrog.json"}],"tags":[{"name":"Jenkins","path":"api/tags/Jenkins.json"},{"name":"Artifactory","path":"api/tags/Artifactory.json"}]}