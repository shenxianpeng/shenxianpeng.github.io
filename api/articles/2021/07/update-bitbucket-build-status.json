{"title":"Add or update Bitbucket build status with REST API","slug":"2021/07/update-bitbucket-build-status","date":"2021-07-25T12:26:02.000Z","updated":"2021-07-27T15:24:29.412Z","comments":true,"path":"api/articles/2021/07/update-bitbucket-build-status.json","excerpt":"BackgorudWhen you want to add build status to your Bitbucket the specific commit of a branch when you start a build from the branchWhen the build status is wrong, you want to update it manually. for example, update build status from FAILED to SUCCESSFULYou can call Bitbucket REST API to do these.Code snippetBelow is the code snippet to update Bitbucket build status with REST API in the shell script.The code on GitHub Gist: https://gist.github.com/shenxianpeng/bd5eddc5fb39e54110afb8e2e7a6c4fbClick Read More to view the code here.","covers":["/2021/07/update-bitbucket-build-status/build-status.png"],"content":"<h2 id=\"Backgorud\"><a href=\"#Backgorud\" class=\"headerlink\" title=\"Backgorud\"></a>Backgorud</h2><ol>\n<li><p>When you want to <strong>add</strong> build status to your Bitbucket the specific commit of a branch when you start a build from the branch</p>\n</li>\n<li><p>When the build status is wrong, you want to <strong>update</strong> it manually. for example, update build status from FAILED to SUCCESSFUL</p>\n</li>\n</ol>\n<p>You can call Bitbucket REST API to do these.</p>\n<h2 id=\"Code-snippet\"><a href=\"#Code-snippet\" class=\"headerlink\" title=\"Code snippet\"></a>Code snippet</h2><p>Below is the code snippet to update Bitbucket build status with REST API in the shell script.</p>\n<p>The code on GitHub Gist: <a href=\"https://gist.github.com/shenxianpeng/bd5eddc5fb39e54110afb8e2e7a6c4fb\" target=\"_blank\" rel=\"noopener\">https://gist.github.com/shenxianpeng/bd5eddc5fb39e54110afb8e2e7a6c4fb</a></p>\n<p>Click <strong>Read More</strong> to view the code here.</p>\n<a id=\"more\"></a>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"></span><br><span class=\"line\">username=your-bitbucket-user</span><br><span class=\"line\">password=your-bitbucket-password</span><br><span class=\"line\"></span><br><span class=\"line\">commit_id=<span class=\"string\">'57587d7d4892bc4ef2c4375028c19b27921e2485'</span></span><br><span class=\"line\"><span class=\"comment\"># build_result has 3 status: SUCCESSFUL, FAILED, INPROGRESS</span></span><br><span class=\"line\">build_result=<span class=\"string\">'SUCCESSFUL'</span></span><br><span class=\"line\">description=<span class=\"string\">'Manully update bitbucket status'</span></span><br><span class=\"line\"></span><br><span class=\"line\">build_name=<span class=\"string\">'test #1'</span></span><br><span class=\"line\">build_url=http://localhost:8080/job/<span class=\"built_in\">test</span>/</span><br><span class=\"line\"></span><br><span class=\"line\">bitbucket_rest_api=<span class=\"string\">'https://myorg.bitbucket.com/rest/build-status/latest/commits'</span></span><br><span class=\"line\"></span><br><span class=\"line\">gen_post_data()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">cat &lt;&lt;EOF</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"state\"</span>: <span class=\"string\">\"<span class=\"variable\">$build_result</span>\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"key\"</span>: <span class=\"string\">\"<span class=\"variable\">$commit_id</span>\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"name\"</span>: <span class=\"string\">\"<span class=\"variable\">$build_name</span>\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"url\"</span>: <span class=\"string\">\"<span class=\"variable\">$build_url</span>\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"description\"</span>: <span class=\"string\">\"<span class=\"variable\">$description</span>\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$(gen_post_data)</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">curl -u <span class=\"variable\">$username</span>:<span class=\"variable\">$password</span> \\</span><br><span class=\"line\">-H <span class=\"string\">\"Accept: application/json\"</span> \\</span><br><span class=\"line\">-H <span class=\"string\">\"Content-Type:application/json\"</span> \\</span><br><span class=\"line\">-X POST <span class=\"variable\">$bitbucket_rest_api</span>/<span class=\"variable\">$commit_id</span> --data <span class=\"string\">\"<span class=\"variable\">$(gen_post_data)</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ $? -ne 0 ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$0</span>: Update bitbucket build status failed.\"</span></span><br><span class=\"line\">  <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$0</span>: Update bitbucket build status success.\"</span></span><br><span class=\"line\">  <span class=\"built_in\">exit</span> 0</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n\n<p>And the screenshot of the final update result</p>\n<p><img src=\"/2021/07/update-bitbucket-build-status/build-status.png\" alt=\"Bitbucket build status\"></p>\n","more":"<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"></span><br><span class=\"line\">username=your-bitbucket-user</span><br><span class=\"line\">password=your-bitbucket-password</span><br><span class=\"line\"></span><br><span class=\"line\">commit_id=<span class=\"string\">'57587d7d4892bc4ef2c4375028c19b27921e2485'</span></span><br><span class=\"line\"><span class=\"comment\"># build_result has 3 status: SUCCESSFUL, FAILED, INPROGRESS</span></span><br><span class=\"line\">build_result=<span class=\"string\">'SUCCESSFUL'</span></span><br><span class=\"line\">description=<span class=\"string\">'Manully update bitbucket status'</span></span><br><span class=\"line\"></span><br><span class=\"line\">build_name=<span class=\"string\">'test #1'</span></span><br><span class=\"line\">build_url=http://localhost:8080/job/<span class=\"built_in\">test</span>/</span><br><span class=\"line\"></span><br><span class=\"line\">bitbucket_rest_api=<span class=\"string\">'https://myorg.bitbucket.com/rest/build-status/latest/commits'</span></span><br><span class=\"line\"></span><br><span class=\"line\">gen_post_data()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">cat &lt;&lt;EOF</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"state\"</span>: <span class=\"string\">\"<span class=\"variable\">$build_result</span>\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"key\"</span>: <span class=\"string\">\"<span class=\"variable\">$commit_id</span>\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"name\"</span>: <span class=\"string\">\"<span class=\"variable\">$build_name</span>\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"url\"</span>: <span class=\"string\">\"<span class=\"variable\">$build_url</span>\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"description\"</span>: <span class=\"string\">\"<span class=\"variable\">$description</span>\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$(gen_post_data)</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">curl -u <span class=\"variable\">$username</span>:<span class=\"variable\">$password</span> \\</span><br><span class=\"line\">-H <span class=\"string\">\"Accept: application/json\"</span> \\</span><br><span class=\"line\">-H <span class=\"string\">\"Content-Type:application/json\"</span> \\</span><br><span class=\"line\">-X POST <span class=\"variable\">$bitbucket_rest_api</span>/<span class=\"variable\">$commit_id</span> --data <span class=\"string\">\"<span class=\"variable\">$(gen_post_data)</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ $? -ne 0 ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$0</span>: Update bitbucket build status failed.\"</span></span><br><span class=\"line\">  <span class=\"built_in\">exit</span> 1</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">  <span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$0</span>: Update bitbucket build status success.\"</span></span><br><span class=\"line\">  <span class=\"built_in\">exit</span> 0</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n\n<p>And the screenshot of the final update result</p>\n<p><img src=\"/2021/07/update-bitbucket-build-status/build-status.png\" alt=\"Bitbucket build status\"></p>","categories":[{"name":"DevOps","path":"api/categories/DevOps.json"}],"tags":[{"name":"Shell","path":"api/tags/Shell.json"},{"name":"Bitbucket","path":"api/tags/Bitbucket.json"}]}