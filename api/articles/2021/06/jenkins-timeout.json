{"title":"How to make Jenkins job fail after timeout? (Resolved)","slug":"2021/06/jenkins-timeout","date":"2021-06-24T03:00:45.000Z","updated":"2021-07-15T16:02:04.467Z","comments":true,"path":"api/articles/2021/06/jenkins-timeout.json","excerpt":null,"covers":null,"content":"<p>I’ve run into some situations when the build fails, perhaps because some processes don’t finish, and even setting a timeout doesn’t make the Jenkins job fail.</p>\n<p>So, to fix this problem, I used <code>try</code> .. <code>catch</code> and <code>error</code> to make my Jenkins job failed, hopes this also helps you.</p>\n<p>Please see the following example:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipeline &#123;</span><br><span class=\"line\">    agent none</span><br><span class=\"line\">    stages &#123;</span><br><span class=\"line\">        stage(<span class=\"string\">'Hello'</span>) &#123;</span><br><span class=\"line\">            steps &#123;</span><br><span class=\"line\">                script &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        timeout(time: <span class=\"number\">1</span>, unit: <span class=\"string\">'SECONDS'</span>) &#123;</span><br><span class=\"line\">                            echo <span class=\"string\">\"timeout step\"</span></span><br><span class=\"line\">                            sleep <span class=\"number\">2</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span>(err) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// timeout reached</span></span><br><span class=\"line\">                        println err</span><br><span class=\"line\">                        echo <span class=\"string\">'Time out reached.'</span></span><br><span class=\"line\">                        error <span class=\"string\">'build timeout failed'</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Here is the output log</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00:00:01.326  [Pipeline] Start of Pipeline</span><br><span class=\"line\">00:00:01.475  [Pipeline] stage</span><br><span class=\"line\">00:00:01.478  [Pipeline] &#123; (Hello)</span><br><span class=\"line\">00:00:01.516  [Pipeline] script</span><br><span class=\"line\">00:00:01.521  [Pipeline] &#123;</span><br><span class=\"line\">00:00:01.534  [Pipeline] timeout</span><br><span class=\"line\">00:00:01.534  Timeout set to expire in 1 sec</span><br><span class=\"line\">00:00:01.537  [Pipeline] &#123;</span><br><span class=\"line\">00:00:01.547  [Pipeline] echo</span><br><span class=\"line\">00:00:01.548  timeout step</span><br><span class=\"line\">00:00:01.555  [Pipeline] sleep</span><br><span class=\"line\">00:00:01.558  Sleeping for 2 sec</span><br><span class=\"line\">00:00:02.535  Cancelling nested steps due to timeout</span><br><span class=\"line\">00:00:02.546  [Pipeline] &#125;</span><br><span class=\"line\">00:00:02.610  [Pipeline] &#x2F;&#x2F; timeout</span><br><span class=\"line\">00:00:02.619  [Pipeline] echo</span><br><span class=\"line\">00:00:02.621  org.jenkinsci.plugins.workflow.steps.FlowInterruptedException</span><br><span class=\"line\">00:00:02.625  [Pipeline] echo</span><br><span class=\"line\">00:00:02.627  Time out reached.</span><br><span class=\"line\">00:00:02.630  [Pipeline] error</span><br><span class=\"line\">00:00:02.638  [Pipeline] &#125;</span><br><span class=\"line\">00:00:02.656  [Pipeline] &#x2F;&#x2F; script</span><br><span class=\"line\">00:00:02.668  [Pipeline] &#125;</span><br><span class=\"line\">00:00:02.681  [Pipeline] &#x2F;&#x2F; stage</span><br><span class=\"line\">00:00:02.696  [Pipeline] End of Pipeline</span><br><span class=\"line\">00:00:02.709  ERROR: build timeout failed</span><br><span class=\"line\">00:00:02.710  Finished: FAILURE</span><br></pre></td></tr></table></figure>\n","more":"<p>I’ve run into some situations when the build fails, perhaps because some processes don’t finish, and even setting a timeout doesn’t make the Jenkins job fail.</p>\n<p>So, to fix this problem, I used <code>try</code> .. <code>catch</code> and <code>error</code> to make my Jenkins job failed, hopes this also helps you.</p>\n<p>Please see the following example:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pipeline &#123;</span><br><span class=\"line\">    agent none</span><br><span class=\"line\">    stages &#123;</span><br><span class=\"line\">        stage(<span class=\"string\">'Hello'</span>) &#123;</span><br><span class=\"line\">            steps &#123;</span><br><span class=\"line\">                script &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        timeout(time: <span class=\"number\">1</span>, unit: <span class=\"string\">'SECONDS'</span>) &#123;</span><br><span class=\"line\">                            echo <span class=\"string\">\"timeout step\"</span></span><br><span class=\"line\">                            sleep <span class=\"number\">2</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span>(err) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// timeout reached</span></span><br><span class=\"line\">                        println err</span><br><span class=\"line\">                        echo <span class=\"string\">'Time out reached.'</span></span><br><span class=\"line\">                        error <span class=\"string\">'build timeout failed'</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Here is the output log</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00:00:01.326  [Pipeline] Start of Pipeline</span><br><span class=\"line\">00:00:01.475  [Pipeline] stage</span><br><span class=\"line\">00:00:01.478  [Pipeline] &#123; (Hello)</span><br><span class=\"line\">00:00:01.516  [Pipeline] script</span><br><span class=\"line\">00:00:01.521  [Pipeline] &#123;</span><br><span class=\"line\">00:00:01.534  [Pipeline] timeout</span><br><span class=\"line\">00:00:01.534  Timeout set to expire in 1 sec</span><br><span class=\"line\">00:00:01.537  [Pipeline] &#123;</span><br><span class=\"line\">00:00:01.547  [Pipeline] echo</span><br><span class=\"line\">00:00:01.548  timeout step</span><br><span class=\"line\">00:00:01.555  [Pipeline] sleep</span><br><span class=\"line\">00:00:01.558  Sleeping for 2 sec</span><br><span class=\"line\">00:00:02.535  Cancelling nested steps due to timeout</span><br><span class=\"line\">00:00:02.546  [Pipeline] &#125;</span><br><span class=\"line\">00:00:02.610  [Pipeline] &#x2F;&#x2F; timeout</span><br><span class=\"line\">00:00:02.619  [Pipeline] echo</span><br><span class=\"line\">00:00:02.621  org.jenkinsci.plugins.workflow.steps.FlowInterruptedException</span><br><span class=\"line\">00:00:02.625  [Pipeline] echo</span><br><span class=\"line\">00:00:02.627  Time out reached.</span><br><span class=\"line\">00:00:02.630  [Pipeline] error</span><br><span class=\"line\">00:00:02.638  [Pipeline] &#125;</span><br><span class=\"line\">00:00:02.656  [Pipeline] &#x2F;&#x2F; script</span><br><span class=\"line\">00:00:02.668  [Pipeline] &#125;</span><br><span class=\"line\">00:00:02.681  [Pipeline] &#x2F;&#x2F; stage</span><br><span class=\"line\">00:00:02.696  [Pipeline] End of Pipeline</span><br><span class=\"line\">00:00:02.709  ERROR: build timeout failed</span><br><span class=\"line\">00:00:02.710  Finished: FAILURE</span><br></pre></td></tr></table></figure>\n","categories":[{"name":"Jenkins","path":"api/categories/Jenkins.json"}],"tags":[{"name":"Jenkins","path":"api/tags/Jenkins.json"}]}