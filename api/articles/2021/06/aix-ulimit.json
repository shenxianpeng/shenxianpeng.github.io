{"title":"通过解除文件资源限制：解决在 AIX 使用 Git 下载大容量仓库失败问题","slug":"2021/06/aix-ulimit","date":"2021-06-17T05:52:44.000Z","updated":"2025-06-22T16:13:24.357Z","comments":true,"path":"api/articles/2021/06/aix-ulimit.json","excerpt":"最近使用 AIX 7.1 从 Bitbucket 下载代码的时候遇到了这个错误：","covers":null,"content":"<p>最近使用 AIX 7.1 从 Bitbucket 下载代码的时候遇到了这个错误：</p>\n<span id=\"more\"></span>\n<p><code>fatal: write error: A file cannot be larger than the value set by ulimit.</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">clone</span> -b dev https://&lt;username&gt;:&lt;password&gt;@git.company.com/scm/vmcc/opensrc.git --depth 1</span><br><span class=\"line\">Cloning into <span class=\"string\">&#x27;opensrc&#x27;</span>...</span><br><span class=\"line\">remote: Counting objects: 2390, <span class=\"keyword\">done</span>.</span><br><span class=\"line\">remote: Compressing objects: 100% (1546/1546), <span class=\"keyword\">done</span>.</span><br><span class=\"line\">fatal: write error: A file cannot be larger than the value <span class=\"built_in\">set</span> by <span class=\"built_in\">ulimit</span>.</span><br><span class=\"line\">fatal: index-pack failed</span><br></pre></td></tr></table></figure>\n\n<p>在 AIX 7.3 我遇到的是这个错误：</p>\n<p><code>fatal: fetch-pack: invalid index-pack output</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">clone</span> -b dev https://&lt;username&gt;:&lt;password&gt;@git.company.com/scm/vmcc/opensrc.git --depth 1</span><br><span class=\"line\">Cloning into <span class=\"string\">&#x27;opensrc&#x27;</span>...</span><br><span class=\"line\">remote: Counting objects: 2390, <span class=\"keyword\">done</span>.</span><br><span class=\"line\">remote: Compressing objects: 100% (1546/1546), <span class=\"keyword\">done</span>.</span><br><span class=\"line\">fatal: write error: File too large68), 1012.13 MiB | 15.38 MiB/s</span><br><span class=\"line\">fatal: fetch-pack: invalid index-pack output</span><br></pre></td></tr></table></figure>\n\n<p>这是由于这个仓库里的文件太大，超过了 AIX 对于用户文件资源使用的上限。</p>\n<p>通过 <code>ulimit -a</code> 可以来查看。更多关于 <code>ulimit</code> 命令的使用 <a href=\"https://www.ibm.com/docs/en/aix/7.1?topic=u-ulimit-command\">ulimit Command</a></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">ulimit</span> -a</span><br><span class=\"line\"><span class=\"keyword\">time</span>(seconds)        unlimited</span><br><span class=\"line\">file(blocks)         2097151</span><br><span class=\"line\">data(kbytes)         unlimited</span><br><span class=\"line\">stack(kbytes)        32768</span><br><span class=\"line\">memory(kbytes)       32768</span><br><span class=\"line\">coredump(blocks)     2097151</span><br><span class=\"line\">nofiles(descriptors) 2000</span><br><span class=\"line\">threads(per process) unlimited</span><br><span class=\"line\">processes(per user)  unlimited</span><br></pre></td></tr></table></figure>\n\n<p>可以看到 file 有一个上限值 2097151。如果将它也改成 unlimited 应该就好了。</p>\n<p>通过 root 用户可以访问到 limits 文件 <code>/etc/security/limits</code>(普通用户没权限访问)。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 以下是这个文件里的部分内容</span></span><br><span class=\"line\"></span><br><span class=\"line\">default:</span><br><span class=\"line\">        fsize = 2097151</span><br><span class=\"line\">        core = 2097151</span><br><span class=\"line\">        cpu = -1</span><br><span class=\"line\">        data = -1</span><br><span class=\"line\">        rss = 65536</span><br><span class=\"line\">        stack = 65536</span><br><span class=\"line\">        nofiles = 2000</span><br></pre></td></tr></table></figure>\n\n<p>将上述的值 fsize &#x3D; 2097151 改成 fsize &#x3D; -1 就将解除了文件块大小的限制了。修改完成后，<strong>重新登录</strong>来让这次修改生效。</p>\n<p>再次执行 <code>ulimit -a</code>，已经生效了。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">ulimit</span> -a</span><br><span class=\"line\"><span class=\"keyword\">time</span>(seconds)        unlimited</span><br><span class=\"line\">file(blocks)         unlimited</span><br><span class=\"line\">data(kbytes)         unlimited</span><br><span class=\"line\">stack(kbytes)        32768</span><br><span class=\"line\">memory(kbytes)       32768</span><br><span class=\"line\">coredump(blocks)     2097151</span><br><span class=\"line\">nofiles(descriptors) 2000</span><br><span class=\"line\">threads(per process) unlimited</span><br><span class=\"line\">processes(per user)  unlimited</span><br></pre></td></tr></table></figure>\n\n<p>此时 file(blocks) 已经变成 unlimited 了。再次尝试 git clone</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> -b dev https://&lt;username&gt;:&lt;password&gt;@git.company.com/scm/vmcc/opensrc.git --depth 1</span><br><span class=\"line\">Cloning into <span class=\"string\">&#x27;opensrc&#x27;</span>...</span><br><span class=\"line\">remote: Counting objects: 2390, <span class=\"keyword\">done</span>.</span><br><span class=\"line\">remote: Compressing objects: 100% (1546/1546), <span class=\"keyword\">done</span>.</span><br><span class=\"line\">remote: Total 2390 (delta 763), reused 2369 (delta 763)</span><br><span class=\"line\">Receiving objects: 100% (2390/2390), 3.80 GiB | 3.92 MiB/s, <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Resolving deltas: 100% (763/763), <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Checking out files: 100% (3065/3065), <span class=\"keyword\">done</span>.</span><br></pre></td></tr></table></figure>\n\n<p>这次就成功了！</p>\n","more":"<p><code>fatal: write error: A file cannot be larger than the value set by ulimit.</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">clone</span> -b dev https://&lt;username&gt;:&lt;password&gt;@git.company.com/scm/vmcc/opensrc.git --depth 1</span><br><span class=\"line\">Cloning into <span class=\"string\">&#x27;opensrc&#x27;</span>...</span><br><span class=\"line\">remote: Counting objects: 2390, <span class=\"keyword\">done</span>.</span><br><span class=\"line\">remote: Compressing objects: 100% (1546/1546), <span class=\"keyword\">done</span>.</span><br><span class=\"line\">fatal: write error: A file cannot be larger than the value <span class=\"built_in\">set</span> by <span class=\"built_in\">ulimit</span>.</span><br><span class=\"line\">fatal: index-pack failed</span><br></pre></td></tr></table></figure>\n\n<p>在 AIX 7.3 我遇到的是这个错误：</p>\n<p><code>fatal: fetch-pack: invalid index-pack output</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ git <span class=\"built_in\">clone</span> -b dev https://&lt;username&gt;:&lt;password&gt;@git.company.com/scm/vmcc/opensrc.git --depth 1</span><br><span class=\"line\">Cloning into <span class=\"string\">&#x27;opensrc&#x27;</span>...</span><br><span class=\"line\">remote: Counting objects: 2390, <span class=\"keyword\">done</span>.</span><br><span class=\"line\">remote: Compressing objects: 100% (1546/1546), <span class=\"keyword\">done</span>.</span><br><span class=\"line\">fatal: write error: File too large68), 1012.13 MiB | 15.38 MiB/s</span><br><span class=\"line\">fatal: fetch-pack: invalid index-pack output</span><br></pre></td></tr></table></figure>\n\n<p>这是由于这个仓库里的文件太大，超过了 AIX 对于用户文件资源使用的上限。</p>\n<p>通过 <code>ulimit -a</code> 可以来查看。更多关于 <code>ulimit</code> 命令的使用 <a href=\"https://www.ibm.com/docs/en/aix/7.1?topic=u-ulimit-command\">ulimit Command</a></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">ulimit</span> -a</span><br><span class=\"line\"><span class=\"keyword\">time</span>(seconds)        unlimited</span><br><span class=\"line\">file(blocks)         2097151</span><br><span class=\"line\">data(kbytes)         unlimited</span><br><span class=\"line\">stack(kbytes)        32768</span><br><span class=\"line\">memory(kbytes)       32768</span><br><span class=\"line\">coredump(blocks)     2097151</span><br><span class=\"line\">nofiles(descriptors) 2000</span><br><span class=\"line\">threads(per process) unlimited</span><br><span class=\"line\">processes(per user)  unlimited</span><br></pre></td></tr></table></figure>\n\n<p>可以看到 file 有一个上限值 2097151。如果将它也改成 unlimited 应该就好了。</p>\n<p>通过 root 用户可以访问到 limits 文件 <code>/etc/security/limits</code>(普通用户没权限访问)。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 以下是这个文件里的部分内容</span></span><br><span class=\"line\"></span><br><span class=\"line\">default:</span><br><span class=\"line\">        fsize = 2097151</span><br><span class=\"line\">        core = 2097151</span><br><span class=\"line\">        cpu = -1</span><br><span class=\"line\">        data = -1</span><br><span class=\"line\">        rss = 65536</span><br><span class=\"line\">        stack = 65536</span><br><span class=\"line\">        nofiles = 2000</span><br></pre></td></tr></table></figure>\n\n<p>将上述的值 fsize &#x3D; 2097151 改成 fsize &#x3D; -1 就将解除了文件块大小的限制了。修改完成后，<strong>重新登录</strong>来让这次修改生效。</p>\n<p>再次执行 <code>ulimit -a</code>，已经生效了。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">ulimit</span> -a</span><br><span class=\"line\"><span class=\"keyword\">time</span>(seconds)        unlimited</span><br><span class=\"line\">file(blocks)         unlimited</span><br><span class=\"line\">data(kbytes)         unlimited</span><br><span class=\"line\">stack(kbytes)        32768</span><br><span class=\"line\">memory(kbytes)       32768</span><br><span class=\"line\">coredump(blocks)     2097151</span><br><span class=\"line\">nofiles(descriptors) 2000</span><br><span class=\"line\">threads(per process) unlimited</span><br><span class=\"line\">processes(per user)  unlimited</span><br></pre></td></tr></table></figure>\n\n<p>此时 file(blocks) 已经变成 unlimited 了。再次尝试 git clone</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> -b dev https://&lt;username&gt;:&lt;password&gt;@git.company.com/scm/vmcc/opensrc.git --depth 1</span><br><span class=\"line\">Cloning into <span class=\"string\">&#x27;opensrc&#x27;</span>...</span><br><span class=\"line\">remote: Counting objects: 2390, <span class=\"keyword\">done</span>.</span><br><span class=\"line\">remote: Compressing objects: 100% (1546/1546), <span class=\"keyword\">done</span>.</span><br><span class=\"line\">remote: Total 2390 (delta 763), reused 2369 (delta 763)</span><br><span class=\"line\">Receiving objects: 100% (2390/2390), 3.80 GiB | 3.92 MiB/s, <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Resolving deltas: 100% (763/763), <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Checking out files: 100% (3065/3065), <span class=\"keyword\">done</span>.</span><br></pre></td></tr></table></figure>\n\n<p>这次就成功了！</p>","categories":[{"name":"AIX","path":"api/categories/AIX.json"}],"tags":[{"name":"Git","path":"api/tags/Git.json"},{"name":"AIX","path":"api/tags/AIX.json"},{"name":"ulimit","path":"api/tags/ulimit.json"}]}