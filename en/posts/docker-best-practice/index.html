<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>You Must Know These 17 Docker Best Practices! &#183; DevOps Engineer</title><meta name=title content="You Must Know These 17 Docker Best Practices! &#183; DevOps Engineer"><meta name=description content="This article shares some best practices to follow when writing Dockerfiles and using Docker, including suggestions on multi-stage builds, image optimization, and security."><meta name=keywords content="Dokerfile,Docker,"><link rel=canonical href=https://shenxianpeng.github.io/en/posts/docker-best-practice/><link type=text/css rel=stylesheet href=/css/main.bundle.min.d7672814413dccdcf76c504d9b0ebb8d0f964dbe6b30a3d4b25b15809a94c2eb732d99898aded2009aacdd1fa8b17cea1369fd81560790cd355aee00bbd142fd.css integrity="sha512-12coFEE9zNz3bFBNmw67jQ+WTb5rMKPUslsVgJqUwutzLZmJit7SAJqs3R+osXzqE2n9gVYHkM01Wu4Au9FC/Q=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.98bb8ce8f123e03c4d2171eeec151dd404b5c476beb5ef1068d0e8b1a2afb923065e6552fc14b2d867c85ee4bd8529a43193f729f874d3908517ba03b5d1cc57.js integrity="sha512-mLuM6PEj4DxNIXHu7BUd1AS1xHa+te8QaNDosaKvuSMGXmVS/BSy2GfIXuS9hSmkMZP3Kfh005CFF7oDtdHMVw==" data-copy=Copy data-copied=Copied></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://shenxianpeng.github.io/en/posts/docker-best-practice/"><meta property="og:site_name" content="DevOps Engineer"><meta property="og:title" content="You Must Know These 17 Docker Best Practices!"><meta property="og:description" content="This article shares some best practices to follow when writing Dockerfiles and using Docker, including suggestions on multi-stage builds, image optimization, and security."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-12T00:00:00+00:00"><meta property="article:modified_time" content="2022-01-12T00:00:00+00:00"><meta property="article:tag" content="Dokerfile"><meta property="article:tag" content="Docker"><meta property="og:image" content="https://shenxianpeng.github.io/posts/docker-best-practice/featured.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://shenxianpeng.github.io/posts/docker-best-practice/featured.png"><meta name=twitter:title content="You Must Know These 17 Docker Best Practices!"><meta name=twitter:description content="This article shares some best practices to follow when writing Dockerfiles and using Docker, including suggestions on multi-stage builds, image optimization, and security."><meta name=twitter:image content="https://shenxianpeng.github.io/posts/docker-best-practice/featured.png"><meta property="og:image" content="https://shenxianpeng.github.io/posts/docker-best-practice/featured.png"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"You Must Know These 17 Docker Best Practices!","headline":"You Must Know These 17 Docker Best Practices!","abstract":"This article shares some best practices to follow when writing Dockerfiles and using Docker, including suggestions on multi-stage builds, image optimization, and security.","inLanguage":"en","url":"https:\/\/shenxianpeng.github.io\/en\/posts\/docker-best-practice\/","author":{"@type":"Person","name":"Xianpeng Shen"},"copyrightYear":"2022","dateCreated":"2022-01-12T00:00:00\u002b00:00","datePublished":"2022-01-12T00:00:00\u002b00:00","dateModified":"2022-01-12T00:00:00\u002b00:00","keywords":["Dokerfile","Docker"],"mainEntityOfPage":"true","wordCount":"3928"}]</script><meta name=author content="Xianpeng Shen"><link href=index.xml rel=me><link href=https://github.com/shenxianpeng rel=me><link href=https://www.linkedin.com/in/xianpeng-shen/ rel=me><link href=https://medium.com/@xianpeng.shen/ rel=me><link href=https://dev.to/shenxianpeng rel=me><link href=https://www.youtube.com/@shenxianpeng rel=me><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-LDW3BHJTTW"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LDW3BHJTTW")</script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>
Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 pl-[24px] pr-[24px] z-100"><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div><div class="relative max-w-[64rem] ml-auto mr-auto"><div class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3 pt-[2px] pr-0 pb-[3px] pl-0"><div><a href=/en/ class=flex><span class=sr-only>DevOps Engineer</span>
<img src=/img/logo.png width=128 height=128 class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt="DevOps Engineer"></a></div><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/en/ class="text-base font-medium text-gray-500 hover:text-gray-900">DevOps Engineer</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/en/about/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=About>About</p></a><a href=/en/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Posts>Posts</p></a><a href=/en/misc/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Miscs>Mics</p></a><a href=/en/hireme/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title="Xianpeng Shen's Resume">HireMe</p></a><a href=/en/portfolio/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Portfolios>Portfolio</p></a><a href=https://x.com/shenxianpeng target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href=https://github.com/shenxianpeng target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span><p class="text-base font-medium" title></p></a><div><div class="cursor-pointer flex items-center nested-menu"><span class="ltr:mr-1 rtl:ml-1"><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span></span><div class="text-sm font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="You Must Know These 17 Docker Best Practices!">EN</div></div><div class="absolute menuhide"><div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl"><div class="flex flex-col space-y-3"><a href=/en/posts/docker-best-practice/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="You Must Know These 17 Docker Best Practices!">English</p></a><a href=/posts/docker-best-practice/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="你一定要了解这 17 条 Docker 最佳实践！">简体中文</p></a></div></div></div></div><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span><div><div class="cursor-pointer flex items-center nested-menu"><span class="ltr:mr-1 rtl:ml-1"><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span></span><div class="text-sm font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="You Must Know These 17 Docker Best Practices!">EN</div></div><div class="absolute menuhide"><div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl"><div class="flex flex-col space-y-3"><a href=/en/posts/docker-best-practice/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="You Must Know These 17 Docker Best Practices!">English</p></a><a href=/posts/docker-best-practice/ class="flex items-center"><p class="text-sm font-sm text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="你一定要了解这 17 条 Docker 最佳实践！">简体中文</p></a></div></div></div></div><button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-1 rtl:ml-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><div id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/en/about/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=About>About</p></a></li><li class=mt-1><a href=/en/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Posts>Posts</p></a></li><li class=mt-1><a href=/en/misc/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Miscs>Mics</p></a></li><li class=mt-1><a href=/en/hireme/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title="Xianpeng Shen's Resume">HireMe</p></a></li><li class=mt-1><a href=/en/portfolio/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Portfolios>Portfolio</p></a></li><li class=mt-1><a href=https://x.com/shenxianpeng target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span></div><p class="text-bg font-bg" title></p></a></li><li class=mt-1><a href=https://github.com/shenxianpeng target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></div><p class="text-bg font-bg" title></p></a></li></ul></div></div></div></div><script>(function(){var e=$(".main-menu"),t=window.location.pathname;e.find('a[href="'+t+'"]').each(function(e,t){$(t).children("p").addClass("active")})})()</script></div></div><script type=text/javascript src=/js/background-blur.min.0ad33cb9c066f652728b2cc09c9ceaf32645544f48e8b6b38f120d86f433ed997da275a49e6151fe0176430c45376812708d84727f3f969101fb44a4345b3f34.js integrity="sha512-CtM8ucBm9lJyiyzAnJzq8yZFVE9I6LazjxINhvQz7Zl9onWknmFR/gF2QwxFN2gScI2Ecn8/lpEB+0SkNFs/NA==" data-target-id=menu-blur></script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/en/></a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/en/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/en/posts/docker-best-practice/>You Must Know These 17 Docker Best Practices!</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">You Must Know These 17 Docker Best Practices!</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2022-01-12T00:00:00+00:00>2022-01-12</time><span class="px-2 text-primary-500">&#183;</span><span>3928 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">19 mins</span><span class="px-2 text-primary-500">&#183;</span>
<span class=mb-[2px]><a href=https://github.com/shenxianpeng/blog/tree/main/content/posts/docker-best-practice/index.en.md class="text-lg hover:text-primary-500" rel="noopener noreferrer" target=_blank title="Edit content"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg height="1em" viewBox="0 0 512 512"><path fill="currentColor" d="M441 58.9 453.1 71c9.4 9.4 9.4 24.6.0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9.0zM209.8 256.2 344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1L186.9 325l16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25 175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 1e2c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l1e2-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7.0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4.0 152V424c0 48.6 39.4 88 88 88H360c48.6.0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1.0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H2e2c13.3.0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg></span></span></a>
</span><span class="px-2 text-primary-500">&#183;</span>
<script type=text/javascript src=/js/zen-mode.min.9814dee9614d32aeb56239d118edfe20acd6231424f9b19c2dd48835038414130a5e946c0d1c9087d60e60e31840c9babfd217e3d4b95643dc8d651a71ccdf4a.js integrity="sha512-mBTe6WFNMq61YjnRGO3+IKzWIxQk+bGcLdSINQOEFBMKXpRsDRyQh9YOYOMYQMm6v9IX49S5VkPcjWUacczfSg=="></script><span class=mb-[2px]><span id=zen-mode-button class="text-lg hover:text-primary-500" title="Enable zen mode" data-title-i18n-disable="Enable zen mode" data-title-i18n-enable="Disable zen mode"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 50 50" width="50" height="50"><path fill="currentColor" d="M12.980469 4C9.1204688 4 5.9804688 7.14 5.9804688 11L6 26H9.9804688V11c0-1.65 1.3400002-3 3.0000002-3H40.019531c1.66.0 3 1.35 3 3V39c0 1.65-1.34 3-3 3H29c0 1.54-.579062 2.94-1.539062 4H40.019531c3.86.0 7-3.14 7-7V11c0-3.86-3.14-7-7-7H12.980469zM7 28c-2.206.0-4 1.794-4 4V42c0 2.206 1.794 4 4 4H23c2.206.0 4-1.794 4-4V32c0-2.206-1.794-4-4-4H7zm0 4H23L23.001953 42H7V32z"/></svg></span></span></span></span></div><div class="flex flex-row flex-wrap items-center"></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] mr-2" href=/en/tags/dokerfile/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Dokerfile
</span></span></a><a class="relative mt-[0.5rem] mr-2" href=/en/tags/docker/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Docker</span></span></a></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 alt="Xianpeng Shen" src=/img/sxp_hu_e622561bc4524c0d.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Xianpeng Shen</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:xianpeng.shen@gmail.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=index.xml target=_blank aria-label=Rss rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 64C0 46.3 14.3 32 32 32c229.8.0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7.0 64zM128 416c0 35.3-28.7 64-64 64S0 451.3.0 416s28.7-64 64-64 64 28.7 64 64zM32 160c159.1.0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7.0-32-14.3-32-32s14.3-32 32-32z"/></svg></span></span></a>
<a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/shenxianpeng target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.linkedin.com/in/xianpeng-shen/ target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://medium.com/@xianpeng.shen/ target=_blank aria-label=Medium rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M180.5 74.262C80.813 74.262.0 155.633.0 256S80.819 437.738 180.5 437.738 361 356.373 361 256 280.191 74.262 180.5 74.262zm288.25 10.646c-49.845.0-90.245 76.619-90.245 171.095s40.406 171.1 90.251 171.1 90.251-76.619 90.251-171.1H559C559 161.5 518.6 84.908 468.752 84.908zm139.506 17.821c-17.526.0-31.735 68.628-31.735 153.274s14.2 153.274 31.735 153.274S640 340.631 640 256c0-84.649-14.215-153.271-31.742-153.271z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://dev.to/shenxianpeng target=_blank aria-label=Dev rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88.0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59.0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21.0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44.0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44.0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.youtube.com/@shenxianpeng target=_blank aria-label=Youtube rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 576 512"><path fill="currentColor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78.0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#table-of-contents>Table of Contents</a></li><li><a href=#dockerfile-best-practices>Dockerfile Best Practices</a><ul><li><a href=#1-use-multi-stage-builds>1. Use Multi-Stage Builds</a></li><li><a href=#2-adjust-the-order-of-dockerfile-commands>2. Adjust the Order of Dockerfile Commands</a></li><li><a href=#3-use-small-base-docker-images>3. Use Small Base Docker Images</a></li><li><a href=#4-minimize-the-number-of-layers>4. Minimize the Number of Layers</a><ul><li><a href=#note>Note</a></li><li><a href=#tip>Tip</a></li></ul></li><li><a href=#5-use-unprivileged-containers>5. Use Unprivileged Containers</a></li><li><a href=#6-prefer-copy-over-add>6. Prefer <code>COPY</code> over <code>ADD</code></a></li><li><a href=#7-cache-python-packages-to-the-docker-host>7. Cache Python Packages to the Docker Host</a></li><li><a href=#8-run-only-one-process-per-container>8. Run Only One Process per Container</a></li><li><a href=#9-prefer-array-over-string-syntax>9. Prefer Array over String Syntax</a><ul><li><a href=#10-understand-the-difference-between-entrypoint-and-cmd>10. Understand the Difference Between <code>ENTRYPOINT</code> and <code>CMD</code></a></li></ul></li><li><a href=#11-add-health-checks-healthcheck>11. Add Health Checks <code>HEALTHCHECK</code></a></li></ul></li><li><a href=#docker-image-best-practices>Docker Image Best Practices</a><ul><li><a href=#1-docker-image-versioning>1. Docker Image Versioning</a></li><li><a href=#2-dont-store-secrets-in-images>2. Don&rsquo;t Store Secrets in Images</a><ul><li><a href=#environment-variables>Environment Variables</a></li><li><a href=#build-time-arguments>Build-Time Arguments</a></li><li><a href=#docker-secrets>Docker Secrets</a></li></ul></li></ul></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#table-of-contents>Table of Contents</a></li><li><a href=#dockerfile-best-practices>Dockerfile Best Practices</a><ul><li><a href=#1-use-multi-stage-builds>1. Use Multi-Stage Builds</a></li><li><a href=#2-adjust-the-order-of-dockerfile-commands>2. Adjust the Order of Dockerfile Commands</a></li><li><a href=#3-use-small-base-docker-images>3. Use Small Base Docker Images</a></li><li><a href=#4-minimize-the-number-of-layers>4. Minimize the Number of Layers</a><ul><li><a href=#note>Note</a></li><li><a href=#tip>Tip</a></li></ul></li><li><a href=#5-use-unprivileged-containers>5. Use Unprivileged Containers</a></li><li><a href=#6-prefer-copy-over-add>6. Prefer <code>COPY</code> over <code>ADD</code></a></li><li><a href=#7-cache-python-packages-to-the-docker-host>7. Cache Python Packages to the Docker Host</a></li><li><a href=#8-run-only-one-process-per-container>8. Run Only One Process per Container</a></li><li><a href=#9-prefer-array-over-string-syntax>9. Prefer Array over String Syntax</a><ul><li><a href=#10-understand-the-difference-between-entrypoint-and-cmd>10. Understand the Difference Between <code>ENTRYPOINT</code> and <code>CMD</code></a></li></ul></li><li><a href=#11-add-health-checks-healthcheck>11. Add Health Checks <code>HEALTHCHECK</code></a></li></ul></li><li><a href=#docker-image-best-practices>Docker Image Best Practices</a><ul><li><a href=#1-docker-image-versioning>1. Docker Image Versioning</a></li><li><a href=#2-dont-store-secrets-in-images>2. Don&rsquo;t Store Secrets in Images</a><ul><li><a href=#environment-variables>Environment Variables</a></li><li><a href=#build-time-arguments>Build-Time Arguments</a></li><li><a href=#docker-secrets>Docker Secrets</a></li></ul></li></ul></li></ul></nav></div></details><script>(function(){"use strict";const n=.33,s="#TableOfContents",o=".anchor",i='a[href^="#"]',a="li ul",r="active";function c(e,t){const s=window.scrollY+window.innerHeight*t,o=[...document.querySelectorAll('#TableOfContents a[href^="#"]')],n=new Set(o.map(e=>e.getAttribute("href").substring(1)));for(let t=e.length-1;t>=0;t--){const o=e[t].getBoundingClientRect().top+window.scrollY;if(o<=s&&n.has(e[t].id))return e[t].id}return e.find(e=>n.has(e.id))?.id||""}function e({toc:e,anchors:t,links:n,scrollOffset:s,collapseInactive:o}){const i=c(t,s);if(!i)return;if(n.forEach(e=>{const t=e.getAttribute("href")===`#${i}`;if(e.classList.toggle(r,t),o){const n=e.closest("li")?.querySelector("ul");n&&(n.style.display=t?"":"none")}}),o){const n=e.querySelector(`a[href="#${CSS.escape(i)}"]`);let t=n;for(;t&&t!==e;)t.tagName==="UL"&&(t.style.display=""),t.tagName==="LI"&&t.querySelector("ul")?.style.setProperty("display",""),t=t.parentElement}}function t(){const t=document.querySelector(s);if(!t)return;const c=!1,l=[...document.querySelectorAll(o)],d=[...t.querySelectorAll(i)];c&&t.querySelectorAll(a).forEach(e=>e.style.display="none");const r={toc:t,anchors:l,links:d,scrollOffset:n,collapseInactive:c};window.addEventListener("scroll",()=>e(r),{passive:!0}),window.addEventListener("hashchange",()=>e(r),{passive:!0}),e(r)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t()})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><p>This article shares some best practices to follow when writing Dockerfiles and using Docker. It&rsquo;s a long read, so consider bookmarking it to read later—you&rsquo;re guaranteed to learn a lot!</p><h2 class="relative group">Table of Contents<div id=table-of-contents class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#table-of-contents aria-label=Anchor>#</a></span></h2><p>Dockerfile Best Practices</p><ol><li>Use Multi-Stage Builds</li><li>Adjust the Order of Dockerfile Commands</li><li>Use Small Base Docker Images</li><li>Minimize the Number of Layers</li><li>Use Unprivileged Containers</li><li>Prefer <code>COPY</code> over <code>ADD</code></li><li>Cache Python Packages to the Docker Host</li><li>Run Only One Process per Container</li><li>Prefer Array over String Syntax</li><li>Understand the Difference Between <code>ENTRYPOINT</code> and <code>CMD</code></li><li>Add Health Checks <code>HEALTHCHECK</code></li></ol><p>Docker Image Best Practices</p><ol><li>Docker Image Versioning</li><li>Don&rsquo;t Store Secrets in Images</li><li>Use a <code>.dockerignore</code> File</li><li>Inspect and Scan Your Dockerfiles and Images</li><li>Sign and Verify Images</li><li>Set Memory and CPU Limits</li></ol><h2 class="relative group">Dockerfile Best Practices<div id=dockerfile-best-practices class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#dockerfile-best-practices aria-label=Anchor>#</a></span></h2><h3 class="relative group">1. Use Multi-Stage Builds<div id=1-use-multi-stage-builds class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#1-use-multi-stage-builds aria-label=Anchor>#</a></span></h3><p>Leverage the power of multi-stage builds to create leaner and more secure Docker images. Multi-stage Docker builds (<a href=https://docs.docker.com/develop/develop-images/multistage-build/ target=_blank>multi-stage builds</a>) allow you to divide your Dockerfile into several stages.</p><p>For example, you can have one stage for compiling and building your application, which can then be copied to a subsequent stage. Since only the last stage is used to create the image, dependencies and tools related to building the application are discarded, leaving a lean, modular, production-ready image.</p><p>Web development example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># Temporary stage</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> python:3.9-slim as builder</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    apt-get install -y --no-install-recommends gcc<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> requirements.txt .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip wheel --no-cache-dir --no-deps --wheel-dir /app/wheels -r requirements.txt<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Final stage</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> python:3.9-slim</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>builder /app/wheels /wheels<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>builder /app/requirements.txt .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install --no-cache /wheels/*<span class=err>
</span></span></span></code></pre></div><p>In this example, the GCC compiler is required when installing certain Python packages, so we add a temporary, build-time stage to handle the build stage.</p><p>Since the final runtime image doesn&rsquo;t contain GCC, it&rsquo;s leaner and more secure. Image size comparison:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>REPOSITORY                 TAG                    IMAGE ID       CREATED          SIZE
</span></span><span class=line><span class=cl>docker-single              latest                 8d6b6a4d7fb6   <span class=m>16</span> seconds ago   259MB
</span></span><span class=line><span class=cl>docker-multi               latest                 813c2fa9b114   <span class=m>3</span> minutes ago    156MB
</span></span></code></pre></div><p>Let&rsquo;s look at another example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># Temporary stage</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> python:3.9 as builder</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip wheel --no-cache-dir --no-deps --wheel-dir /wheels jupyter pandas<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Final stage</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> python:3.9-slim</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /notebooks</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>builder /wheels /wheels<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install --no-cache /wheels/*<span class=err>
</span></span></span></code></pre></div><p>Image size comparison:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>REPOSITORY                  TAG                   IMAGE ID       CREATED         SIZE
</span></span><span class=line><span class=cl>ds-multi                    latest                b4195deac742   <span class=m>2</span> minutes ago   357MB
</span></span><span class=line><span class=cl>ds-single                   latest                7c23c43aeda6   <span class=m>6</span> minutes ago   969MB
</span></span></code></pre></div><p>In summary, multi-stage builds can reduce the size of your production images, helping you save time and money. Additionally, this will simplify your production containers. Being smaller and simpler, they will have a relatively smaller attack surface.</p><h3 class="relative group">2. Adjust the Order of Dockerfile Commands<div id=2-adjust-the-order-of-dockerfile-commands class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#2-adjust-the-order-of-dockerfile-commands aria-label=Anchor>#</a></span></h3><p>Pay close attention to the order of your Dockerfile commands to leverage layer caching.</p><p>Docker caches each step (or layer) in a given Dockerfile to speed up subsequent builds. When a step changes, not only that step but all subsequent steps&rsquo; cache will be invalidated.</p><p>For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> python:3.9-slim</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> sample.py .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> requirements.txt .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install -r /requirements.txt<span class=err>
</span></span></span></code></pre></div><p>In this Dockerfile, we copy the application&rsquo;s code before installing the requirements. Now, every time we change <code>sample.py</code>, the build will reinstall the packages. This is highly inefficient, especially when using Docker containers as development environments. Therefore, putting frequently changing files towards the end of the Dockerfile is key.</p><blockquote><p>You can also prevent unnecessary cache invalidation by using a <code>.dockerignore</code> file to exclude unnecessary files from being added to the Docker build context and the final image. More on this later.</p></blockquote><p>Therefore, in the Dockerfile above, you should move the <code>COPY sample.py .</code> command to the bottom as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> python:3.9-slim</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> requirements.txt .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install -r /requirements.txt<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> sample.py .<span class=err>
</span></span></span></code></pre></div><p>Note:</p><ol><li>Always put layers that are likely to change as low as possible in the Dockerfile.</li><li>Combine multiple <code>RUN apt-get update</code>, <code>RUN apt-get install</code>, etc. commands into one. (This also helps reduce the image size, which will be mentioned shortly).</li><li>If you want to disable the cache for a given Docker build, you can add the <code>--no-cache=True</code> flag.</li></ol><h3 class="relative group">3. Use Small Base Docker Images<div id=3-use-small-base-docker-images class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#3-use-small-base-docker-images aria-label=Anchor>#</a></span></h3><p>Smaller Docker images are more modular and secure. Smaller base Docker images build, push, and pull faster. They also tend to be more secure because they only include the necessary libraries and system dependencies required to run your application.</p><p>Which base Docker image should you use? There&rsquo;s no one-size-fits-all answer; it depends on what you are doing. Here&rsquo;s a comparison of the size of various Docker base images for Python.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>REPOSITORY   TAG                 IMAGE ID       CREATED      SIZE
</span></span><span class=line><span class=cl>python       3.9.6-alpine3.14    f773016f760e   <span class=m>3</span> days ago   45.1MB
</span></span><span class=line><span class=cl>python       3.9.6-slim          907fc13ca8e7   <span class=m>3</span> days ago   115MB
</span></span><span class=line><span class=cl>python       3.9.6-slim-buster   907fc13ca8e7   <span class=m>3</span> days ago   115MB
</span></span><span class=line><span class=cl>python       3.9.6               cba42c28d9b8   <span class=m>3</span> days ago   886MB
</span></span><span class=line><span class=cl>python       3.9.6-buster        cba42c28d9b8   <span class=m>3</span> days ago   886MB
</span></span></code></pre></div><p>While the Alpine flavor, based on Alpine Linux, is the smallest, it often leads to increased build times if you can&rsquo;t find pre-compiled binaries that work with it. Therefore, you may end up having to build binaries yourself, which might increase the image size (depending on required system-level dependencies) and build time (due to having to compile from source).</p><blockquote><p>Read <a href=https://pythonspeed.com/articles/base-image-python-docker-images/ target=_blank>Best Docker Base Images for Python Applications</a> and <a href=https://pythonspeed.com/articles/alpine-docker-python/ target=_blank>Using Alpine Can Make Python Docker Builds 50x Slower</a> to learn more about why you might best avoid Alpine-based base images.</p></blockquote><p>Ultimately, it&rsquo;s all about balance. When in doubt, start with the <code>*-slim</code> flavor, especially during development mode as you are building your application. You want to avoid having to constantly update your Dockerfile to install necessary system-level dependencies as you add new <code>Python</code> packages. As you harden your application and Dockerfile for production, you might want to explore using Alpine for the final image of a multi-stage build.</p><p>Also, don&rsquo;t forget to regularly update your base images to improve security and performance. When a new version of a base image is released, e.g., <code>3.9.6-slim</code> &ndash;> <code>3.9.7-slim</code>, you should pull the new image and update your running containers to get all the latest security patches.</p><h3 class="relative group">4. Minimize the Number of Layers<div id=4-minimize-the-number-of-layers class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#4-minimize-the-number-of-layers aria-label=Anchor>#</a></span></h3><p>Try to combine <code>RUN</code>, <code>COPY</code>, and <code>ADD</code> commands because they create layers. Each layer adds to the size of the image because they are cached. Therefore, as the number of layers increases, so does the image size.</p><p>You can test this using the <code>docker history</code> command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker images
</span></span><span class=line><span class=cl>REPOSITORY   TAG       IMAGE ID       CREATED          SIZE
</span></span><span class=line><span class=cl>dockerfile   latest    180f98132d02   <span class=m>51</span> seconds ago   259MB
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker <span class=nb>history</span> 180f98132d02
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>IMAGE          CREATED              CREATED BY                                      SIZE      COMMENT
</span></span><span class=line><span class=cl>180f98132d02   <span class=m>58</span> seconds ago       COPY . . <span class=c1># buildkit                             6.71kB    buildkit.dockerfile.v0</span>
</span></span><span class=line><span class=cl>&lt;missing&gt;      <span class=m>58</span> seconds ago       RUN /bin/sh -c pip install -r requirements.t…   35.5MB    buildkit.dockerfile.v0
</span></span><span class=line><span class=cl>&lt;missing&gt;      About a minute ago   COPY requirements.txt . <span class=c1># buildkit              58B       buildkit.dockerfile.v0</span>
</span></span><span class=line><span class=cl>&lt;missing&gt;      About a minute ago   WORKDIR /app
</span></span><span class=line><span class=cl>...
</span></span></code></pre></div><p>Notice the size. Only <code>RUN</code>, <code>COPY</code>, and <code>ADD</code> commands increase the image size, and you can reduce the size of the final image by combining commands whenever possible. For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>RUN</span> apt-get update<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt-get install -y gcc<span class=err>
</span></span></span></code></pre></div><p>Can be combined into a single <code>RUN</code> command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> apt-get install -y gcc<span class=err>
</span></span></span></code></pre></div><p>Thus, creating a single layer instead of two, thereby reducing the size of the final image. While reducing the number of layers is a good idea, it&rsquo;s more important that it&rsquo;s not a goal in itself but rather a side effect of reducing image size and build time. In other words, instead of trying to micro-optimize every command, you should focus on the first three practices!!!</p><ol><li>Multi-stage builds</li><li>The order of Dockerfile commands</li><li>And using a small base image.</li></ol><h4 class="relative group">Note<div id=note class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#note aria-label=Anchor>#</a></span></h4><ol><li><code>RUN</code>, <code>COPY</code>, and <code>ADD</code> all create layers</li><li>Each layer contains the difference from the previous layer</li><li>Layers add to the final image size</li></ol><h4 class="relative group">Tip<div id=tip class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#tip aria-label=Anchor>#</a></span></h4><ol><li>Combine related commands</li><li>Remove unnecessary files during the <code>RUN</code> step in the creation process</li><li>Minimize running <code>apt-get upgrade</code> as it upgrades all packages to the latest versions.</li><li>For multi-stage builds, don&rsquo;t worry too much about over-optimizing commands in temporary stages</li></ol><p>Finally, for better readability, it is recommended to sort multi-line arguments alphanumerically.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> apt-get install -y <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    gcc <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    git <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    matplotlib <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    pillow  <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=o>&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span class=err>
</span></span></span></code></pre></div><h3 class="relative group">5. Use Unprivileged Containers<div id=5-use-unprivileged-containers class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#5-use-unprivileged-containers aria-label=Anchor>#</a></span></h3><p>By default, Docker runs container processes as root inside the container. However, this is bad practice because processes running as root inside the container also run as root on the Docker host.</p><p>Therefore, if an attacker gains access to the container, they gain all root privileges and can perform several attacks against the Docker host, such as:</p><ol><li>Copying sensitive information from the host&rsquo;s filesystem to the container</li><li>Executing remote commands</li></ol><p>To prevent this, ensure your container processes run as a non-root user.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>RUN</span> addgroup --system app <span class=o>&amp;&amp;</span> adduser --system --group app<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> app</span><span class=err>
</span></span></span></code></pre></div><p>You can go a step further and remove shell privileges, ensuring there is no home directory.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>RUN</span> addgroup --gid <span class=m>1001</span> --system app <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    adduser --no-create-home --shell /bin/false --disabled-password --uid <span class=m>1001</span> --system --group app<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> app</span><span class=err>
</span></span></span></code></pre></div><p>Verification</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -i sample id
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>1001<span class=o>(</span>app<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>1001<span class=o>(</span>app<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>1001<span class=o>(</span>app<span class=o>)</span>
</span></span></code></pre></div><p>Here, the application inside the container is running under a non-root user. However, remember that the Docker daemon and the container itself are still running with root privileges.</p><p>Be sure to check out running the Docker daemon as a non-root user for help running both the daemon and containers as a non-root user.</p><h3 class="relative group">6. Prefer <code>COPY</code> over <code>ADD</code><div id=6-prefer-copy-over-add class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#6-prefer-copy-over-add aria-label=Anchor>#</a></span></h3><p>Unless you are sure you need the extra functionality that <code>ADD</code> provides, use <code>COPY</code>.</p><p>So what&rsquo;s the difference between <code>COPY</code> and <code>ADD</code>?</p><p>First, both commands allow you to copy files into a Docker image from a specific location.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>ADD</span> &lt;src&gt; &lt;dest&gt;<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> &lt;src&gt; &lt;dest&gt;<span class=err>
</span></span></span></code></pre></div><p>While they seem to do the same thing, <code>ADD</code> has some extra capabilities.</p><ul><li><code>COPY</code> is used to copy local files or directories from the Docker host to the image.</li><li><code>ADD</code> can be used for the same thing, but it can also be used to download external files. Additionally, if you use a compressed file (tar, gzip, bzip2, etc.) as the <code>&lt;src></code> argument, <code>ADD</code> will automatically extract the contents to the specified location.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># Copy local file on host to destination</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> /source/path  /destination/path<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ADD</span> /source/path  /destination/path<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Download external file and copy to destination</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ADD</span> http://external.file/url  /destination/path<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Copy and extract local compressed file</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ADD</span> source.file.tar.gz /destination/path<span class=err>
</span></span></span></code></pre></div><p>Finally, <code>COPY</code> is semantically clearer and easier to understand than <code>ADD</code>.</p><h3 class="relative group">7. Cache Python Packages to the Docker Host<div id=7-cache-python-packages-to-the-docker-host class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#7-cache-python-packages-to-the-docker-host aria-label=Anchor>#</a></span></h3><p>When a requirements file is changed, the image needs to be rebuilt to install new packages. Previous steps will be cached, as mentioned in minimizing the number of layers. Downloading all packages on every image rebuild causes significant network activity and requires a considerable amount of time. It takes the same amount of time on every rebuild to download common packages across different builds.</p><p>For Python, you can avoid this by mapping the pip cache directory to a directory on the host. So on every rebuild, the cached versions persist, improving build speed.</p><p>Add a volume in your Docker run as <code>-v $HOME/.cache/pip-docker/:/root/.cache/pip</code> or as a mapping in your Docker Compose file.</p><p>The directory mentioned above is for reference only; make sure you are mapping the cache directory, not the site-packages (where built-in packages live).</p><p>Moving the cache from the docker image to the host can save you space in your final image.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># omit ...</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> requirements.txt .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> --mount<span class=o>=</span><span class=nv>type</span><span class=o>=</span>cache,target<span class=o>=</span>/root/.cache/pip <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        pip install -r requirements.txt<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># omit ...</span><span class=err>
</span></span></span></code></pre></div><h3 class="relative group">8. Run Only One Process per Container<div id=8-run-only-one-process-per-container class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#8-run-only-one-process-per-container aria-label=Anchor>#</a></span></h3><p>Why is it recommended to run only one process per container?</p><p>Let&rsquo;s say your application stack consists of two web servers and a database. While you could easily run all three from one container, you should run each service in a separate container for easier reusability and scaling of each individual service.</p><ul><li>Scalability - Because each service is in a separate container, you can horizontally scale just one of your web servers to handle more traffic as needed.</li><li>Reusability - Maybe you have another service that needs a containerized database; you can simply reuse the same database container without having two unnecessary services along for the ride.</li><li>Logging - Coupled containers make logging much more complex. (We will discuss this in more detail later in this article)</li><li>Portability and Predictability - When containers have fewer parts working, it is much easier to make security patches or debug issues.</li></ul><h3 class="relative group">9. Prefer Array over String Syntax<div id=9-prefer-array-over-string-syntax class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#9-prefer-array-over-string-syntax aria-label=Anchor>#</a></span></h3><p>You can use <code>CMD</code> and <code>ENTRYPOINT</code> commands in your Dockerfiles in array (exec) or string (shell) format</p><p>In Dockerfiles, you can use the <code>CMD</code> and <code>ENTRYPOINT</code> commands in array (exec) or string (shell) format</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># Array (exec)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;gunicorn&#34;</span><span class=p>,</span> <span class=s2>&#34;-w&#34;</span><span class=p>,</span> <span class=s2>&#34;4&#34;</span><span class=p>,</span> <span class=s2>&#34;-k&#34;</span><span class=p>,</span> <span class=s2>&#34;uvicorn.workers.UvicornWorker&#34;</span><span class=p>,</span> <span class=s2>&#34;main:app&#34;</span><span class=p>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># String (shell)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=s2>&#34;gunicorn -w 4 -k uvicorn.workers.UvicornWorker main:app&#34;</span><span class=err>
</span></span></span></code></pre></div><p>Both are correct and achieve almost the same thing; however, you should use the exec format whenever possible.</p><p>Quoting from the <a href=https://docs.docker.com/compose/faq/#why-do-my-services-take-10-seconds-to-recreate-or-stop target=_blank>official Docker documentation</a>:</p><ul><li>Make sure you use the exec form of <code>CMD</code> and <code>ENTRYPOINT</code> in your Dockerfile.</li><li>For example, use <code>["program", "arg1", "arg2"]</code> instead of <code>"program arg1 arg2"</code>. Using the string form causes Docker to run your process using <code>bash</code>, which doesn&rsquo;t handle signals correctly. Compose always uses the JSON form, so don&rsquo;t worry if you override the command or entrypoint in your Compose file.</li></ul><p>Therefore, since most shells don&rsquo;t handle signals to child processes, if you use the shell format, CTRL-C (which generates <code>SIGTERM</code>) might not stop a child process.</p><p>Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> ubuntu:18.04</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># BAD: String (shell) format</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> top -d<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># GOOD: Array (exec) format</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;top&#34;</span><span class=p>,</span> <span class=s2>&#34;-d&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></div><p>Both do the same thing. But notice that in the string (shell) format case, <code>CTRL-C</code> won&rsquo;t kill the process. Instead, you will see <code>^C^C^C^C^C^C^C^C^C^C</code>.</p><p>Another caveat is that the string (shell) format carries the shell&rsquo;s PID, not the process itself.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># Array format</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>root@18d8fd3fd4d2:/app# ps ax<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  PID TTY      STAT   TIME COMMAND<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=m>1</span> ?        Ss     0:00 python manage.py runserver 0.0.0.0:8000<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=m>7</span> ?        Sl     0:02 /usr/local/bin/python manage.py runserver 0.0.0.0:8000<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>   <span class=m>25</span> pts/0    Ss     0:00 bash<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=m>356</span> pts/0    R+     0:00 ps ax<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># String format</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>root@ede24a5ef536:/app# ps ax<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  PID TTY      STAT   TIME COMMAND<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=m>1</span> ?        Ss     0:00 /bin/sh -c python manage.py runserver 0.0.0.0:8000<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=m>8</span> ?        S      0:00 python manage.py runserver 0.0.0.0:8000<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=m>9</span> ?        Sl     0:01 /usr/local/bin/python manage.py runserver 0.0.0.0:8000<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>   <span class=m>13</span> pts/0    Ss     0:00 bash<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=m>342</span> pts/0    R+     0:00 ps ax<span class=err>
</span></span></span></code></pre></div><h4 class="relative group">10. Understand the Difference Between <code>ENTRYPOINT</code> and <code>CMD</code><div id=10-understand-the-difference-between-entrypoint-and-cmd class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#10-understand-the-difference-between-entrypoint-and-cmd aria-label=Anchor>#</a></span></h4><p>Should I use <code>ENTRYPOINT</code> or <code>CMD</code> to run the container process? There are two ways to run commands inside a container.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;gunicorn&#34;</span><span class=p>,</span> <span class=s2>&#34;config.wsgi&#34;</span><span class=p>,</span> <span class=s2>&#34;-b&#34;</span><span class=p>,</span> <span class=s2>&#34;0.0.0.0:8000&#34;</span><span class=p>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># and</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;gunicorn&#34;</span><span class=p>,</span> <span class=s2>&#34;config.wsgi&#34;</span><span class=p>,</span> <span class=s2>&#34;-b&#34;</span><span class=p>,</span> <span class=s2>&#34;0.0.0.0:8000&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></div><p>Both essentially do the same thing: start the application using the <code>Gunicorn</code> server on <code>config.wsgi</code>, binding it to <code>0.0.0.0:8000</code>.</p><p><code>CMD</code> is easily overwritten. If you run <code>docker run &lt;image_name> uvicorn config.asgi</code>, the above <code>CMD</code> will be replaced with the new arguments.</p><p>For example, <code>uvicorn config.asgi</code>. To override the <code>ENTRYPOINT</code> command, you must specify the <code>--entrypoint</code> option.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --entrypoint uvicorn config.asgi &lt;image_name&gt;
</span></span></code></pre></div><p>Here, it&rsquo;s clear that we are overriding the entrypoint. So it&rsquo;s recommended to use <code>ENTRYPOINT</code> instead of <code>CMD</code> to prevent accidentally overriding commands.</p><p>They can also be used together. For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;gunicorn&#34;</span><span class=p>,</span> <span class=s2>&#34;config.wsgi&#34;</span><span class=p>,</span> <span class=s2>&#34;-w&#34;</span><span class=p>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;4&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></div><p>When used together like this, the command run for launching the container becomes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gunicorn config.wsgi -w <span class=m>4</span>
</span></span></code></pre></div><p>As mentioned above, <code>CMD</code> is easily overwritten. Therefore, <code>CMD</code> can be used to pass arguments to the <code>ENTRYPOINT</code> command. For instance, it&rsquo;s easy to change the number of workers, like so:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run &lt;image_name&gt; <span class=m>6</span>
</span></span></code></pre></div><p>This will launch the container with 6 Gunicorn workers instead of the default 4.</p><h3 class="relative group">11. Add Health Checks <code>HEALTHCHECK</code><div id=11-add-health-checks-healthcheck class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#11-add-health-checks-healthcheck aria-label=Anchor>#</a></span></h3><p>Use <code>HEALTHCHECK</code> to determine if the process running inside the container is not only up and running but also &ldquo;healthy.&rdquo;</p><p>Docker exposes an API to check the status of the running processes within the container; it provides information beyond just whether a process is &ldquo;running&rdquo; because &ldquo;running&rdquo; encompasses &ldquo;it&rsquo;s running,&rdquo; &ldquo;still starting up,&rdquo; and even &ldquo;stuck in some infinite loop error state.&rdquo; You interact with this API via the <a href=https://docs.docker.com/engine/reference/builder/#healthcheck target=_blank><code>HEALTHCHECK</code></a> instruction.</p><p>For example, if you are serving a web application, you can use the following to determine if the <code>/</code> endpoint is up and able to handle service requests:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>HEALTHCHECK</span> CMD curl --fail http://localhost:8000 <span class=o>||</span> <span class=nb>exit</span> <span class=m>1</span><span class=err>
</span></span></span></code></pre></div><p>If you run <code>docker ps</code>, you can see the status of the <code>HEALTHCHECK</code>.</p><p>Healthy example</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>CONTAINER ID   IMAGE         COMMAND                  CREATED          STATUS                            PORTS                                       NAMES
</span></span><span class=line><span class=cl>09c2eb4970d4   healthcheck   <span class=s2>&#34;python manage.py ru…&#34;</span>   <span class=m>10</span> seconds ago   Up <span class=m>8</span> seconds <span class=o>(</span>health: starting<span class=o>)</span>   0.0.0.0:8000-&gt;8000/tcp, :::8000-&gt;8000/tcp   xenodochial_clarke
</span></span></code></pre></div><p>Unhealthy example</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>CONTAINER ID   IMAGE         COMMAND                  CREATED              STATUS                          PORTS                                       NAMES
</span></span><span class=line><span class=cl>09c2eb4970d4   healthcheck   <span class=s2>&#34;python manage.py ru…&#34;</span>   About a minute ago   Up About a minute <span class=o>(</span>unhealthy<span class=o>)</span>   0.0.0.0:8000-&gt;8000/tcp, :::8000-&gt;8000/tcp   xenodochial_clarke
</span></span></code></pre></div><p>You can go a step further and set up a custom endpoint solely for health checks, then configure <code>HEALTHCHECK</code> to test against the returned data.</p><p>For instance, if the endpoint returns a JSON response of <code>{"ping": "pong"}</code>, you can instruct <code>HEALTHCHECK</code> to verify the response body.</p><p>Here&rsquo;s how to view the health check status using <code>docker inspect</code>:</p><blockquote><p>Some output omitted here.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>❯ docker inspect --format <span class=s2>&#34;{{json .State.Health }}&#34;</span> ab94f2ac7889
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;Status&#34;</span>: <span class=s2>&#34;healthy&#34;</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;FailingStreak&#34;</span>: 0,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;Log&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Start&#34;</span>: <span class=s2>&#34;2021-09-28T15:22:57.5764644Z&#34;</span>,
</span></span><span class=line><span class=cl>      <span class=s2>&#34;End&#34;</span>: <span class=s2>&#34;2021-09-28T15:22:57.7825527Z&#34;</span>,
</span></span><span class=line><span class=cl>      <span class=s2>&#34;ExitCode&#34;</span>: 0,
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Output&#34;</span>: <span class=s2>&#34;...&#34;</span>
</span></span></code></pre></div><p>You can also add health checks to your Docker Compose file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3.8&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>web</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;8000:8000&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class=l>curl --fail http://localhost:8000 || exit 1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>start_period</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span></code></pre></div><p>Options:</p><ul><li><code>test</code>: The command to test.</li><li><code>interval</code>: The interval to test—that is, test every x time unit.</li><li><code>timeout</code>: The maximum time to wait for a response.</li><li><code>start_period</code>: When to start the health check. It can be used when other tasks are performed before the container is ready, such as running migrations.</li><li><code>retries</code>: The maximum number of retries before declaring the test as failed.</li></ul><p>If you&rsquo;re using an orchestration tool other than Docker Swarm (like Kubernetes or AWS ECS), they very likely have their own internal systems for handling health checks. Refer to your specific tool&rsquo;s documentation before adding the <code>HEALTHCHECK</code> instruction.</p><h2 class="relative group">Docker Image Best Practices<div id=docker-image-best-practices class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#docker-image-best-practices aria-label=Anchor>#</a></span></h2><h3 class="relative group">1. Docker Image Versioning<div id=1-docker-image-versioning class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#1-docker-image-versioning aria-label=Anchor>#</a></span></h3><p>Avoid using the <code>latest</code> tag for your images whenever possible.</p><p>If you rely on the <code>latest</code> tag (which isn&rsquo;t a real &ldquo;tag&rdquo; as it is applied by default when an image doesn&rsquo;t have an explicit tag), you can&rsquo;t tell from the image tag which version of your code is running.</p><p>Rollbacks become difficult, and it&rsquo;s easy to be overwritten (accidentally or maliciously). Tags, like your infrastructure and deployments, should be immutable.</p><p>So regardless of how you treat your internal images, you shouldn&rsquo;t use <code>latest</code> for base images, as you might inadvertently deploy a new version with breaking changes to production.</p><p>For internal images, use descriptive tags to more easily tell which version of the code is running, handle rollbacks, and avoid naming conflicts. For instance, you can use the following descriptors to compose a tag.</p><ol><li>Timestamp</li><li>Docker image ID</li><li>Git commit hash</li><li>Semantic version</li></ol><p>See also this answer in a Stack Overflow <a href=https://stackoverflow.com/a/56213290/1799408 target=_blank>question</a> &ldquo;Properly Versioning Docker Images&rdquo; for more options.</p><p>For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build -t web-prod-b25a262-1.0.0 .
</span></span></code></pre></div><p>Here, we compose the tag using:</p><ol><li>Project name: web</li><li>Environment name: prod</li><li>Git commit short hash: b25a262 (obtained via the command <code>git rev-parse --short HEAD</code>)</li><li>Semantic version: 1.0.0</li></ol><p>Choosing a tagging scheme and sticking to it is crucial. Because commit hashes readily link image tags to code, it&rsquo;s recommended to include them in your tagging scheme.</p><h3 class="relative group">2. Don&rsquo;t Store Secrets in Images<div id=2-dont-store-secrets-in-images class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#2-dont-store-secrets-in-images aria-label=Anchor>#</a></span></h3><p>Secrets are sensitive information such as passwords, database credentials, SSH keys, tokens, and TLS certificates. This information should not be placed in your images unencrypted because unauthorized users who gain access to the image can simply inspect the layers to extract keys.</p><p>Therefore, don&rsquo;t add plain-text secrets to your Dockerfiles, especially when you&rsquo;re pushing images to a public repository like Docker Hub!!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> python:3.9-slim</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> DATABASE_PASSWORD <span class=s2>&#34;SuperSecretSauce&#34;</span><span class=err>
</span></span></span></code></pre></div><p>Instead, they should be injected via:</p><ol><li>Environment variables (at runtime)</li><li>Build-time arguments (at build time)</li><li>Orchestration tools such as Docker Swarm (via Docker secrets) or Kubernetes (via Kubernetes secrets).</li></ol><p>Additionally, you can help prevent secrets from being leaked by adding common secret files and folders to your <code>.dockerignore</code> file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>**/.env
</span></span><span class=line><span class=cl>**/.aws
</span></span><span class=line><span class=cl>**/.ssh
</span></span></code></pre></div><p>Finally, be explicit about which files are copied into the image instead of recursively copying all files.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># Bad practice</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Good practice</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> ./app.py .<span class=err>
</span></span></span></code></pre></div><p>Being explicit also helps limit cache invalidation.</p><h4 class="relative group">Environment Variables<div id=environment-variables class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#environment-variables aria-label=Anchor>#</a></span></h4><p>You can pass secrets via environment variables, but they are visible in all subprocesses, linked containers, and logs and via <code>docker inspect</code>. They are also difficult to update.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --detach --env <span class=s2>&#34;DATABASE_PASSWORD=SuperSecretSauce&#34;</span> python：3.9-slim
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>b25a262f870eb0fdbf03c666e7fcf18f9664314b79ad58bc7618ea3445e39239
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker inspect --format<span class=o>=</span><span class=s1>&#39;{{range .Config.Env}}{{println .}}{{end}}&#39;</span> b25a262f870eb0fdbf03c666e7fcf18f9664314b79ad58bc7618ea3445e39239
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>DATABASE_PASSWORD</span><span class=o>=</span>SuperSecretSauce
</span></span><span class=line><span class=cl><span class=nv>PATH</span><span class=o>=</span>/usr/local/bin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
</span></span><span class=line><span class=cl><span class=nv>LANG</span><span class=o>=</span>C.UTF-8
</span></span><span class=line><span class=cl><span class=nv>GPG_KEY</span><span class=o>=</span>E3FF2839C048B25C084DEBE9B26995E310250568
</span></span><span class=line><span class=cl><span class=nv>python_version</span><span class=o>=</span>3.9.7
</span></span><span class=line><span class=cl><span class=nv>python_pip_version</span><span class=o>=</span>21.2.4
</span></span><span class=line><span class=cl><span class=nv>python_setuptools_version</span><span class=o>=</span>57.5.0
</span></span><span class=line><span class=cl><span class=nv>python_get_pip_url</span><span class=o>=</span>https://github.com/pypa/get-pip/raw/c20b0cfd643cd4a19246ccf204e2997af70f6b21/public/get-pip.py
</span></span><span class=line><span class=cl><span class=nv>PYTHON_GET_PIP_SHA256</span><span class=o>=</span>fa6f3fb93cce234cd4e8dd2beb54a51ab9c247653b52855a48dd44e6b21ff28b
</span></span></code></pre></div><p>This is the most straightforward secret management approach. While not the most secure, it keeps honest people honest, as it provides a thin layer of protection, helping to keep secrets out of the gaze of curious wandering eyes.</p><p>Using shared volumes to pass secrets is a better solution, but they should be encrypted, via Vault or AWS Key Management Service (KMS), because they are saved to disk.</p><h4 class="relative group">Build-Time Arguments<div id=build-time-arguments class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#build-time-arguments aria-label=Anchor>#</a></span></h4><p>You can use build-time arguments to pass secrets, but these secrets are visible to those who can access the image via docker history.</p><p>Example</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> python:3.9-slim</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> DATABASE_PASSWORD<span class=err>
</span></span></span></code></pre></div><p>Build</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build --build-arg <span class=s2>&#34;DATABASE_PASSWORD=SuperSecretSauce&#34;</span> .
</span></span></code></pre></div><p>If you only need to use a secret temporarily as part of the build. For example, an SSH key for cloning a private repo or downloading a private package. You should use multi-stage builds because the builder&rsquo;s history is discarded by the temporary stage.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># Temporary stage</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> python:3.9-slim as builder</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Secret argument</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>arg</span> ssh_private_key<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Install git</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    apt-get install -y --no-install-recommends git<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Clone repo using ssh key</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> mkdir -p /root/.ssh/ <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>PRIVATE_SSH_KEY</span><span class=si>}</span><span class=s2>&#34;</span> &gt; /root/.ssh/id_rsa<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> touch /root/.ssh/known_hosts <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    ssh-keyscan bitbucket.org &gt;&gt; /root/.ssh/known_hosts<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> git clone git@github.com:testdrivenio/not-real.git<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Final stage</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> python:3.9-slim</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Copy repo from temporary image</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>builder /your-repo /app/your-repo<span class=err>
</span></span></span></code></pre></div><p>Multi-stage builds only preserve the history of the final image. You can use this for persistent secrets your application needs, such as database credentials.</p><p>You can also use the new <code>--secret</code> option in docker build to pass secrets to your Docker image, which aren&rsquo;t stored in the image.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># &#34;docker_is_awesome&#34; &gt; secrets.txt</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> alpine</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Display the secret from the default secret location.</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> --mount<span class=o>=</span><span class=nv>type</span><span class=o>=</span>secret,id<span class=o>=</span>mysecret cat /run/secrets/mysecret<span class=err>
</span></span></span></code></pre></div><p>This will mount the secret from the <code>secrets.txt</code> file.</p><p>Building the image</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build --no-cache --progress<span class=o>=</span>plain --secret <span class=nv>id</span><span class=o>=</span>mysecret,src<span class=o>=</span>secrets.txt .
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Output</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=c1>#4 [1/2] FROM docker.io/library/alpine</span>
</span></span><span class=line><span class=cl><span class=c1>#4 sha256:665ba8b2cdc0cb0200e2a42a6b3c0f8f684089f4cd1b81494fbb9805879120f7</span>
</span></span><span class=line><span class=cl><span class=c1>#4 cached</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#5 [2/2] RUN --mount=type=secret,id=mysecret cat /run/secrets/myecret</span>
</span></span><span class=line><span class=cl><span class=c1>#5 sha256:75601a522ebe80ada66dedd9dd86772ca932d30d7e1b11bba94c04aa55c237de</span>
</span></span><span class=line><span class=cl><span class=c1>#5 0.635 docker_is_awesome#5 DONE 0.7s</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#6 export to image</span>
</span></span></code></pre></div><p>Finally, check the history to see if the secret is leaked.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>❯ docker <span class=nb>history</span> 49574a19241c
</span></span><span class=line><span class=cl>IMAGE          CREATED         CREATED BY                                      SIZE      COMMENT
</span></span><span class=line><span class=cl>49574a19241c   <span class=m>5</span> minutes ago   CMD <span class=o>[</span><span class=s2>&#34;/bin/sh&#34;</span><span class=o>]</span>                                 0B        buildkit.dockerfile.v0
</span></span><span class=line><span class=cl>&lt;missing&gt;      <span class=m>5</span> minutes ago   RUN /bin/sh -c cat /run/secrets/mysecret <span class=c1># b…   0B        buildkit.dockerfile.v0</span>
</span></span><span class=line><span class=cl>&lt;missing&gt;      <span class=m>4</span> weeks ago     /bin/sh -c <span class=c1>#(nop)  CMD [&#34;/bin/sh&#34;]              0B</span>
</span></span><span class=line><span class=cl>&lt;missing&gt;      <span class=m>4</span> weeks ago     /bin/sh -c <span class=c1>#(nop) ADD file:aad4290d27580cc1a…   5.6MB</span>
</span></span></code></pre></div><h4 class="relative group">Docker Secrets<div id=docker-secrets class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href=#docker-secrets aria-label=Anchor>#</a></span></h4><p>If you are using Docker Swarm, you can manage secrets using Docker secrets.</p><p>For example, initialize Docker Swarm mode.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker swarm init
</span></span></code></pre></div><p>Create a docker secret.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;supersecretpassword&#34;</span> <span class=p>|</span> docker secret create postgres_password -
</span></span><span class=line><span class=cl>qdqmbpizeef0lfhyttxqfbty0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker secret ls
</span></span><span class=line><span class=cl>ID                          NAME                DRIVER    CREATED         UPDATED
</span></span><span class=line><span class=cl>qdqmbpizeef0lfhyttxqfbty0   postgres_password             <span class=m>4</span> seconds ago   <span class=m>4</span> seconds ago
</span></span></code></pre></div><p>When a container is given access to the secret above, it will be mounted at <code>/run/secrets/postgres_password</code>. This file will contain the actual value of the secret in plain text.</p><p>Using other orchestration tools?</p><ul><li>AWS Secrets Manager with Kubernetes Secrets: <a href=https://docs.aws.amazon.com/eks/latest/userguide/manage-secrets.html target=_blank>https://docs.aws.amazon.com/eks/latest/userguide/manage-secrets.html</a></li><li>DigitalOcean Kubernetes - <a href=https://www.digitalocean.com/community/tutorials/recommended-steps-to-secure-a-digitalocean-kubernetes-cluster target=_blank>Recommended steps to secure a DigitalOcean Kubernetes cluster</a></li><li>Google Kubernetes Engine - <a href=https://cloud.google.com/secret-manager/docs/using-other-products#google-kubernetes-engine target=_blank>Using Secret Manager with other products</a></li><li>Nomad - [Vault integration and retrieving dynamic secrets](<a href="https://learn.hashicorp.com/tutorials/nomad/vault-postgres?in=nomad/integrate-" target=_blank>https://learn.hashicorp.com/tutorials/nomad/vault-postgres?in=nomad/integrate-</a></li></ul></div><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://shenxianpeng.github.io/en/posts/docker-best-practice/&amp;title=You%20Must%20Know%20These%2017%20Docker%20Best%20Practices!" title="Share on LinkedIn" aria-label="Share on LinkedIn"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://twitter.com/intent/tweet/?url=https://shenxianpeng.github.io/en/posts/docker-best-practice/&amp;text=You%20Must%20Know%20These%2017%20Docker%20Best%20Practices!" title="Tweet on Twitter" aria-label="Tweet on Twitter"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></span>
</a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://bsky.app/intent/compose?text=You%20Must%20Know%20These%2017%20Docker%20Best%20Practices!+https://shenxianpeng.github.io/en/posts/docker-best-practice/" title="Post on Bluesky" aria-label="Post on Bluesky"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 232.562c-21.183-41.196-78.868-117.97-132.503-155.834-51.378-36.272-70.978-29.987-83.828-24.181-14.872 6.72-17.577 29.554-17.577 42.988.0 13.433 7.365 110.138 12.169 126.281 15.873 53.336 72.376 71.358 124.413 65.574 2.66-.395 5.357-.759 8.089-1.097-2.68.429-5.379.796-8.089 1.097-76.259 11.294-143.984 39.085-55.158 137.972C201.224 526.527 237.424 403.67 256 341.379c18.576 62.291 39.972 180.718 150.734 83.983 83.174-83.983 22.851-126.674-53.408-137.969-2.71-.302-5.409-.667-8.089-1.096 2.732.337 5.429.702 8.089 1.096 52.037 5.785 108.54-12.239 124.413-65.574 4.804-16.142 12.169-112.847 12.169-126.281.0-13.434-2.705-36.267-17.577-42.988-12.85-5.806-32.45-12.09-83.829 24.181C334.868 114.595 277.183 191.366 256 232.562z"/></svg></span>
</a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://shenxianpeng.github.io/en/posts/docker-best-practice/&amp;resubmit=true&amp;title=You%20Must%20Know%20These%2017%20Docker%20Best%20Practices!" title="Submit to Reddit" aria-label="Submit to Reddit"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://api.whatsapp.com/send?text=https://shenxianpeng.github.io/en/posts/docker-best-practice/&amp;resubmit=true&amp;title=You%20Must%20Know%20These%2017%20Docker%20Best%20Practices!" title="Share via WhatsApp" aria-label="Share via WhatsApp"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4.0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3.0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2.0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2.0-101.7 82.8-184.5 184.6-184.5 49.3.0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5.0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3.0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://t.me/share/url?url=https://shenxianpeng.github.io/en/posts/docker-best-practice/&amp;resubmit=true&amp;title=You%20Must%20Know%20These%2017%20Docker%20Best%20Practices!" title="Share via Telegram" aria-label="Share via Telegram"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://pinterest.com/pin/create/bookmarklet/?url=https://shenxianpeng.github.io/en/posts/docker-best-practice/&amp;description=You%20Must%20Know%20These%2017%20Docker%20Best%20Practices!" title="Pin on Pinterest" aria-label="Pin on Pinterest"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M496 256c0 137-111 248-248 248-25.6.0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8.0 128.7-68.8 128.7-154.3.0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1.0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6.0-54.7 41.4-107.6 112-107.6 60.9.0 103.6 41.5 103.6 100.9.0 67.1-33.9 113.6-78 113.6-24.3.0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6.0-19-10.2-34.9-31.4-34.9-24.9.0-44.9 25.7-44.9 60.2.0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9.0 361.1.0 256 0 119 111 8 248 8s248 111 248 248z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.facebook.com/sharer/sharer.php?u=https://shenxianpeng.github.io/en/posts/docker-best-practice/&amp;quote=You%20Must%20Know%20These%2017%20Docker%20Best%20Practices!" title="Share on Facebook" aria-label="Share on Facebook"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://shenxianpeng.github.io/en/posts/docker-best-practice/&amp;subject=You%20Must%20Know%20These%2017%20Docker%20Best%20Practices!" title="Send via email" aria-label="Send via email"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://line.me/R/share?text=https://shenxianpeng.github.io/en/posts/docker-best-practice/%20You%20Must%20Know%20These%2017%20Docker%20Best%20Practices!" title="Share on LINE" aria-label="Share on LINE"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M311 196.8v81.3c0 2.1-1.6 3.7-3.7 3.7h-13c-1.3.0-2.4-.7-3-1.5L254 230v48.2c0 2.1-1.6 3.7-3.7 3.7h-13c-2.1.0-3.7-1.6-3.7-3.7V196.9c0-2.1 1.6-3.7 3.7-3.7h12.9c1.1.0 2.4.6 3 1.6l37.3 50.3V196.9c0-2.1 1.6-3.7 3.7-3.7h13c2.1-.1 3.8 1.6 3.8 3.5zm-93.7-3.7h-13c-2.1.0-3.7 1.6-3.7 3.7v81.3c0 2.1 1.6 3.7 3.7 3.7h13c2.1.0 3.7-1.6 3.7-3.7V196.8c0-1.9-1.6-3.7-3.7-3.7zm-31.4 68.1H150.3V196.8c0-2.1-1.6-3.7-3.7-3.7h-13c-2.1.0-3.7 1.6-3.7 3.7v81.3c0 1 .3 1.8 1 2.5.7.6 1.5 1 2.5 1h52.2c2.1.0 3.7-1.6 3.7-3.7v-13c0-1.9-1.6-3.7-3.5-3.7zm193.7-68.1H327.3c-1.9.0-3.7 1.6-3.7 3.7v81.3c0 1.9 1.6 3.7 3.7 3.7h52.2c2.1.0 3.7-1.6 3.7-3.7V265c0-2.1-1.6-3.7-3.7-3.7H344V247.7h35.5c2.1.0 3.7-1.6 3.7-3.7V230.9c0-2.1-1.6-3.7-3.7-3.7H344V213.5h35.5c2.1.0 3.7-1.6 3.7-3.7v-13c-.1-1.9-1.7-3.7-3.7-3.7zM512 93.4v326c-.1 51.2-42.1 92.7-93.4 92.6H92.6C41.4 511.9-.1 469.8.0 418.6V92.6C.1 41.4 42.2-.1 93.4.0h326c51.2.1 92.7 42.1 92.6 93.4zM441.6 233.5c0-83.4-83.7-151.3-186.4-151.3S68.8 150.1 68.8 233.5c0 74.7 66.3 137.4 155.9 149.3 21.8 4.7 19.3 12.7 14.4 42.1-.8 4.7-3.8 18.4 16.1 10.1s107.3-63.2 146.5-108.2c27-29.7 39.9-59.8 39.9-93.1z"/></svg></span></a></section></div><script type=text/javascript src=/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA==" data-oid=views_posts/docker-best-practice/index.md data-oid-likes=likes_posts/docker-best-practice/index.md></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/en/posts/world-quality-report/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">2021-22 World Quality Report (WQR)</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2021-11-06T00:00:00+00:00>2021-11-06</time>
</span></span></a></span><span><a class="flex text-right group ml-3" href=/en/posts/what-is-go/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">What is Go? Advantages, Current Status, and Choosing Between Python and Go for Beginners</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2022-01-18T00:00:00+00:00>2022-01-18</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div><div class=pt-3><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class=pt-3><div id=giscus-comments class=mt-8><script src=https://giscus.app/client.js data-repo=shenxianpeng/blog data-repo-id="MDEwOlJlcG9zaXRvcnkxMDkwODc5MTM=" data-category=Announcements data-category-id=DIC_kwDOBoCMqc4CVG-1 data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=light data-lang=en crossorigin=anonymous async></script></div><script>function setGiscusTheme(){function e(){return document.documentElement.classList.contains("dark")?"transparent_dark":"light"}function t(e){const t=document.querySelector('iframe[src*="giscus"]');t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}const n=e(),s=document.querySelector('script[src*="giscus"]');s&&s.setAttribute("data-theme",n);const o=new MutationObserver(function(n){n.forEach(function(n){if(n.type==="attributes"&&n.attributeName==="class"){const n=e();t(n)}})});o.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),setTimeout(()=>{t(n)},500),setTimeout(()=>{t(e())},1e3)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",setGiscusTheme):setGiscusTheme()</script><noscript><div class="mt-8 p-4 bg-neutral-100 dark:bg-neutral-800 rounded-lg"><p class="text-neutral-600 dark:text-neutral-400">Please enable JavaScript to view the comments powered by
<a href=https://giscus.app/ class="text-primary-600 hover:text-primary-500 dark:text-primary-400 dark:hover:text-primary-300">Giscus
</a>.</p></div></noscript></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0 z-10"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex list-none flex-col sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/en/tags/ title=Tags>Tags</a></li><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/en/authors/ title=Authors>Authors</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">© 2017–2025 Xianpeng Shen. All rights reserved.</p><p class="text-xs text-neutral-500 dark:text-neutral-400"><a class="hx:flex hx:text-sm hx:items-center hx:gap-1 hx:text-current" target=_blank rel="noopener noreferrer" </a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script><a rel=me href=https://masto.ai/@blowfish></a></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://shenxianpeng.github.io/en/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>